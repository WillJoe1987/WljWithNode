Ext.ns("Com.yucheng.bcrm"),Com.yucheng.bcrm.TreePanel=Ext.extend(Ext.tree.TreePanel,{clickFn:!1,resloader:!1,checkBox:!1,ctCls:"x-treeContainer",root:{},load:function(){var c,a=this.resloader;a.url,c=this,c.appendChild(a.loadAll())},addNode:function(a){this.resloader.addNode(a)},deleteNode:function(a){this.resloader.deleteNode(a)},editNode:function(a){this.resloader.editNode(a)},onRender:function(a,b){Com.yucheng.bcrm.TreePanel.superclass.onRender.call(this,a,b)},afterRender:function(){Com.yucheng.bcrm.TreePanel.superclass.afterRender.call(this),this.resloader&&this.load();var a=this;this.on("click",function(b){__tmpNode=b,Ext.isFunction(a.clickFn)&&a.clickFn(b)})},appendChild:function(a){a&&this.root.appendChild(a)},initComponent:function(){Com.yucheng.bcrm.TreePanel.superclass.initComponent.call(this),this.resloader.supportedTrees.push(this)},beforeLoad:function(){this.removeClass("x-tree-node-loading")},listeners:{append:function(a,b,c){return __tmpNode=c,Ext.isBoolean(a.checkBox)&&a.checkBox?c.attributes[a.resloader.checkField]?(c.checked=!0,c.attributes.checked=!0):(c.checked=!1,c.attributes.checked=!1):(delete c.checked,delete c.attributes.checked),!0},beforeexpandnode:function(a){var d=this;return a.hasloadeddata||a==d.root?!0:d.resloader.lazyLoad?(a.hasloadeddata=!0,d.resloader.expandChild(a.attributes),void 0):!0},beforedestroy:function(a){return a.resloader&&a.resloader.supportedTrees.remove(a),!0}}}),Ext.reg("bcrmtree",Com.yucheng.bcrm.TreePanel),Com.yucheng.bcrm.TreeLoader=Ext.extend(Ext.tree.TreeLoader,{}),Ext.reg("bcrmtreeloader",Com.yucheng.bcrm.TreeLoader);var __tmpNode={};Com.yucheng.bcrm.ArrayTreeLoader=Ext.extend(Ext.tree.TreeLoader,{url:!1,dataCache:!1,nodeArray:!1,parentAttr:!1,rootValue:"",textField:!1,idProperties:!1,dataRoot:!1,lazyLoad:!1,lazyLoadCount:1e3,supportedTrees:new Array,checkField:!1,constructor:function(a){Com.yucheng.bcrm.ArrayTreeLoader.superclass.constructor.call(this,a),this.supportedTrees=new Array},loadAll:function(){var b,c,d,e,f,g,h,i,a=this;if(this.dataCache)return this.dataCache;if(b=this.rootValue,c=this.parentAttr,d=this.textField,e=this.idProperties,f=this.dataRoot,(g=this.nodeArray)&&(h=f?evel("tn."+f):g,i=[],Ext.isArray(h)))return h.length>=a.lazyLoadCount&&(a.lazyLoad=!0),Ext.each(h,function(a){a[c]==b&&i.push(a)}),a.lazyLoad?Ext.each(i,function(b){d&&(b.text=b[d]),e&&(b.id=b[e]),a.privateExpand(b)}):Ext.each(this.nodeArray,function(b){d&&(b.text=b[d]),e&&(b.id=b[e]),a.privateExpand(b)}),this.dataCache=i,this.dataCache},refreshCache:function(){this.dataCache=!1,this.dataCache=this.loadAll()},addNode:function(a){var f,b=this.idProperties,c=this.textField,e=this.parentAttr;""!=a[c]&&void 0!=a[c]&&""!=a[b]&&void 0!=a[b]&&(a.id=a[b],a.text=a[c]),Ext.isArray(a.children)&&0!=a.children.length||(a.leaf=!0),this.hasNode(a)||(f=this.hasNodeByProperties(b,a[e]),f&&((f.leaf||!f.children)&&(f.children=[],f.leaf=!1),f.children.push(a)),a.text&&a[this.parentAttr]&&this.nodeArray.push(a)),Ext.each(this.supportedTrees,function(c){if(c.rendered&&a[b]!=c.root.id&&!c.root.findChild("id",a[b],!0))if(a[e]&&a[e]!=c.root.id){var d=c.root.findChild("id",a[e],!0);d&&(d.isLeaf()&&(d.leaf=!1),d.appendChild(a))}else a[e]=c.root.id,c.root.appendChild(a)})},deleteNode:function(a){var f,b=this.idProperties,c=this.textField,d=this.parentAttr,e=this;a.id||(a.id=a[b]),a.text||(a.text=a[c]),f=this.hasNode(a),f&&(Ext.each(this.supportedTrees,function(b){var c,f;if(b.rendered&&""!=a.text&&void 0!=a.text&&""!=a.id&&void 0!=a.text){if(a.id==b.root.id)return;c=b.root.findChild("id",a.id,!0),c?(f=c.parentNode,f.removeChild(c,!0),f.hasChildNodes()||(Ext.fly(f.getUI().elNode).addClass("x-tree-node-leaf"),f.leaf=!0,f.ownerTree.doLayout(),Ext.fly(f.getUI().elNode).removeClass("x-tree-node-collapsed"))):(f=b.root.findChild("id",a[d],!0),f&&1==e.hasChildren(e.hasNode({id:a[d]})).length&&(Ext.fly(f.getUI().elNode).addClass("x-tree-node-leaf"),f.leaf=!0,f.ownerTree.doLayout(),Ext.fly(f.getUI().elNode).removeClass("x-tree-node-collapsed")))}}),this.nodeArray.remove(f),this.refreshCache())},editNode:function(a){var e,f,g,b=this.idProperties,c=this.textField,d=this.parentAttr;if(a.id||(a.id=a[b]),a.text||(a.text=a[c]),e=this,""!=a.text&&void 0!=a.text&&""!=a.id&&void 0!=a.text){if(!e.hasNode(a))return;f=e.hasNode(a),Ext.apply(f,a),f[b]=a.id,f[c]=a.text,g=!1,f[d]!==a[d]&&(f[d]=a[d],g=!0),this.refreshCache(),Ext.each(this.supportedTrees,function(b){if(b.rendered&&a.id!=this.root.id&&a[d])if(g)b.root.removeAll(),b.load(),b.root.expand();else{var c=b.root.findChild("id",a.id,!0);c&&c.setText(a.text)}})}},hasNode:function(a){var f,g,h,i;if(this.rootValue,this.parentAttr,this.textField,this.idProperties,f=this.dataRoot,g=this.nodeArray){h=f?evel("tn."+f):g;for(i in h)if(h[i].id==a.id)return h[i];return!1}},hasNodeByProperties:function(a,b){var f,g,h,i,j;if(this.rootValue,this.parentAttr,this.textField,f=this.idProperties,g=this.dataRoot,h=this.nodeArray,!h)return!1;if(i=g?evel("tn."+g):h,!a)return!1;if(Ext.isArray(i))for(j=i.length,f=0;j>f;f++)if(i[f][a]===b)return i[f];return!1},hasChildren:function(a){var c,e,f,g,h,i,j;if(this.rootValue,c=this.parentAttr,this.textField,e=this.idProperties,f=this.dataRoot,g=this.nodeArray){h=f?evel("tn."+f):g,i=[];for(j in h)h[j][c]==a[e]&&i.push(h[j]);return i.length>0?i:!1}},privateExpand:function(a){var b=this.hasChildren(a),c=this;return b?a.children=c.lazyLoad?[]:b:(delete a.children,a.leaf=!0),a},expandChild:function(a){var d,e,h,i;this.rootValue,this.parentAttr,d=this.textField,e=this.idProperties,this.dataRoot,this.hasNode(a),h=this.hasChildren(a),i=this,Ext.each(h,function(a){a.id=a[e],a.text=a[d];var b=i.hasChildren(a);b?a.children=[]:(delete a.children,a.leaf=!0),i.addNode(a)})}}),Ext.reg("bcrmarraytreeloader",Com.yucheng.bcrm.ArrayTreeLoader),"function"!=typeof RegExp.escape&&(RegExp.escape=function(a){return"string"!=typeof a?a:a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}),Ext.ns("Ext.ux.form"),Ext.ux.form.LovCombo=Ext.extend(Ext.form.ComboBox,{checkField:"checked",separator:",",initComponent:function(){var a=new RegExp("-","g");this.checkField="checked"+this.id.replace(a,""),this.tpl||(this.tpl='<tpl for="."><div class="x-combo-list-item"><img src="'+Ext.BLANK_IMAGE_URL+'" '+'class="ux-lovcombo-icon-'+"{[values."+this.checkField+'?"checked":"unchecked"'+']}">'+'<label class="ux-lovcombo-item-text">{'+(this.displayField||"text")+"}</label>"+"</div>"+"</tpl>"),Ext.ux.form.LovCombo.superclass.initComponent.apply(this,arguments),this.on({scope:this,beforequery:this.onBeforeQuery,blur:this.onRealBlur}),this.onLoad=this.onLoad.createSequence(function(){if(this.el){var a=this.el.dom.value;this.el.dom.value="",this.el.dom.value=a}})},initEvents:function(){Ext.ux.form.LovCombo.superclass.initEvents.apply(this,arguments),this.keyNav.tab=!1},clearValue:function(){this.value="",this.setRawValue(this.value),this.store.clearFilter(),this.store.each(function(a){a.set(this.checkField,!1)},this),this.hiddenField&&(this.hiddenField.value=""),this.applyEmptyText()},getCheckedDisplay:function(){var a=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(a,this.separator+" ")},getCheckedValue:function(a){var b,c;return a=a||this.valueField,b=[],c=this.store.snapshot||this.store.data,c.each(function(c){c.get(this.checkField)&&b.push(c.get(a))},this),b.join(this.separator)},onBeforeQuery:function(a){a.query=a.query.replace(new RegExp(this.getCheckedDisplay()+"[ "+this.separator+"]*"),"")},onRealBlur:function(){var a,b,c,d;this.list.hide(),a=this.getRawValue(),b=a.split(new RegExp(RegExp.escape(this.separator)+" *")),c=[],d=this.store.snapshot||this.store.data,Ext.each(b,function(a){d.each(function(b){a===b.get(this.displayField)&&c.push(b.get(this.valueField))},this)},this),this.setValue(c.join(this.separator)),this.store.clearFilter()},onSelect:function(a,b){this.fireEvent("beforeselect",this,a,b)!==!1&&(a.set(this.checkField,!a.get(this.checkField)),this.store.isFiltered()&&this.doQuery(this.allQuery),this.setValue(this.getCheckedValue()),this.fireEvent("select",this,a,b))},setValue:function(a){a?(a=""+a,this.valueField?(this.store.clearFilter(),this.store.each(function(b){var c=!!a.match("(^|"+this.separator+")"+RegExp.escape(b.get(this.valueField))+"("+this.separator+"|$)");b.set(this.checkField,c)},this),this.value=this.getCheckedValue(),this.setRawValue(this.getCheckedDisplay()),this.hiddenField&&(this.hiddenField.value=this.value)):(this.value=a,this.setRawValue(a),this.hiddenField&&(this.hiddenField.value=a)),this.el&&this.el.removeClass(this.emptyClass)):this.clearValue()},selectAll:function(){this.store.each(function(a){a.set(this.checkField,!0)},this),this.doQuery(this.allQuery),this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()},assertValue:Ext.emptyFn}),Ext.reg("lovcombo",Ext.ux.form.LovCombo),function(){var a={};window.Wlj||(window.Wlj=a),SyncAjax=function(){var a=this;a.initialize()},Ext.extend(SyncAjax,Ext.util.Observable),SyncAjax.prototype.disableCachingParam="_dc",SyncAjax.prototype.method="GET",SyncAjax.prototype.success=!1,SyncAjax.prototype.failure=!1,SyncAjax.prototype.initialize=function(){this.addEvents({beforeRequest:!0,afterRequest:!0,requestException:!0,requestSucess:!0,requestFailure:!0})},SyncAjax.prototype.request=function(a){var c,e,b=this;try{if(window.ActiveXObject?c=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(c=new XMLHttpRequest),a.url=a.url.indexOf("?")>0?a.url+"&"+Ext.urlEncode(a.params):a.url+"?"+Ext.urlEncode(a.params),a.url=Ext.urlAppend(a.url,this.disableCachingParam+"="+(new Date).getTime()),c.open(b.method,a.url,!1),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e=b.fireEvent("beforeRequest",this),e===!1)return Ext.error("beforeRequest事件阻止了SyncAjax 请求!"),!1;c.send(null),b.fireEvent("afterRequest",this),200==c.status?(b=this,b.fireEvent("requestSucess",this),Ext.isFunction(a.success)&&a.success(c)):(b=this,Ext.log("Wlj.SyncAjax.syncRequest异常:["+c.statusText+"]"),b.fireEvent("requestFailure",this),Ext.isFunction(a.failure)&&a.failure(c))}catch(f){Ext.log("Wlj.syncRequest异常"),b.fireEvent("syncException",this)}},window.Wlj.SyncAjax=new SyncAjax}(),Wlj.version={major:"1",subject:"0",patch:"0",fullVersion:"1.0.0",fullName:"Walk Lonely Javascript",buildDate:"20131104",describe:"Release 1.0.0 beta, based on Ext 3.3.1"},Wlj.tools={namespace:function(){var a,b;return Ext.each(arguments,function(c){b=c.split("."),a=window[b[0]]=window[b[0]]||{},Ext.each(b.slice(1),function(b){a=a[b]=a[b]||{}})}),a},imports:function(a,b){Ext.isArray(a)?0==a.length?Ext.isFunction(b)&&b.call(Wlj):Wlj.tools.load(a.pop(),function(){Wlj.tools.imports(a,b)}):Wlj.tools.load(a,b)},load:function(a,b){Wlj.SyncAjax.request({url:basepath+a,callback:b,success:function(a){window.execScript?window.execScript(a.responseText):window.eval(a.responseText),Ext.isFunction(b)&&b.call(Wlj)}})}},window.imports=Wlj.tools.imports,Ext.ns("Wlj.memorise"),Wlj.memorise.Tile=function(){this.tiles=new Ext.util.MixedCollection,this.tilesData=new Ext.util.MixedCollection;var a=this;this.tiles.on("add",function(){a.onAdd()}),this.tiles.on("remove",function(){a.renderIndex--}),this.tilesData.on("add",function(){a.onAddData()}),this.tilesData.on("remove",function(){a.dataLoadIndex--}),Wlj.memorise.Tile.superclass.constructor.call(this),this.renderIndex=0,this.dataLoadIndex=0,this.loading=!1,this.dataLoading=!1},Ext.extend(Wlj.memorise.Tile,Ext.util.Observable,{addTile:function(a){this.tiles.add(a)},addDataCfg:function(a){this.tilesData.add(a)},loadJs:function(){var b,c,a=this;return a.loading=!0,(b=a.tiles.itemAt(a.renderIndex))?(b.jsUrl&&b.tileSize?(c=b.el.getViewSize(!1),Ext.Ajax.request({method:"get",url:basepath+b.jsUrl,success:function(d){b.removeAll(),b.contentObject=window.eval?window.eval(d.responseText):window.execScript(d.responseText),b.contentObject&&(Ext.isArray(b.contentObject)?Ext.each(b.contentObject,function(a){a.setSize(c.width,c.height)}):b.contentObject.setSize(c.width,c.height),b.add(b.contentObject),b.doLayout()),a.renderIndex++,a.loadJs()},failure:function(){a.renderIndex++,a.loadJs()}})):(a.renderIndex++,a.loadJs()),void 0):(a.loading=!1,a.loadData(),!1)},loadData:function(){function c(c){a.dataLoadIndex++,Ext.isFunction(b.dataCb)&&b.dataCb.call(b.controlPanel,b.controlPanel,c),a.loadData()}var b,a=this;return a.dataLoading=!0,(b=a.tilesData.itemAt(a.dataLoadIndex))?(b.store?b.store.load({params:{start:0,limit:b.controlPanel.dataSize?b.controlPanel.dataSize:7},callback:function(){c()}}):(Ext.apply(b,{success:function(a){c(a.responseText)},failure:function(){c()}}),Ext.Ajax.request(b)),void 0):(a.dataLoading=!1,!1)},onAddData:function(){var b=this;b.loading||b.dataLoading||b.loadData()},onAdd:function(){var b=this;b.loading||b.loadJs()},getTileBy:function(){}}),Wlj.memorise.TileController=new Wlj.memorise.Tile,Wlj.TileMgr=Wlj.memorise.TileController,Wlj.memorise.Task=function(){this.taskIdGen="task_tile_",this.tasks=new Ext.util.MixedCollection;var a=this;this.tasks.on("add",function(b,c){a.onAddTask(c)})},Ext.extend(Wlj.memorise.Task,Ext.util.Observable,{addTask:function(a){this.tasks.add(a)},removeTask:function(a){if(this.windowObject){var b=this.windowObject.get(this.taskIdGen+a.id);b&&b.ownerCt.remove(b,!0)}this.tasks.remove(a)},getTask:function(a){return this.tasks.get(a)},onAddTask:function(a){this.toFront(),this.windowObject&&(this.windowObject.add(this.createTaskTile(a,!1)),this.windowObject.doLayout())},toFront:function(){this.windowObject&&this.windowObject.toFront()},createTaskTile:function(a,b){var c=this,d=new Wlj.widgets.search.tile.Tile({id:c.taskIdGen+a.id,cls:"tile_c1",baseMargin:2,ownerW:10,ownerH:20,baseSize:682,baseHeight:34,baseWidth:20,taskObject:a,pos_size:{TX:0,TY:c.tasks.indexOf(a),TH:1,TW:1},html:"<br>&nbsp;"+a.name,listeners:{afterrender:function(a){var c=b?150*a.ownerCt.items.indexOf(a):0;setTimeout(function(){a.el.animate({width:{from:20,to:682}},.35,null,"easeOut","run")},c)}},removeThis:function(){var d,e,b=this.ownerCt.items.indexOf(this),c=this.ownerCt;for(this.ownerCt.remove(this,!0),d=b;d<c.items.getCount();d++)e=c.items.itemAt(d),e.moveToPoint({x:e.pos_size.TX,y:e.pos_size.TY-1});a.close()}});return d},showTasks:function(){function b(){var b=[];return a.tasks.each(function(c){b.push(a.createTaskTile(c,!0))}),b}var a=this;return this.windowObject?(this.windowObject.toFront(!0),void 0):(this.windowObject=new Ext.Window({id:"_TASK_MANAGER",top:200,left:200,title:"任务管理器",height:400,width:700,appObject:_APP,manager:_APP.taskBar.windowManager}),this.windowObject.on("show",function(a){a.add(b()),a.doLayout()}),this.windowObject.on("close",function(){a.windowObject=!1}),this.windowObject.show(),void 0)}}),Wlj.memorise.TaskController=new Wlj.memorise.Task,Wlj.TaskMgr=Wlj.memorise.TaskController,Wlj.memorise.Service=function(){this.services=new Ext.util.MixedCollection},Ext.extend(Wlj.memorise.Service,Ext.util.Observable,{addService:function(a){this.services.add(a)},removeService:function(){},stopService:function(){},createServiceWindow:function(){function c(){var b=[];return a.services.each(function(c){var g,d=a.services.indexOf(c);parseInt(d/7),parseInt(d%7),g=new Wlj.widgets.search.service.PageServiceItem({ownerH:20,ownerW:100,serviceObject:c}),b.push(g)}),b}var a=this,b=parseInt(a.services.getCount()/7)+1;this.serviceWindow=new Ext.Window({maximized:!0,closeAction:"hide",autoScroll:!0,title:"服务管理器",items:[new Wlj.widgets.search.service.PageServiceContainer({width:68*b,items:c()})],listeners:{hide:function(){Ext.getBody().unmask()}}})},showServiceWindow:function(){this.serviceWindow||this.createServiceWindow(),Ext.getBody().mask(),this.serviceWindow.show(),this.serviceWindow.el.setOpacity(.9)},findServiceByID:function(a){return this.services.get("service_"+a)}}),Wlj.memorise.ServiceController=new Wlj.memorise.Service,Wlj.ServiceMgr=Wlj.memorise.ServiceController,Ext.ns("Wlj.widgets.search.tile"),Wlj.widgets.search.tile.TileContainer=Ext.extend(Ext.Container,{cls:"layout layout_tile",innerTpl:new Ext.XTemplate(' <div class="layout_contents" >',"</div>"),layoutEl:!1,scrolling:!1,scrollIndex:0,onRender:function(a,b){Wlj.widgets.search.tile.TileContainer.superclass.onRender.call(this,a,b),this.layoutEl=this.innerTpl.append(this.el);var c=this;this.el.on("mousewheel",function(a){var b=a.getWheelDelta();c.scroll(b)}),this.el.on("contextmenu",function(a){a.stopEvent(),c.onContextMenu(a,[])})},initComponent:function(){Wlj.widgets.search.tile.TileContainer.superclass.initComponent.call(this)},getLayoutTarget:function(){return this.layoutEl},listeners:{show:function(a){a.scrollIndex=0}},scroll:function(a){var b=this;if(this.scrolling)return!1;if(this.scrolling=!0,0>a&&this.scrollIndex<this.items.getCount()-1)this.scrollIndex++;else{if(!(a>0&&this.scrollIndex>0))return b.scrolling=!1,void 0;this.scrollIndex--}this.el.scrollTo("left",836*this.scrollIndex,!0),setTimeout(function(){b.scrolling=!1},350)},onContextMenu:function(a,b){var d,c=Wlj.search.App.CONTEXT_MENU.TILE_CONTAINER;b.length>0&&c.length>0&&b.push("-"),d=this,c.length>0&&Ext.each(c,function(a){a.handler=a.fn.createDelegate(d),b.push(a)}),this.appObject.onContextMenu(a,b)}}),Ext.reg("tilecontainer",Wlj.widgets.search.tile.TileContainer),Wlj.widgets.search.tile.TileGroup=Ext.extend(Ext.Panel,{baseCls:"layout_position",width:840,tileKeys:[],height:432,groupMargin:27,onRender:function(a,b){Wlj.widgets.search.tile.TileGroup.superclass.onRender.call(this,a,b),this.el.setLeft(this.width*this.index+this.groupMargin*(this.index+1)),this.initEvents();var c=this;this.el.on("contextmenu",function(a){a.stopEvent(),c.onContextMenu(a,[])}),this.el.applyStyles({border:"1px transparent  dashed"})},initEvents:function(){this.dd=new Wlj.widgets.search.tile.GroupDropZone(this,{ddGroup:"tileDrop"})},getTileWithPoint:function(a){var h,i,j,b=a.x,c=a.y,d=this,e=d.items.items,f=e.length,g=[];for(h=0;f>h;h++)i=e[h],j=i.pos_size,b>=j.TX&&b<j.TX+j.TW&&c>=j.TY&&c<j.TY+j.TH&&g.push(i);return g},regTile:function(a,b){if(this.tileKeys||(this.tileKeys={}),!Ext.isArray(a))return!1;var c=this;Ext.each(a,function(a){c.tileKeys[Ext.encode(a)]=b})},unRegTile:function(a){if(!Ext.isArray(a))return!1;var c=this;Ext.each(a,function(a){delete c.tileKeys[Ext.encode(a)]})},getRegedTiles:function(a){var b,c;return Ext.isArray(a)?(b=this,c=[],Ext.each(a,function(a){c.indexOf(b.tileKeys[Ext.encode(a)])<0&&c.push(b.tileKeys[Ext.encode(a)])}),c):!1},onContextMenu:function(a,b){var d,c=Wlj.search.App.CONTEXT_MENU.TILE_GROUP;b.length>0&&c.length>0&&b.push("-"),d=this,c.length>0&&Ext.each(c,function(a){a.handler=a.fn.createDelegate(d),b.push(a)}),this.ownerCt.onContextMenu(a,b)}}),Ext.reg("tilegroup",Wlj.widgets.search.tile.TileGroup),Wlj.widgets.search.tile.TileLayout=Ext.extend(Ext.layout.ContainerLayout,{type:"tilegroup",renderItem:function(a,b,c){Wlj.widgets.search.tile.TileLayout.superclass.renderItem.call(this,a,b,c)},fixPosition:function(a,b){var c=Ext.fly(b).getX(),d=Ext.fly(b).getY();a.el.setX(c+a.el.getX()),a.el.setY(d+a.el.getY())}}),Ext.Container.LAYOUTS["tilegroup"]=Wlj.widgets.search.tile.TileLayout,Wlj.widgets.search.tile.GroupDropZone=Ext.extend(Ext.dd.DropTarget,{constructor:function(a,b){this.group=a,Ext.dd.ScrollManager.register(a.body),Wlj.widgets.search.tile.GroupDropZone.superclass.constructor.call(this,a.body.dom,b),a.el.ddScrollConfig=this.ddScrollConfig},createEvent:function(a,b,c,d,e,f){return{group:this.group,panel:c.panel,columnIndex:d,column:e,position:f,data:c,source:a,rawEvent:b,status:this.dropAllowed}},notifyEnter:function(){this.group.el.applyStyles({border:"1px #d3dbea dashed"})},notifyOut:function(){this.group.el.applyStyles({border:"1px transparent dashed"})},notifyDrop:function(a){var i,j,k,l,m,d=a.tile,e=a.menu,f=a.plugin,g=a.proxy.ghost;d?(d.ownerCt!==this.group&&(d.ownerCt.remove(d,!1),d.el.setLeft(16),d.el.setTop(16),d.pos_size.TX=0,d.pos_size.TY=0,this.group.add(d),this.group.doLayout()),d.moveTo(g.getXY())):e?(i=this.group.ownerCt.items.indexOf(this.group),j=this.group.appObject,k=g.getXY()[0]-this.group.el.getX(),l=g.getXY()[1]-this.group.el.getY(),m={},m.POS_X=Math.floor(k/128),m.POS_Y=Math.floor(l/128),j.createTile(j.createTileCfg(e,m),i),j.tileContainer.doLayout()):f&&(i=this.group.ownerCt.items.indexOf(this.group),j=this.group.appObject,k=g.getXY()[0]-this.group.el.getX(),l=g.getXY()[1]-this.group.el.getY(),m={},m.POS_X=Math.floor(k/128),m.POS_Y=Math.floor(l/128),j.createTile(f.createTileCfg(m),i),j.tileContainer.doLayout())}}),Wlj.widgets.search.tile.Tile=Ext.extend(Ext.Container,{animate:!1,jsUrl:!1,dragable:!0,ddInitType:"render",removeable:!0,enforceHeight:!0,enforceWidth:!0,position:"absolute","float":!1,insertProxy:!1,ownerW:6,ownerH:3,ownerWI:0,ownerHI:0,baseSize:128,baseWidth:!1,baseHeight:!1,baseMargin:4,defaultDDGroup:"tileDrop",tileManaged:!0,tileSize:!1,tileName:!1,tileLogo:!1,autoEl:{tag:"div",cls:"",style:{position:"absolute"}},layoutTpl:new Ext.XTemplate('<div style="overflow-x:hidden;overflow-y:hidden; position: relative;"></div>'),toolTemplate:new Ext.Template('<div style="position:absolute;top:0;right:0; " class="x-tool x-tool-{id}">&#160;</div>'),logoTemplate:new Ext.XTemplate("<div class=tile_fun >","<a href=javascript:void(0); >",'<div class="tile_fun_pic {tileLogo}">',"</div>","<div class=tile_fun_name >","<p title={tileName} >","<i>","{tileName}","</i>","</p>","</div>","</a>","</div>"),pos_size:{TW:1,TH:1,TX:0,TY:0},initPostKey:function(){var a,b;for(this.posKey=[],a=0;a<this.pos_size.TW;a++)for(b=0;b<this.pos_size.TH;b++)this.posKey.push({x:this.pos_size.TX+a,y:this.pos_size.TY+b})},initComponent:function(){this.float&&(this.style||(this.style={}),this.style.float=this.float,this.style.position="relative",this.style.margin=this.baseMargin+"px"),Wlj.widgets.search.tile.Tile.superclass.initComponent.call(this),this.baseWidth=this.baseWidth?this.baseWidth:this.baseSize,this.baseHeight=this.baseHeight?this.baseHeight:this.baseSize,this.addEvents("beforeberemoved","beremoved")},onRender:function(a,b){Wlj.widgets.search.tile.Tile.superclass.onRender.call(this,a,b),this.float||this.buildTilePosition(),this.buildTileSize(),this.animate=new Wlj.widgets.search.tile.Tile.Animate(this),this.JsLoader=Ext.ScriptLoader,this.initPostKey(),this.layoutEl=this.layoutTpl.append(this.el),this.dragable&&"render"===this.ddInitType&&(this.dd=new Wlj.widgets.search.tile.Tile.DD(this,{ddGroup:this.defaultDDGroup,insertProxy:this.insertProxy}))},afterRender:function(){var a,b,c;Wlj.widgets.search.tile.Tile.superclass.afterRender.call(this),a=this,this.el.on("mousedown",function(b){a.dragable&&!a.dd&&(a.dd=new Wlj.widgets.search.tile.Tile.DD(a,{ddGroup:a.defaultDDGroup,insertProxy:a.insertProxy}),a.dd.handleMouseDown(b,a.dd))}),this.tileSize||this.tileLogo&&(this.logo=this.logoTemplate.append(this.getLayoutTarget(),{tileLogo:this.tileLogo,tileName:this.tileName}),Ext.fly(this.logo).on("click",function(){a.clickFire()})),this.tileManaged&&Wlj.TileMgr.addTile(this),a=this,this.removeable&&(b="x-tool-unpin",c=this.toolTemplate.insertFirst(this.el,{id:"pin"}),c.style.zIndex=15e3,Ext.fly(c).addClassOnOver(b),Ext.fly(c).animate({opacity:{to:0,from:1}},1),Ext.fly(c).on("mouseover",function(a,b){a.stopEvent(),Ext.fly(b).animate({opacity:{to:1,from:0}},1)}),Ext.fly(c).on("mouseout",function(a,b){a.stopEvent(),Ext.fly(b).animate({opacity:{to:0,from:1}},1)}),Ext.fly(c).on("click",function(b){b.stopEvent(),a.removeThis()}),a.removeTool=c)},moveTo:function(a){var c=this,d=c.getXYOrder(a);this.ownerCt.getRegedTiles(this.posKey),c.moveToPoint(d),this.initPostKey()},moveToPoint:function(a,b){var e,f,g,c=this,d=c.initPosition();c.pos_size.TX=a.x,c.pos_size.TY=a.y,c.fixPos(),e=c.initPosition(),f=e.x-d.x,g=e.y-d.y,this.animate.moveWithRaletive(f,g,b)},forcedMove:function(){},getXYOrder:function(a){var b=a[0]-this.ownerCt.el.getX(),c=a[1]-this.ownerCt.el.getY(),d={};return d.x=Math.floor(b/this.baseWidth),d.y=Math.floor(c/this.baseHeight),d},buildTilePosition:function(){this.el.setPositioning({position:this.position}),this.fixPos(),this.el.setLeft(this.initPosition().x),this.el.setTop(this.initPosition().y)},buildTileSize:function(){this.enforceHeight&&(this.el.dom.style.height=this.getSize().height+"px"),this.enforceWidth&&(this.el.dom.style.width=this.getSize().width+"px")},getSize:function(){var a=this.pos_size.TW,b=this.pos_size.TH;return{width:a*this.baseWidth+2*this.baseMargin*(a-1),height:b*this.baseHeight+2*this.baseMargin*(b-1)}},setSize:function(a){a&&(a.width||a.height)&&(Ext.isNumber(a.width)||Ext.isNumber(a.height))&&(Ext.isNumber(a.width)&&(this.pos_size.TW=a.width),Ext.isNumber(a.height)&&(this.pos_size.TH=a.height),this.buildTileSize())},initPosition:function(){var a=this.pos_size.TX,b=this.pos_size.TY;return{x:a*this.baseWidth+(a+2)*2*this.baseMargin,y:b*this.baseHeight+(b+2)*2*this.baseMargin}},setPosition:function(a){var c,b=this.initPosition();a&&(a.x||a.y)&&(Ext.isNumber(a.x)||Ext.isNumber(a.y))&&(Ext.isNumber(a.x)&&(this.pos_size.TX=a.x),Ext.isNumber(a.y)&&(this.pos_size.TY=a.y),c=this.initPosition(),this.el.moveTo(c.x-b.x,c.y-b.y,!0))},fixPos:function(){var a=this,b=this.ownerWI,c=this.ownerHI;a.pos_size.TX<b&&(a.pos_size.TX=b),a.pos_size.TY<c&&(a.pos_size.TY=c),a.pos_size.TY+a.pos_size.TH>a.ownerH&&(a.pos_size.TY=a.ownerH-a.pos_size.TH),a.pos_size.TX+a.pos_size.TW>a.ownerW&&(a.pos_size.TX=a.ownerW-a.pos_size.TW)},createGhost:function(a,b,c){var e,d=document.createElement("div");return d.className="x-panel-ghost "+(a?a:""),this.header&&d.appendChild(this.el.dom.firstChild.cloneNode(!0)),Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.getSize().height),d.style.width=this.el.dom.offsetWidth+"px",c?Ext.getDom(c).appendChild(d):this.container.dom.appendChild(d),b!==!1&&this.el.shim!==!1?(e=new Ext.Layer({shadow:!1,useDisplay:!0,constrain:!1},d),e.show(),e):new Ext.Element(d)},removeThis:function(){var a=this;try{a.animate.fadeOut(),setTimeout(function(){a.ownerCt?a.ownerCt.remove(a,!0):a.destroy()},1e3)}catch(b){}},clickFire:function(){var a=this;a.menuData&&a.menuData.ACTION&&"0"!=a.menuData.ACTION&&Wlj.ServiceMgr.findServiceByID(this.menuData.ID).execute()},getLayoutTarget:function(){return this.layoutEl},destroy:function(){this.dd&&this.dd.destroy(),this.animate&&Ext.destroy(this.animate),this.removeAll(),this.purgeListeners(),this.el.removeAllListeners(),Ext.fly(this.layoutEl).remove(),this.logo&&(Ext.fly(this.logo).removeAllListeners(),Ext.fly(this.logo).remove()),this.removeTool&&(Ext.fly(this.removeTool).removeAllListeners(),Ext.fly(this.removeTool).remove()),this.tileManaged,Wlj.widgets.search.tile.Tile.superclass.destroy.call(this)}}),Ext.reg("tile",Wlj.widgets.search.tile.Tile),Wlj.widgets.search.tile.NegaLayout=Ext.extend(Ext.layout.CardLayout,{renderHidden:!1,setActiveItem:function(a){var b=this.activeItem,c=this.container;a=c.getComponent(a),a&&b!=a&&(this.activeItem=a,delete a.deferLayout,Ext.fly(c.layoutEl).scrollTo("top",c.items.indexOf(a)*c.el.getHeight(),!0),a.fireEvent("activate",a))},configureItem:function(a){a&&this.container.el.getHeight()>0&&a.setSize(this.container.el.getViewSize())},getLayoutTargetSize:function(){return this.container.el.getViewSize()}}),Ext.Container.LAYOUTS["nega"]=Wlj.widgets.search.tile.NegaLayout,Wlj.widgets.search.tile.NegativeTile=Ext.extend(Wlj.widgets.search.tile.Tile,{negativeConfig:!1,layout:"nega",interval:1e3,intervalId:!1,initComponent:function(){Wlj.widgets.search.tile.NegativeTile.superclass.initComponent.call(this),this.on("afterlayout",this.reRunInterval)},onRender:function(a,b){Wlj.widgets.search.tile.NegativeTile.superclass.onRender.call(this,a,b)},afterRender:function(){Wlj.widgets.search.tile.NegativeTile.superclass.afterRender.call(this),this.layout.setActiveItem(0),this.el.on("mouseover",this.clearInterval.createDelegate(this)),this.el.on("mouseout",this.reRunInterval.createDelegate(this))},scrollToNext:function(){var a=this.items.getCount(),b=this.items.indexOf(this.layout.activeItem);a-1>b?b++:b=0,this.layout.setActiveItem(b)},clearInterval:function(){clearInterval(this.intervalId),this.intervalId=!1},setInterval:function(){var a=this.interval,b=this;this.items.getCount()>1&&(b.intervalId=setInterval(function(){b.scrollToNext()},a))},reRunInterval:function(){var a=this;a.intervalId!==!1&&a.clearInterval(),a.setInterval()}}),Ext.reg("negatile",Wlj.widgets.search.tile.NegativeTile),Wlj.widgets.search.tile.ResizeTile=Ext.extend(Wlj.widgets.search.tile.NegativeTile,{enableResize:!0,afterRender:function(){Wlj.widgets.search.tile.ResizeTile.superclass.afterRender.call(this),this.enableResize&&this.createResizable()},createResizable:function(){this.RESIZEABLE=new Wlj.widgets.search.tile.ResizeTile.Resizeable(this.el,{}),this.RESIZEABLE.on("resize",this.onresize.createDelegate(this))},onresize:function(){}}),Ext.reg("resizetile",Wlj.widgets.search.tile.ResizeTile),Wlj.widgets.search.tile.ResizeTile.Resizeable=Ext.extend(Ext.Resizable,{constructor:function(a,b){Wlj.widgets.search.tile.ResizeTile.Resizeable.superclass.constructor.call(this,a,b)},handles:"se",preserveRatio:!0,minWidth:50,minHeight:50,dynamic:!0}),Wlj.widgets.search.tile.IndexTile=Ext.extend(Wlj.widgets.search.tile.ResizeTile,{enableResize:!1,enableTransSize:!0,resizeTemplate:new Ext.Template('<div style="position:absolute;bottom:0;right:0; " class="x-tool x-tool-{id}">&#160;</div>'),initComponent:function(){Wlj.widgets.search.tile.IndexTile.superclass.initComponent.call(this);var a=this.appObject.translateSize(this.tileSize);(void 0==a.TH||void 0==a.TW||1==a.TW&&1==a.TH)&&(this.jsUrl=!1,this.tileSize=!1)},afterRender:function(){var a,b;Ext.fly(this.layoutEl).setSize(this.el.getViewSize()),Wlj.widgets.search.tile.IndexTile.superclass.afterRender.call(this),Ext.isEmpty(this.menuData.SUPPORT_SIZE_URL)&&(this.enableTransSize=!1),a=this,this.enableTransSize&&(this.supported=Ext.unzipString(this.menuData.SUPPORT_SIZE_URL,",","|"),b=this.resizeTemplate.insertFirst(this.el,{id:"refresh"}),b.style.zIndex=15e3,Ext.fly(b).animate({opacity:{to:0,from:1}},1),Ext.fly(b).on("mouseover",function(a,b){a.stopEvent(),Ext.fly(b).animate({opacity:{to:1,from:0}},1)}),Ext.fly(b).on("mouseout",function(a,b){a.stopEvent(),Ext.fly(b).animate({opacity:{to:0,from:1}},1)}),Ext.fly(b).on("click",function(b){b.stopEvent(),a.resize()})),this.el.on("contextmenu",function(b){b.stopEvent(),a.onContextMenu(b,[])})},resize:function(){var b,c,d,e,a=-1;for(b=0;b<this.supported.length;b++)this.supported[b][0]===this.tileSize&&(a=b);c=!1,d=!1,a<this.supported.length-1&&(c=this.supported[a+1][0],d=this.supported[a+1][1]),this.tileSize=c,e=this.appObject.translateSize(c),this.pos_size.TW=e.TW,this.pos_size.TH=e.TH,this.jsUrl=d,this.reBuiltTile()},reBuiltTile:function(){if(delete this.contentObject,this.clearTileContent(),this.buildTileSize(),Ext.fly(this.getLayoutTarget()).applyStyles({height:this.el.getHeight(),width:this.el.getWidth()}),!this.tileSize&&this.tileLogo){var a=this.logoTemplate.append(this.getLayoutTarget(),{tileLogo:this.tileLogo,tileName:this.tileName});Ext.fly(a).on("click",function(){_this.clickFire()})}Wlj.TileMgr.tiles.remove(this),Wlj.TileMgr.addTile(this)},clearTileContent:function(){this.removeAll(),this.doLayout(),this.getLayoutTarget().innerHTML=""},onContextMenu:function(a,b){var d,c=Wlj.search.App.CONTEXT_MENU.INDEX_TILE;b.length>0&&c.length>0&&b.push("-"),d=this,c.length>0&&Ext.each(c,function(a){a.handler=a.fn.createDelegate(d),b.push(a)}),this.ownerCt.onContextMenu(a,b)}}),Ext.reg("indextile",Wlj.widgets.search.tile.IndexTile),Wlj.widgets.search.tile.EditTile=Ext.extend(Wlj.widgets.search.tile.Tile,{tileManaged:!1,tileLogo:!1,baseSize:300,hideLabel:!0,innerTextTpl:new Ext.XTemplate("<div>{valueText}</div>"),initComponent:function(){Wlj.widgets.search.tile.EditTile.superclass.initComponent.call(this),delete this.html;var a=this;this.contentArea=new Ext.form.TextArea({preventScrollbars:!1,width:this.baseSize*this.pos_size.TW,height:this.baseSize*this.pos_size.TH,listeners:{blur:function(b){b.hide(),a.onAreaBlur(b)
}}})},onRender:function(a,b){Wlj.widgets.search.tile.EditTile.superclass.onRender.call(this,a,b),this.contentArea.render(this.el),this.contentArea.hide();var c=this;this.el.on("dblclick",function(){c.contentArea.show(),c.contentArea.focus(),c.contentArea.setValue(this.valueText)}),this.on("resize",this.onresize)},onresize:function(a,b,c){this.contentArea.setHeight(c),this.contentArea.setWidth(b)},onAreaBlur:function(a){this.valueText=a.getValue(),this.innerHtml&&Ext.fly(this.innerHtml).remove(),delete this.innerHtml,this.innerHtml=this.innerTextTpl.append(this.el,{valueText:this.valueText})}}),Wlj.widgets.search.tile.TileProxy=Ext.extend(Object,{constructor:function(a,b){this.tile=a,this.id=this.tile.id+"-ddproxy",Ext.apply(this,b)},insertProxy:!1,setStatus:Ext.emptyFn,reset:Ext.emptyFn,update:Ext.emptyFn,stop:Ext.emptyFn,sync:Ext.emptyFn,getEl:function(){return this.ghost},getGhost:function(){return this.ghost},getProxy:function(){return this.proxy},hide:function(){this.ghost&&(this.proxy&&(this.proxy.remove(),delete this.proxy),this.tile.el.dom.style.display="",this.ghost.remove(),delete this.ghost)},show:function(){this.ghost||(this.ghost=this.tile.createGhost(this.tile.initialConfig.cls,void 0,Ext.getBody()),this.ghost.setXY(this.tile.el.getXY()),this.insertProxy&&(this.proxy=this.tile.el.insertSibling({cls:"tile"}),this.proxy.setSize(this.tile.getSize())),this.tile.el.dom.style.display="none")},repair:function(a,b,c){this.hide(),"function"==typeof b&&b.call(c||this)},moveProxy:function(a,b){this.proxy&&a.insertBefore(this.proxy.dom,b)}}),Wlj.widgets.search.tile.Tile.DD=Ext.extend(Ext.dd.DragSource,{constructor:function(a,b){this.tile=a,this.dragData={tile:a},this.proxy=new Wlj.widgets.search.tile.TileProxy(a,b),Wlj.widgets.search.tile.Tile.DD.superclass.constructor.call(this,a.el,b);var c=a.header,d=a.el;c&&(this.setHandleElId(c.id),d=a.header),this.scroll=!1},showFrame:Ext.emptyFn,startDrag:Ext.emptyFn,b4StartDrag:function(){this.proxy.show()},b4MouseDown:function(a){var b=a.getPageX(),c=a.getPageY();this.autoOffset(b,c)},onInitDrag:function(a,b){return this.onStartDrag(a,b),!0},createFrame:Ext.emptyFn,getDragEl:function(){return this.proxy.ghost.dom},endDrag:function(){this.proxy.hide(),this.tile.saveState()},autoOffset:function(a,b){a-=this.startPageX,b-=this.startPageY,this.setDelta(a,b)},onDrag:function(){}}),Wlj.widgets.search.tile.Tile.Animate=function(a){this.tile=a,this.el=a.el,Wlj.widgets.search.tile.Tile.Animate.superclass.constructor.call(this)},Ext.extend(Wlj.widgets.search.tile.Tile.Animate,Ext.util.Observable,{defaultAnim:{duration:300},fadeIn:function(){this.el.fadeIn(300)},fadeOut:function(){this.el.fadeOut(300)},moveWithRaletive:function(a,b,c){function i(){var n,o,i=new Date,k=i-d,l=k/e;if(l>=1){if(f.el.dom&&f.el.applyStyles({top:g.y+"px",left:g.x+"px"}),Ext.TaskMgr.stop(j),Ext.isFunction(c))try{c(f.tile)}catch(m){}}else if(n=l*b,o=l*a,f.el.dom)f.el.applyStyles({top:n+h.y+"px",left:o+h.x+"px"});else if(Ext.TaskMgr.stop(j),Ext.isFunction(c))try{c(f.tile)}catch(m){}}var d,e,f,g,h,j;this.el.dom&&(d=new Date,e=this.defaultAnim.duration,f=this,g=f.tile.initPosition(),h={x:parseInt(f.el.dom.style.left),y:parseInt(f.el.dom.style.top)},j={run:i,interval:20,scope:this},Ext.TaskMgr.start(j))},moveWithAbsolute:function(a,b){var c=this.el.getLeft(),d=this.el.getTop();this.moveWithRaletive(a-c,b-d)},moveWithMargin:function(){}}),Ext.ns("Wlj.error"),Wlj.error.debugerConfig={consoleInPage:!!Wlj.frame.functions.app.Util.needConsoleInPage,consoleInNavigator:!!Wlj.frame.functions.app.Util.needConsoleInNavigator,ERROR:!!Wlj.frame.functions.app.Util.needError,WARN:!!Wlj.frame.functions.app.Util.needWarn,INFO:!!Wlj.frame.functions.app.Util.needInfo,DEBUG:!!Wlj.frame.functions.app.Util.needDebug,logLineLimit:100,initLogTool:function(){Wlj.error.debugerConfig.ERROR||(Ext.error=Ext.emptyFn),Wlj.error.debugerConfig.WARN||(Ext.warn=Ext.emptyFn),Wlj.error.debugerConfig.INFO||(Ext.log=Ext.emptyFn),Wlj.error.debugerConfig.DEBUG||(Ext.debug=Ext.emptyFn)}},JDEBUG=Wlj.error.debugerConfig,Wlj.error.J_ERRORS={J_NEVERDEFINE:"变量未定义"},JERROR=Wlj.error.J_ERRORS,Wlj.error.W_ERRORS={NORESIDERROR:"无resId属性",NOCODEFILEERROR:"无页面文件"},WERROR=Wlj.error.W_ERRORS,Ext.debugImg={warnImg:basepath+"/contents/wljFrontFrame/styles/common/commonpics/warn.gif",errorImg:basepath+"/contents/wljFrontFrame/styles/common/commonpics/error.gif",debugImg:basepath+"/contents/wljFrontFrame/styles/common/commonpics/info.png"},function(){function b(){function e(){var b=Ext.getBody(),c=b.getViewSize();c.height<b.dom.scrollHeight&&(c.width-=18),a.setWidth(c.width)}var b=new Ext.debug.ScriptsPanel,c=new Ext.debug.LogPanel,d=new Ext.TabPanel({activeTab:0,border:!1,tabPosition:"bottom",items:[{title:"Debug Console",layout:"border",items:[c,b]}]});a=new Ext.Panel({id:"x-debug-browser",title:"Console",collapsible:!0,animCollapse:!1,style:"position:absolute;left:0;bottom:0;z-index:101",height:200,logView:c,scriptPanel:b,layout:"fit",tbar:[{text:"clear",handler:function(){Ext.clearLog()}}],tools:[{id:"maximize",handler:function(){a.expand(),a.setHeight(Ext.getBody().getViewSize().height),a.getTool("maximize").hide(),a.getTool("minimize").show()}},{id:"minimize",hidden:!0,handler:function(){a.expand(),a.setHeight(200),a.getTool("maximize").show(),a.getTool("minimize").hide()}},{id:"close",handler:function(){a.destroy(),a=null,Ext.EventManager.removeResizeListener(e)}}],items:d}),a.render(Ext.getBody()),a.resizer=new Ext.Resizable(a.el,{minHeight:50,handles:"n",pinned:!0,transparent:!0,resizeElement:function(){var b=this.proxy.getBox();return this.proxy.hide(),a.setHeight(b.height),b}}),Ext.EventManager.onWindowResize(e),e()}var a;Ext.apply(Ext,{log:function(){Wlj.error.debugerConfig.consoleInPage&&(a||b(),a.logView.log.apply(a.logView,arguments)),Wlj.error.debugerConfig.consoleInNavigator&&window.console&&console.info(Array.prototype.join.call(arguments,", "))},warn:function(){Wlj.error.debugerConfig.consoleInPage&&(a||b(),a.logView.warn.apply(a.logView,arguments)),Wlj.error.debugerConfig.consoleInNavigator&&window.console&&console.warn(Array.prototype.join.call(arguments,", "))},error:function(){Wlj.error.debugerConfig.consoleInPage&&(a||b(),a.logView.error.apply(a.logView,arguments)),Wlj.error.debugerConfig.consoleInNavigator&&window.console&&console.error(Array.prototype.join.call(arguments,", "))},debug:function(c){if(Wlj.error.debugerConfig.consoleInPage&&(a||b(),a.logView.debug.apply(a.logView,[c])),Wlj.error.debugerConfig.consoleInNavigator&&window.console){var d=Ext.isObject(c)?Ext.encode(c):c;console.log(d)}},showCode:function(c){a||b(),a.scriptPanel.scriptField.setValue(c)},clearLog:function(){a&&a.logView.clear()},logf:function(){Ext.log(String.format.apply(String,arguments))},dump:function(a){var b,c,d,e;if("string"==typeof a||"number"==typeof a||"undefined"==typeof a||Ext.isDate(a))Ext.log(a);else if(a)if("object"!=typeof a)Ext.log("Unknown return type");else if(Ext.isArray(a))Ext.log("["+a.join(",")+"]");else{b=["{\n"];for(c in a)d=typeof a[c],"function"!=d&&"object"!=d&&b.push(String.format("  {0}: {1},\n",c,a[c]));e=b.join(""),e.length>3&&(e=e.substr(0,e.length-2)),Ext.log(e+"\n}")}else Ext.log("null")},_timers:{},time:function(a){a=a||"def",Ext._timers[a]=(new Date).getTime()},timeEnd:function(a,b){var d,c=(new Date).getTime();return a=a||"def",d=String.format("{0} ms",c-Ext._timers[a]),Ext._timers[a]=(new Date).getTime(),b!==!1&&Ext.log("Timer "+("def"==a?d:a+": "+d)),d}}),Wlj.error.debugerConfig.initLogTool()}(),Ext.debug.ScriptsPanel=Ext.extend(Ext.Panel,{id:"x-debug-scripts",region:"east",minWidth:200,split:!0,width:350,border:!1,layout:"anchor",style:"border-width:0 0 0 1px;",initComponent:function(){this.scriptField=new Ext.form.TextArea({anchor:"100% -26",style:"border-width:0;"}),this.trapBox=new Ext.form.Checkbox({id:"console-trap",boxLabel:"Trap Errors",checked:!0}),this.toolbar=new Ext.Toolbar([{text:"Run",scope:this,handler:this.evalScript},{text:"Clear",scope:this,handler:this.clear},"->",this.trapBox," "," "]),this.items=[this.toolbar,this.scriptField],Ext.debug.ScriptsPanel.superclass.initComponent.call(this)},evalScript:function(){var rt,s=this.scriptField.getValue();if(this.trapBox.getValue())try{rt=eval(s),Ext.dump(void 0===rt?"(no return)":rt)}catch(e){Ext.log(e.message||e.descript)}else rt=eval(s),Ext.dump(void 0===rt?"(no return)":rt)},clear:function(){this.scriptField.setValue(""),this.scriptField.focus()}}),Ext.debug.LogPanel=Ext.extend(Ext.Panel,{autoScroll:!0,region:"center",border:!1,style:"border-width:0 1px 0 0",log:function(){var a=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',"【Info】",Ext.util.Format.htmlEncode(Array.prototype.join.call(arguments,", ")).replace(/\n/g,"<br/>").replace(/\s/g,"&#160;"),"</div>"].join(""),b=this.body.dom;this.body.insertHtml("beforeend",a),b.scrollTop=b.scrollHeight},warn:function(){var a=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',"<img src="+Ext.debugImg.warnImg+" />",Ext.util.Format.htmlEncode(Array.prototype.join.call(arguments,", ")).replace(/\n/g,"<br/>").replace(/\s/g,"&#160;"),"</div>"].join(""),b=this.body.dom;this.body.insertHtml("beforeend",a),b.scrollTop=b.scrollHeight},error:function(){var a=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',"<img src="+Ext.debugImg.errorImg+" />",Ext.util.Format.htmlEncode(Array.prototype.join.call(arguments,", ")).replace(/\n/g,"<br/>").replace(/\s/g,"&#160;"),"</div>"].join(""),b=this.body.dom;this.body.insertHtml("beforeend",a),b.scrollTop=b.scrollHeight},debug:function(a){var b=Ext.isObject(a)?Ext.encode(a):a,c=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',"<img src="+Ext.debugImg.debugImg+" />",b,"</div>"].join(""),d=this.body.dom;this.body.insertHtml("beforeend",c),d.scrollTop=d.scrollHeight},clear:function(){this.body.update(""),this.body.dom.scrollTop=0}}),Ext.debug.DomTree=Ext.extend(Ext.tree.TreePanel,{enableDD:!1,lines:!1,rootVisible:!1,animate:!1,hlColor:"ffff9c",autoScroll:!0,region:"center",border:!1,initComponent:function(){var b,c,d,e;Ext.debug.DomTree.superclass.initComponent.call(this),c=/^\s*$/,d=Ext.util.Format.htmlEncode,e=Ext.util.Format.ellipsis,this.loader=new Ext.tree.TreeLoader,this.loader.load=function(a,b){var i,h,f=a.htmlNode==document.body,g=a.htmlNode.childNodes;for(h=0;i=g[h];h++)f&&"x-debug-browser"==i.id||(1==i.nodeType?a.appendChild(new Ext.debug.HtmlNode(i)):3!=i.nodeType||c.test(i.nodeValue)||a.appendChild(new Ext.tree.TreeNode({text:"<em>"+e(d(String(i.nodeValue)),35)+"</em>",cls:"x-tree-noicon"})));b()},this.root=this.setRootNode(new Ext.tree.TreeNode("Ext")),b=this.root.appendChild(new Ext.debug.HtmlNode(document.getElementsByTagName("html")[0]))}}),Ext.debug.ComponentNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{onOver:function(){Ext.debug.ComponentNodeUI.superclass.onOver.call(this);var b=this.node.attributes.component;if(b.el&&b.el.mask&&"x-debug-browser"!=b.id)try{b.el.mask()}catch(a){}},onOut:function(){Ext.debug.ComponentNodeUI.superclass.onOut.call(this);var b=this.node.attributes.component;if(b.el&&b.el.unmask&&"x-debug-browser"!=b.id)try{b.el.unmask()}catch(a){}}}),Ext.debug.ComponentInspector=Ext.extend(Ext.tree.TreePanel,{enableDD:!1,lines:!1,rootVisible:!1,animate:!1,hlColor:"ffff9c",autoScroll:!0,region:"center",border:!1,initComponent:function(){this.loader=new Ext.tree.TreeLoader,this.bbar=new Ext.Toolbar([{text:"Refresh",handler:this.refresh,scope:this}]),Ext.debug.ComponentInspector.superclass.initComponent.call(this),this.root=this.setRootNode(new Ext.tree.TreeNode({text:"Ext Components",component:Ext.ComponentMgr.all,leaf:!1})),this.parseRootNode(),this.on("click",this.onClick,this)},createNode:function(a,b){var c=b.items&&b.items.length>0;return a.appendChild(new Ext.tree.TreeNode({text:b.id+(b.getXType()?" [ "+b.getXType()+" ]":""),component:b,uiProvider:Ext.debug.ComponentNodeUI,leaf:!c}))},parseChildItems:function(a){var c,d,e,b=a.attributes.component.items;if(b)for(c=0;c<b.length;c++)d=b.get(c),d.id!=this.id&&d.id!=this.bottomToolbar.id&&(e=this.createNode(a,d),e.leaf||this.parseChildItems(e))},parseRootNode:function(){var d,c,e,a=this.root,b=a.attributes.component.items;for(c=0;d=b[c];c++)d.id!=this.id&&d.id!=this.bottomToolbar.id&&(d.ownerCt||(e=this.createNode(a,d),e.leaf||this.parseChildItems(e)))},onClick:function(a){var c=Ext.getCmp("x-debug-objinspector");c.refreshNodes(a.attributes.component),c.ownerCt.show()},refresh:function(){for(;this.root.firstChild;)this.root.removeChild(this.root.firstChild);this.parseRootNode();var a=Ext.getCmp("x-debug-compinfo");a&&a.message("refreshed component tree - "+Ext.ComponentMgr.all.length)}}),Ext.debug.ComponentInfoPanel=Ext.extend(Ext.Panel,{id:"x-debug-compinfo",region:"east",minWidth:200,split:!0,width:350,border:!1,autoScroll:!0,layout:"anchor",style:"border-width:0 0 0 1px;",initComponent:function(){this.watchBox=new Ext.form.Checkbox({id:"x-debug-watchcomp",boxLabel:"Watch ComponentMgr",listeners:{check:function(a,b){b?(Ext.ComponentMgr.all.on("add",this.onAdd,this),Ext.ComponentMgr.all.on("remove",this.onRemove,this)):(Ext.ComponentMgr.all.un("add",this.onAdd,this),Ext.ComponentMgr.all.un("remove",this.onRemove,this))},scope:this}}),this.tbar=new Ext.Toolbar([{text:"Clear",handler:this.clear,scope:this},"->",this.watchBox]),Ext.debug.ComponentInfoPanel.superclass.initComponent.call(this)},onAdd:function(a,b){var d=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',"Added: "+b.id,"</div>"].join("");this.insertMarkup(d)},onRemove:function(a){var c=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',"Removed: "+a.id,"</div>"].join("");this.insertMarkup(c)},message:function(a){var b=['<div style="padding:5px !important;border-bottom:1px solid #ccc;">',a,"</div>"].join("");this.insertMarkup(b)},insertMarkup:function(a){this.body.insertHtml("beforeend",a),this.body.scrollTo("top",1e5)},clear:function(){this.body.update(""),this.body.dom.scrollTop=0}}),Ext.debug.ColumnNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{focus:Ext.emptyFn,renderElements:function(a,b,c,d){var e,f,g,h,i,j,k,l;for(this.indentMarkup=a.parentNode?a.parentNode.ui.getChildIndent():"",e=a.getOwnerTree(),f=e.columns,g=e.borderWidth,h=f[0],i=['<li class="x-tree-node"><div ext:tree-node-id="',a.id,'" class="x-tree-node-el x-tree-node-leaf ',b.cls,'">','<div class="x-tree-col" style="width:',h.width-g,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow"/>','<img src="',b.icon||this.emptyIcon,'" class="x-tree-node-icon',b.icon?" x-tree-node-inline-icon":"",b.iconCls?" "+b.iconCls:"",'" unselectable="on"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',b.href?b.href:"#",'" tabIndex="1" ',b.hrefTarget?' target="'+b.hrefTarget+'"':"",">",'<span unselectable="on">',a.text||(h.renderer?h.renderer(b[h.dataIndex],a,b):b[h.dataIndex]),"</span></a>","</div>"],j=1,k=f.length;k>j;j++)h=f[j],i.push('<div class="x-tree-col ',h.cls?h.cls:"",'" style="width:',h.width-g,'px;">','<div class="x-tree-col-text">',h.renderer?h.renderer(b[h.dataIndex],a,b):b[h.dataIndex],"</div>","</div>");i.push('<div class="x-clear"></div></div>','<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"),this.wrap=d!==!0&&a.nextSibling&&a.nextSibling.ui.getEl()?Ext.DomHelper.insertHtml("beforeBegin",a.nextSibling.ui.getEl(),i.join("")):Ext.DomHelper.insertHtml("beforeEnd",c,i.join("")),this.elNode=this.wrap.childNodes[0],this.ctNode=this.wrap.childNodes[1],l=this.elNode.firstChild.childNodes,this.indentNode=l[0],this.ecNode=l[1],this.iconNode=l[2],this.anchor=l[3],this.textNode=l[3].firstChild}}),Ext.debug.ObjectInspector=Ext.extend(Ext.tree.TreePanel,{id:"x-debug-objinspector",enableDD:!1,lines:!1,rootVisible:!1,animate:!1,hlColor:"ffff9c",autoScroll:!0,region:"center",border:!1,lines:!1,borderWidth:Ext.isBorderBox?0:2,cls:"x-column-tree",initComponent:function(){this.showFunc=!1,this.toggleFunc=function(){this.showFunc=!this.showFunc,this.refreshNodes(this.currentObject)},this.bbar=new Ext.Toolbar([{text:"Show Functions",enableToggle:!0,pressed:!1,handler:this.toggleFunc,scope:this}]),Ext.apply(this,{title:" ",loader:new Ext.tree.TreeLoader,columns:[{header:"Property",width:300,dataIndex:"name"},{header:"Value",width:900,dataIndex:"value"}]}),Ext.debug.ObjectInspector.superclass.initComponent.call(this),this.root=this.setRootNode(new Ext.tree.TreeNode({text:"Dummy Node",leaf:!1})),this.currentObject&&this.parseNodes()},refreshNodes:function(a){this.currentObject=a;for(var b=this.root;b.firstChild;)b.removeChild(b.firstChild);this.parseNodes()},parseNodes:function(){for(var a in this.currentObject)(this.showFunc||!Ext.isFunction(this.currentObject[a]))&&this.createNode(a)},createNode:function(a){return this.root.appendChild(new Ext.tree.TreeNode({name:a,value:this.currentObject[a],uiProvider:Ext.debug.ColumnNodeUI,iconCls:"x-debug-node",leaf:!0}))},onRender:function(){var b,a,c,d,e;for(Ext.debug.ObjectInspector.superclass.onRender.apply(this,arguments),this.headers=this.header.createChild({cls:"x-tree-headers"}),a=this.columns,c=0,d=0,e=a.length;e>d;d++)b=a[d],c+=b.width,this.headers.createChild({cls:"x-tree-hd "+(b.cls?b.cls+"-hd":""),cn:{cls:"x-tree-hd-text",html:b.header},style:"width:"+(b.width-this.borderWidth)+"px;"});this.headers.createChild({cls:"x-clear"}),this.headers.setWidth(c),this.innerCt.setWidth(c)}}),Ext.debug.StoreInspector=Ext.extend(Ext.tree.TreePanel,{enableDD:!1,lines:!1,rootVisible:!1,animate:!1,hlColor:"ffff9c",autoScroll:!0,region:"center",border:!1,initComponent:function(){this.bbar=new Ext.Toolbar([{text:"Refresh",handler:this.refresh,scope:this}]),Ext.debug.StoreInspector.superclass.initComponent.call(this),this.root=this.setRootNode(new Ext.tree.TreeNode({text:"Data Stores",leaf:!1})),this.on("click",this.onClick,this),this.parseStores()},parseStores:function(){var c,b,a=Ext.StoreMgr.items;for(b=0;c=a[b];b++)this.root.appendChild({text:c.storeId+" - "+c.totalLength+" records",component:c,leaf:!0})},onClick:function(a){var c=Ext.getCmp("x-debug-objinspector");c.refreshNodes(a.attributes.component),c.ownerCt.show()},refresh:function(){for(;this.root.firstChild;)this.root.removeChild(this.root.firstChild);this.parseStores()}}),Ext.debug.HtmlNode=function(){function e(a){for(var c,b=0;c=a.childNodes[b];b++)if(1==c.nodeType)return!0;return!1}function f(e,f){var i,j,k,l,m,g=e.tagName.toLowerCase(),h="&lt;"+g;for(i=0,j=d.length;j>i;i++)k=d[i],l=e[k.n],l&&!c.test(l)&&(h+=" "+k.v+"=&quot;<i>"+a(l)+"</i>&quot;");return m=e.style?e.style.cssText:"",m&&(h+=" style=&quot;<i>"+a(m.toLowerCase())+"</i>&quot;"),h+=f&&e.childNodes.length>0?"&gt;<em>"+b(a(String(e.innerHTML)),35)+"</em>&lt;/"+g+"&gt;":f?" /&gt;":"&gt;"}var a=Ext.util.Format.htmlEncode,b=Ext.util.Format.ellipsis,c=/^\s*$/,d=[{n:"id",v:"id"},{n:"className",v:"class"},{n:"name",v:"name"},{n:"type",v:"type"},{n:"src",v:"src"},{n:"href",v:"href"}],g=function(a){var c,b=!e(a);this.htmlNode=a,this.tagName=a.tagName.toLowerCase(),c={text:f(a,b),leaf:b,cls:"x-tree-noicon"},g.superclass.constructor.call(this,c),this.attributes.htmlNode=a,b||(this.on("expand",this.onExpand,this),this.on("collapse",this.onCollapse,this))};return Ext.extend(g,Ext.tree.AsyncTreeNode,{cls:"x-tree-noicon",preventHScroll:!0,refresh:function(a){var b=!e(this.htmlNode);this.setText(f(this.htmlNode,b)),a&&Ext.fly(this.ui.textNode).highlight()},onExpand:function(){!this.closeNode&&this.parentNode?this.closeNode=this.parentNode.insertBefore(new Ext.tree.TreeNode({text:"&lt;/"+this.tagName+"&gt;",cls:"x-tree-noicon"}),this.nextSibling):this.closeNode&&this.closeNode.ui.show()},onCollapse:function(){this.closeNode&&this.closeNode.ui.hide()},render:function(a){g.superclass.render.call(this,a)},highlightNode:function(){},highlight:function(){},frame:function(){this.htmlNode.style.border="1px solid #0000ff"},unframe:function(){this.htmlNode.style.border=""}}),g}(),Ext.ns("Wlj.frame.functions.app.widgets"),Wlj.frame.functions.app.widgets.SearchContainer=Ext.extend(Ext.Panel,{vs:!1,columnCount:4,layout:"fit",WCLP:!1,needCloseLable4DCF:!1,multiSelectSeparator:!1,dyfield:new Array,buttonCfg:{},initComponent:function(){var a=this;a._APP.fireEvent("beforeconditioninit",a,a._APP),this.height=this.vs.height,this.width=this.vs.width,Wlj.frame.functions.app.widgets.SearchContainer.superclass.initComponent.call(this),a._APP.fireEvent("afterconditioninit",a,a._APP),a._APP.fireEvent("beforeconditionrender",a,a._APP)},onRender:function(a,b){var c=this.vs,d=this,e=0;e=c.width>1024?4:3,this.columnCount=e,this.createColumnItems(e),Wlj.frame.functions.app.widgets.SearchContainer.superclass.onRender.call(this,a,b),this.el.on("contextmenu",function(a){a.stopEvent(),d.onContextMenu(a,[])}),d._APP.fireEvent("afterconditionrender",d,d._APP)},destroy:function(){this.dyfield=[],this.purgeListeners(),this.itemsArray=null,this.searchPanel.purgeListeners(),this.searchPanel=null;for(var a in this.buttonCfg)this[a+"Button"]=null,delete this[a+"Button"];this.buttonCfg={},this.DropZone.destroy(),Wlj.frame.functions.app.widgets.SearchContainer.superclass.destroy.call(this)},initEvents:function(){this.addEvents({beforeconditionadd:!0,conditionadd:!0,beforeconditionremove:!0,conditionremove:!0,beforedyfieldclear:!0,afterdyfieldclear:!0,beforecondtitionfieldvalue:!0,condtitionfieldvalue:!0})},createColumnItems:function(a){var d,e,f,g,h,i,j,b=this,c=this.items;if(!c)return!1;if(1>a)return!1;for(d=new Array,e=0;a>e;e++)f={},f.layout="form",f.defaultType="textfield",f.columnWidth=1/a,f.items=[],Ext.each(this.itemsArray,function(c){c.dataType&&WLJDATATYPE[c.dataType]&&(c.xtype=WLJDATATYPE[c.dataType].getFieldXtype(),Ext.applyIf(c,WLJDATATYPE[c.dataType].getFieldSpecialCfg())),b.itemsArray.indexOf(c)%a==e&&((c.cAllowBlank===!1||c.allowBlank===!1)&&(c.allowBlank=!1,c.fieldLabel=WLJTOOL.addBlankFlag(c.text)),c.anchor="90%",f.items.push(c))}),d.push(f);g=b.buttonCfg,h=[];for(i in g)j={},Ext.apply(j,g[i]),j.handler=g[i].fn.createDelegate(this),b[i+"Button"]=new Ext.Button(j),h.push(b[i+"Button"]);b.searchPanel=new Ext.form.FormPanel({frame:!0,layout:"column",items:d,buttons:h,listeners:{afterrender:function(){b.createDynaticSearchTarget(),this.el.on("keydown",function(a){a.ctrlKey||a.altKey||a.keyCode!==a.ENTER||(a.stopEvent(),b.searchHandler())})}}}),b.add(b.searchPanel)},hasConditionButton:function(a){return this[a+"Button"]&&this.searchPanel.buttons.indexOf(this[a+"Button"])>-1?!0:!1},enableConditionButton:function(a){this.hasConditionButton(a)&&this[a+"Button"].enable()},disableConditionButton:function(a){this.hasConditionButton(a)&&this[a+"Button"].disable()},showConditionButton:function(a){this.hasConditionButton(a)&&this[a+"Button"].show()},hideConditionButton:function(a){this.hasConditionButton(a)&&this[a+"Button"].hide()},getNumberedColumn:function(a){var d,e,b=this,c=!0;return c=a?!0:!1,d=b.searchPanel,e=0,d.items.each(function(a){"hidden"!==a.xtype&&a.items&&(c&&a.items.getCount()>d.get(e).items.getCount()?e=d.items.indexOf(a):!c&&a.items.getCount()<d.get(e).items.getCount()&&(e=d.items.indexOf(a)))}),e},fixSearchHeight:function(){var a=this,b=a.searchPanel.items.get(a.getNumberedColumn(!0)).items.getCount();a._APP.setSearchSize({height:39+33*b+6+(a.title?27:0)})},removeAllDyField:function(){var a,b;if(0==this.dyfield.length)return!1;if(a=this.fireEvent("beforedyfieldclear",this,this.searchPanel,this.dyfield),a===!1)return!1;for(;this.dyfield.length>0;)b=this.dyfield.pop(),b.ownerCt.remove(b);this.searchPanel.doLayout(),this.fixSearchHeight(),this.fireEvent("afterdyfieldclear",this,this.searchPanel,this.dyfield)},createDynaticSearchTarget:function(){var a=this;this.DropZone=new Ext.dd.DropTarget(a.searchPanel.el.dom,{ddGroup:"searchDomainDrop",notifyDrop:function(b,c,d){var f,g,e=d.tile.data;e.name&&(f=a.addField(e.name),f.setValue&&(g=a.fireEvent("beforecondtitionfieldvalue",f,e,e.value),g&&(f.setValue(e.value),a.fireEvent("condtitionfieldvalue",f,e,e.value))),Ext.isString(e.text)&&f.setLabelText(e.text))}})},addField:function(a){var d,e,f,b=this,c=b.searchPanel.getForm().findField(a);if(!c){if(d=this.getFieldCfg(a),!d)return!1;if(e=b.getNumberedColumn(!1),f=b.fireEvent("beforeconditionadd",d,e,b.searchPanel),f===!1)return!1;c=b.searchPanel.items.get(e).add(d),b.dyfield.push(c),b.searchPanel.doLayout()}return c},getFieldCfg:function(a){var c,d,b=this;return Ext.isString(a)?(c=b._APP.getFieldsByName(a))?d=b.formatFieldCfg(c):!1:d=b.formatFieldCfg(a)},formatFieldCfg:function(a){var b=this,c={};if(a.translateType){if(c.xtype=a.multiSelect?"lovcombo":"combo",c.store=b._APP.lookupManager[a.translateType],!c.store)return Ext.error("字段【"+a.text+"】数据字典映射项store【"+a.translateType+"】获取错误，请检查[lookupTypes|localLookup]项配置"),!1;c.valueField="key",c.displayField="value",c.editable="boolean"==typeof a.editable?a.editable:!1,c.forceSelection=!0,c.triggerAction="all",c.mode="local",c.hiddenName=a.name,c.separator=a.multiSeparator?a.multiSeparator:b.multiSelectSeparator}else c.name=a.name,a.dataType&&WLJDATATYPE[a.dataType]&&(c.xtype=WLJDATATYPE[a.dataType].getFieldXtype(),Ext.applyIf(c,WLJDATATYPE[a.dataType].getFieldSpecialCfg()));return c.fieldLabel=a.text?a.text:a.name,c.anchor="90%",Ext.applyIf(c,a),delete c.allowBlank,a.cAllowBlank===!1&&(c.allowBlank=!1,c.fieldLabel=WLJTOOL.addBlankFlag(a.text)),c.listeners={afterrender:function(a){var c,d;b.needCloseLable4DCF&&(c=new Ext.Template('<div class="del-searchField"></div>'),d=c.insertFirst(a.el.parent()),a.closeLabel=d,d.style.zIndex=15e3,d.onclick=function(){b.removeField(a)}),b.fixSearchHeight(),b.fireEvent("conditionadd",a,b.searchPanel)}},c},removeField:function(a){var c,d,b=this;if(Ext.isString(a)){if(c=this.searchPanel.getForm().findField(a)){if(d=b.fireEvent("beforeconditionremove",c,b.searchPanel),d===!1)return!1;b.dyfield.remove(c),c.ownerCt.remove(c),b.searchPanel.doLayout(),b.fixSearchHeight(),b.fireEvent("conditionremove",b.searchPanel)}}else if(Ext.isObject(a)&&a.ownerCt){if(d=b.fireEvent("beforeconditionremove",a,b.searchPanel),d===!1)return!1;b.dyfield.remove(a),a.ownerCt.remove(a),b.searchPanel.doLayout(),b.fixSearchHeight(),b.fireEvent("conditionremove",b.searchPanel)}else{if(!Ext.isObject(a)||a.ownerCt)return!1;if(!a.name)return!1;if(c=this.searchPanel.getForm().findField(a.name)){if(d=b.fireEvent("beforeconditionremove",c,b.searchPanel),d===!1)return!1;b.dyfield.remove(c),c.ownerCt.remove(c),b.searchPanel.doLayout(),b.fixSearchHeight(),b.fireEvent("conditionremove",b.searchPanel)}}},getField:function(a){return Ext.isString(a)?this.searchPanel.getForm().findField(a):Ext.isObject(a)?a.name?this.searchPanel.getForm().findField(a.name):!1:!1},searchHandler:function(){var b,a=this;if(!a.searchPanel.getForm().isValid())return Ext.Msg.alert("提示","请填写必要的查询条件"),!1;pars=a.searchPanel.getForm().getFieldValues();for(b in pars)pars[b]||delete pars[b];a._APP.setSearchParams(pars,!0,!0)},resetCondition:function(a){a===!0&&this.removeAllDyField(),this.searchPanel.getForm().reset()},resetHandler:function(){this.resetCondition(!0)},clearHandler:function(){this.resetCondition(!1)},onContextMenu:function(eve,added){var key,omenu,cmenus=Ext.isString(WLJUTIL.contextMenus.condition)?eval(WLJUTIL.contextMenus.condition):WLJUTIL.contextMenus.condition;for(key in cmenus)omenu={},omenu.text=cmenus[key].text,omenu.handler=cmenus[key].fn.createDelegate(this),added.push(omenu);added.push("-"),this._APP.onContextMenu(eve,added)}}),Ext.reg("searchcontainer",Wlj.frame.functions.app.widgets.SearchContainer),Ext.ns("Wlj.frame.functions.app.widgets"),Wlj.frame.functions.app.widgets.ResultContainer=Ext.extend(Ext.Panel,{needGrid:!0,needTbar:!0,autoLoadGrid:!0,singleSelect:!1,multiSelectSeparator:!1,gridLockedHole:!1,gridLockedOnce:!1,suspendViews:!1,suspendViewsWidth:0,alwaysLockCurrentView:!1,tbarButtonAlign:"left",tbarViewAlign:"left",needRN:!1,rnWidth:!1,CREATE_VIEW:"createView",EDIT_VIEW:"editView",DETAIL_VIEW:"detailView",GRID_VIEW:"gridView",createView:!0,editView:!0,detailView:!0,createFieldsCopy:!1,editFieldsCopy:!1,detailFieldsCopy:!1,createFormViewer:!1,editFormViewer:!1,detailFormViewer:!1,createValidates:!1,editValidates:!1,createLinkages:!1,editLinkages:!1,createViewText:"新增",editViewText:"修改",detailViewText:"详情",gridViewText:"列表",pageSize:10,url:!1,dataFields:[],jsonRoot:"json.data",jsonCount:"json.count",store:!1,currentParams:{},formButtons:!1,viewPanel:{createView:!1,editView:!1,detailView:!1},easingStrtegy:!1,beresized:function(a,b,c){var h,i,k,f=parseInt(c,10),g=parseInt(b,10),j=this;Ext.isNumber(f)&&(j.needTbar?(k=this.tbar.getViewSize().height,h=f-k):h=f,this._APP.needCondition||(h-=8),0>h&&(h=0)),Ext.isNumber(g)&&(i=g),Ext.iterate(this.viewPanel,function(a,b){b&&(h&&b.setHeight(h),i&&b.rendered&&(j.suspendViews||b.setWidth(i),b!==j.currentView?b.el.applyStyles({left:i+"px"}):b.el.applyStyles({left:i-b.el.getViewSize().width+"px"})))}),Ext.each(this.customerViewPanels,function(a){h&&(a.setHeight(h),a.assistantView&&a.assistantView.setHeight&&a.assistantView.setHeight(h)),i&&a.rendered&&(j.suspendViews||a.setWidth(i),a!==j.currentView?a.el.applyStyles({left:i+"px"}):a.el.applyStyles({left:i-a.el.getViewSize().width+"px"}))}),this.needGrid&&(h&&this.searchGridView.setHeight(h),i&&(this.searchGridView.setWidth(i),this.gridOuted&&Ext.fly(this.searchGridView.el).applyStyles({marginLeft:-i+"px"})))},initComponent:function(){var b,c,a=this;if(a.validateFieldsCfg(),a._APP.fireEvent("beforeresultinit",a,a._APP),a.needTbar){if(b=[],"right"===a.tbarButtonAlign&&b.push("->"),Ext.isArray(this.tbar))for(c=0;c<this.tbar.length;c++)Ext.isObject(this.tbar[c])&&this.tbar[c].text&&(this.tbar[c].iconCls||(this.tbar[c].iconCls="ico-w-"+Math.ceil(100*Math.random())),b.push(this.tbar[c]));"right"===a.tbarViewAlign?"right"!==a.tbarButtonAlign?b.push("->"):b.length>0&&b.push("-"):b.length>0&&b.push("-"),a.suspendViews||b.push({text:this.gridViewText,hidden:!this.needGrid,handler:function(){a.gridMoveIn()},listeners:{afterrender:function(b){a.gridButton=b,a.gridButton.toggle(!0,!0)}}}),this.tbar=b}else delete this.tbar;Wlj.frame.functions.app.widgets.ResultContainer.superclass.initComponent.call(this),a._APP.fireEvent("afterresultinit",a,a._APP),a._APP.fireEvent("beforeresultrender",a,a._APP)},validateFieldsCfg:function(){var c,a=this.dataFields,b=[];for(c=0;c<a.length;c++)a[c].name&&(a[c].text||(a[c].text=a[c].name,a[c].hidden=!0),b.push(a[c]));this.dataFields=b},onRender:function(a,b){var d,e,c=this;if(this.width=this.vs.width,this.height=this.vs.height,Wlj.frame.functions.app.widgets.ResultContainer.superclass.onRender.call(this,a,b),this.needGrid&&(this.initStore(),this.searchGridView=new Wlj.frame.functions.app.widgets.SearchGrid({store:this.store,searchDomain:this,_APP:this._APP,pageSize:this.pageSize,needRN:this.needRN,rnWidth:this.rnWidth,easingStrtegy:this.easingStrtegy}),this.add(this.searchGridView),this.searchGridView.on("recordselect",function(a,b,d){if(c.fireEvent("recordselect",a,b,d),c.currentView){var e=c.fireEvent("beforeviewshow",c.currentView);if(e===!1)return!1;c.currentView.hasListener("moveout")&&c.currentView.fireEvent("moveout"),c.currentView.hasListener("movein")&&c.currentView.fireEvent("movein",a),c.fireEvent("viewshow",c.currentView)}}),this.searchGridView.on("rowdblclick",function(a,b){c.fireEvent("rowdblclick",a,b)})),this.initViews(),this.needGrid){if(this.autoLoadGrid){d=this._APP.searchDomain.searchPanel.getForm().getFieldValues();for(e in d)d[e]||delete d[e];this._APP.setSearchParams(d,!0,!0)}}else this.showView(this.firstView());this.initEvents(),c=this,this.el.on("contextmenu",function(a){a.stopEvent(),c.onContextMenu(a,[])})},afterRender:function(){Wlj.frame.functions.app.widgets.ResultContainer.superclass.afterRender.call(this),this._APP.fireEvent("afterresultrender",this,this._APP)},initEvents:function(){this.addEvents({beforeviewshow:!0,viewshow:!0,beforeviewhide:!0,viewhide:!0,recorddelete:!0,beforevalidate:!0,validate:!0,recordselect:!0,beforecreateviewrender:!0,aftercreateviewrender:!0,beforeeditviewrender:!0,aftereditviewrender:!0,beforedetailviewrender:!0,afterdetailviewrender:!0,rowdblclick:!0}),this.on("resize",this.beresized)
},initViews:function(){function d(a,b,c){return c.suspendFitAll?b.width:Ext.isNumber(c.suspendWidth)?c.suspendWidth>1?c.suspendWidth:b.width*c.suspendWidth:a}var e,f,g,a=this.vs,b=this,c=0;c=this.suspendViews?this.suspendViewsWidth>a.width-12-this.rnWidth?a.width-12-this.rnWidth-30:this.suspendViewsWidth:a.width-12,this[this.CREATE_VIEW]&&(e={ownerDomain:this,ownerApp:this._APP,vs:{height:a.height-37,width:b.suspendViews?d(c,a,this.createFormCfgs):c},title:this[this.CREATE_VIEW+"Text"],formViewer:this.createFormViewer,fields:this.createFieldsCopy,validates:this.createValidates,linkages:this.createLinkages,baseType:this.CREATE_VIEW,suspended:this.suspendViews,tabIco:"ico-w-6"},Ext.apply(e,this.createFormCfgs),this.viewPanel[this.CREATE_VIEW]=new Wlj.frame.functions.app.widgets.CView(e),this.viewPanel[this.CREATE_VIEW].on({moveout:{fn:this.viewPanel[this.CREATE_VIEW].reset,scope:this.viewPanel[this.CREATE_VIEW],delay:0},beforevalidate:{fn:function(a,c){return b.fireEvent("beforevalidate",a,c)},scope:b,delay:0},validate:{fn:function(a,c,d){b.fireEvent("validate",a,c,d)},scope:b,delay:0},afterviewrender:{fn:function(a){b.fireEvent("aftercreateviewrender",a)},scope:b,delay:0}})),this[this.EDIT_VIEW]&&(f={ownerDomain:this,ownerApp:this._APP,vs:{height:a.height-37,width:b.suspendViews?d(c,a,this.editFormCfgs):c},title:this[this.EDIT_VIEW+"Text"],formViewer:this.editFormViewer,fields:this.editFieldsCopy,validates:this.editValidates,linkages:this.editLinkages,baseType:this.EDIT_VIEW,suspended:this.suspendViews,tabIco:"ico-w-79"},Ext.apply(f,this.editFormCfgs),this.viewPanel[this.EDIT_VIEW]=new Wlj.frame.functions.app.widgets.CView(f),this.viewPanel[this.EDIT_VIEW].on({moveout:{fn:this.viewPanel[this.EDIT_VIEW].reset,scope:this.viewPanel[this.EDIT_VIEW],delay:0},movein:{fn:this.viewPanel[this.EDIT_VIEW].setRecord,scope:this.viewPanel[this.EDIT_VIEW],delay:0},beforeloadrecord:{fn:function(a,c){return b._APP.fireEvent("beforeeditload",a,c)},scope:this.viewPanel[this.EDIT_VIEW],delay:0},loadrecord:{fn:function(a,c){b._APP.fireEvent("aftereditload",a,c)},scope:this.viewPanel[this.EDIT_VIEW],delay:0},beforevalidate:{fn:function(a,c){return b.fireEvent("beforevalidate",a,c)},scope:b,delay:0},validate:{fn:function(a,c,d){b.fireEvent("validate",a,c,d)},scope:b,delay:0},afterviewrender:{fn:function(a){b.fireEvent("aftereditviewrender",a)},scope:b,delay:0}})),this[this.DETAIL_VIEW]&&(g={ownerDomain:this,ownerApp:this._APP,svButton:!1,vs:{height:a.height-37,width:b.suspendViews?d(c,a,this.detailFormCfgs):c},title:this[this.DETAIL_VIEW+"Text"],formViewer:this.detailFormViewer,fields:this.detailFieldsCopy,baseType:this.DETAIL_VIEW,suspended:this.suspendViews,tabIco:"ico-w-27"},Ext.apply(g,this.detailFormCfgs),this.viewPanel[this.DETAIL_VIEW]=new Wlj.frame.functions.app.widgets.CView(g),this.viewPanel[this.DETAIL_VIEW].on({moveout:{fn:this.viewPanel[this.DETAIL_VIEW].reset,scope:this.viewPanel[this.DETAIL_VIEW],delay:0},movein:{fn:this.viewPanel[this.DETAIL_VIEW].setRecord,scope:this.viewPanel[this.DETAIL_VIEW],delay:0},beforeloadrecord:{fn:function(a,c){return b._APP.fireEvent("beforedetailload",a,c)},scope:this.viewPanel[this.EDIT_VIEW],delay:0},loadrecord:{fn:function(a,c){b._APP.fireEvent("afterdetailload",a,c)},scope:this.viewPanel[this.EDIT_VIEW],delay:0},afterviewrender:{fn:function(a){b.fireEvent("afterdetailviewrender",a)},scope:b,delay:0}})),this.createCustomerViews()},clearViews:function(){this.createFormViewer=!1,this.createFieldsCopy=!1,this.createFormCfgs=!1,this.editFormViewer=!1,this.editFieldsCopy=!1,this.editFormCfgs=!1,this.detailFormViewer=!1,this.detailFieldsCopy=!1,this.detailFormCfgs=!1},createCustomerViews:function(){var b,c,d,a=this._APP.customerView;Ext.isArray(a)&&(b=this,c=this.el.getViewSize(),d=0,d=this.suspendViews?this.suspendViewsWidth>c.width-12-this.rnWidth?c.width-12-this.rnWidth-30:this.suspendViewsWidth:c.width,Ext.each(a,function(a){function g(a,b,c){return c.suspendFitAll?b.width:Ext.isNumber(c.suspendWidth)?c.suspendWidth>1?c.suspendWidth:b.width*c.suspendWidth:a}var e,f,h,i;b.customerViewPanels||(b.customerViewPanels=[]),e=a.title,f=a.type,delete a.title,h={title:e?e:"Bview",vs:{height:c.height-(b.needTbar?37:0),width:b.suspendViews?g(d,c,a):d},ownerDomain:b,ownerApp:b._APP,suspended:b.suspendViews},Ext.apply(h,a),h.tabIco||(h.tabIco="ico-w-"+Math.ceil(100*Math.random())),i=!1,i="form"===f?new Wlj.frame.functions.app.widgets.FormView(h):"grid"===f?new Wlj.frame.functions.app.widgets.GridView(h):new Wlj.frame.functions.app.widgets.BView(h),b.customerViewPanels.push(i)}))},showView:function(a){var b,c,d,e,f;if(a){if(b=this.hideCurrentView(),b===!1)return!1;if(this.needGrid&&this.gridMoveOut(),c=this.el.getViewSize(),a.rendered||(a.render(this.body),a.el.applyStyles({left:c.width+"px"})),d=this.fireEvent("beforeviewshow",a),d===!1)return!1;e=a.el.getViewSize(),f=a.el,f.animate({left:{to:c.width-e.width,from:c.width}},.5,null,null,"run"),this.currentView=a,a.fireEvent("movein",this.searchGridView?this.searchGridView.getSelected()[this.searchGridView.getSelected().length-1]:""),this.needTbar&&this.currentView.togogleButton.toggle(!0,!0),this.fireEvent("viewshow",this.currentView)}},hideCurrentView:function(){var a,b,c;if(this.currentView){if(a=this.fireEvent("beforeviewhide",this.currentView),a===!1)return!1;b=this.el.getViewSize(),c=this.currentView.el,c.animate({left:{from:c.getLeft(),to:b.width}},.5,null,"easeOut","run"),this.currentView.fireEvent("moveout"),this.fireEvent("viewhide",this.currentView),this.currentView.assistantView&&this.currentView.hideAssistant(),this.needTbar&&this.currentView.togogleButton.toggle(!1,!0),this.currentView=!1}},initStore:function(){var b,c,d,e,a=this.url;a&&(b=this.createStoreFields(),c=this.jsonRoot,d=this.jsonCount,e=new Ext.data.Store({restful:!0,proxy:new Ext.data.HttpProxy({url:a}),reader:new Ext.data.JsonReader({totalProperty:d,root:c},b)}),this.store=e)},createStoreFields:function(){var a=this.dataFields,b=[];return Ext.each(a,function(a){a.dataType&&WLJDATATYPE[a.dataType]&&(a.type=WLJDATATYPE[a.dataType].getStoreType(),Ext.applyIf(a,WLJDATATYPE[a.dataType].getStoreSpecialCfg())),b.push(a)}),b},gridMoveOut:function(){var a,b;this.gridLockedHole||(a=this,b=Ext.fly(a.getLayoutTarget()),a.searchGridView.el.animate({marginLeft:{from:0,to:-b.getViewSize().width}},.35,null,"easeOut","run"),a.gridOuted=!0,this.needTbar&&a.gridButton.toggle(!1,!0))},gridMoveIn:function(){var a,b;this.gridLockedHole||(a=this,a.hideCurrentView(),b=Ext.fly(a.getLayoutTarget()),a.searchGridView.el.animate({marginLeft:{to:0,from:-b.getViewSize().width}},.35,null,"easeOut","run"),a.gridOuted=!1,this.needTbar&&a.gridButton.toggle(!0,!0))},destroy:function(){var a,b;for(a in this.viewPanel)this.viewPanel[a].destroy&&(this.viewPanel[a].destroy(),this.viewPanel[a]=!1);if(this.clearViews(),this.currentView=!1,Ext.isArray(this.customerViewPanels)){for(b=0;b<this.customerViewPanels.length;b++)this.customerViewPanels[b].destroy();delete this.customerViewPanels}this.searchGridView&&this.searchGridView.destroy&&(this.searchGridView.destroy(),this.searchGridView=null),this.store&&(this.store.removeAll(),this.store.destroy(),this.store=null),this.url=!1,this.dataFields=[],this.jsonRoot="json.data",this.jsonCount="json.count",this.currentParams={},Wlj.frame.functions.app.widgets.ResultContainer.superclass.destroy.call(this)},onMetaAdd:function(a){this.dataFields.push(a),this.onMetaChange(),this.searchGridView.onMetaAdd(a)},onMetaAddAfter:function(a,b){var c=this.getFieldIndex(b);this.dataFields.splice(c+1,0,a),this.onMetaChange(),this.searchGridView.onMetaAddByIndex(a,c+1)},onMetaAddBefore:function(a,b){var c=this.getFieldIndex(b);this.dataFields.splice(c,0,a),this.onMetaChange(),this.searchGridView.onMetaAddByIndex(a,c)},getFieldIndex:function(a){for(var b=0;b<this.dataFields.length;b++)if(this.dataFields[b].name===a)return b;return b},onMetaRemove:function(a){for(var b=0;b<this.dataFields.length;b++)if(this.dataFields[b].name===a){this.dataFields.remove(this.dataFields[b]);break}this.onMetaChange(),this.searchGridView.onMetaRemove(a)},storeMetaChange:function(){var a={totalProperty:this.jsonCount,root:this.jsonRoot,fields:this.createStoreFields()};this.store.reader.onMetaChange(a)},onMetaChange:function(){this.storeMetaChange(),this.searchGridView.titleTile.createRecordTileEl();var a=[];this.store.getCount()>0&&(a=this.store.reader.readRecords(this.store.reader.jsonData)),this.store.removeAll(),a.success&&a.totalRecords>0&&this.store.loadRecords(a,this.store.lastOptions,!0)},nextPageHandler:function(){this.searchGridView.nextPageHandler()},prePageHandler:function(){this.searchGridView.prePageHandler()},firstPageHandler:function(){this.searchGridView.firstPageHandler()},lastPageHandler:function(){this.searchGridView.lastPageHandler()},gridViewHandler:function(){this.gridMoveIn()},getTotleViewIndex:function(a){var c,b=-1;if(this.viewPanel[this.CREATE_VIEW]){if(a===this.viewPanel[this.CREATE_VIEW])return b+1;b++}if(this.viewPanel[this.EDIT_VIEW]){if(a===this.viewPanel[this.EDIT_VIEW])return b+1;b++}if(this.viewPanel[this.DETAIL_VIEW]){if(a===this.viewPanel[this.DETAIL_VIEW])return b+1;b++}return c=this.getCustomerViewIndex(a),b+c+1},getCustomerViewIndex:function(a){return this.customerViewPanels.indexOf(a)},getViewByTotleIndex:function(a){if(!Ext.isNumber(a))return!1;var b=parseInt(a);if(this.viewPanel[this.CREATE_VIEW]){if(0==b)return this.viewPanel[this.CREATE_VIEW];b--}if(this.viewPanel[this.EDIT_VIEW]){if(0==b)return this.viewPanel[this.EDIT_VIEW];b--}if(this.viewPanel[this.DETAIL_VIEW]){if(0==b)return this.viewPanel[this.DETAIL_VIEW];b--}return this.customerViewPanels[b]?this.customerViewPanels[b]:!1},firstView:function(){return this.viewPanel[this.CREATE_VIEW]?this.viewPanel[this.CREATE_VIEW]:this.viewPanel[this.EDIT_VIEW]?this.viewPanel[this.EDIT_VIEW]:this.viewPanel[this.DETAIL_VIEW]?this.viewPanel[this.DETAIL_VIEW]:this.customerViewPanels.length>0?this.customerViewPanels[0]:!1},showNextView:function(){var a=this.getViewByTotleIndex(this.getTotleViewIndex(this.currentView)+1);a?this.showView(a):this.showView(this.firstView())},createTbarMenu:function(){var a=[];return this.needTbar&&this.topToolbar.items.each(function(b){if(b.text&&b.handler&&!b.hidden){var c={};c.text=b.text,c.tbutton=b,c.handler=b.handler,a.push(c)}}),a},onContextMenu:function(a,b){this._APP.onContextMenu(a,b)}}),Ext.reg("resultcontainer",Wlj.frame.functions.app.widgets.ResultContainer),Ext.ns("Wlj.frame.functions.app.widgets"),Wlj.frame.functions.app.widgets.SearchGrid=Ext.extend(Ext.Panel,{pageSize:10,pagable:!0,easingStrtegy:!1,store:!1,currentParams:{},autoScroll:!1,rnWidth:40,needRN:!1,beresized:function(a,b,c){var f=parseInt(c,10),g=this.titleTile.titleTile.el.getViewSize().height,h=this.bbar?this.bbar.getViewSize().height:0,i=f-g-2-h,j=parseInt(b,10);Ext.isNumber(i)&&this.scrollElement.applyStyles({height:i+"px"}),Ext.isNumber(j)&&this.hdElement.applyStyles({width:j+"px"})},onColumnResize:function(a,b,c,d,e,f,g){var h,i,j;for(this.store.fields.get(f).resultWidth=c,this.searchDomain.dataFields[a-1].resultWidth=c,this.getLayoutTarget().applyStyles({width:g+"px"}),h=this.getRows(),i=h.length,j=0;i>j;j++)h[j].style.width=g+"px",h[j].childNodes[a].style.width=c+"px"},initComponent:function(){var a=this;this.pagable&&(this.pageSizeCombo=new Ext.form.ComboBox({triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[[10,"10条/页"],[20,"20条/页"],[50,"50条/页"],[100,"100条/页"],[250,"250条/页"],[500,"500条/页"],[1e3,"1000条/页"]]}),width:80,valueField:"value",displayField:"text",value:a.pageSize,editable:!1,listeners:{select:function(b){var e=parseInt(b.getValue());a.currBar.pageSize=e,a.searchDomain.pageSize=e,a.pageSize=e,a._APP.searchDomain.searchHandler()}}}),this.bbar=new Wlj.frame.functions.app.widgets.PagingToolbar({pageSize:a.pageSize,store:a.store,displayInfo:!0,emptyMsg:"没有符合条件的记录",items:["-","&nbsp;&nbsp;",this.pageSizeCombo],listeners:{beforechange:function(b){var d;if(!a._APP.searchDomain.searchPanel.getForm().isValid())return Ext.Msg.alert("提示","请填写必要的查询条件"),!1;pars=a._APP.searchDomain.searchPanel.getForm().getFieldValues();for(d in pars)pars[d]||delete pars[d];return b=a._APP.setSearchParams(pars,!1,!0),void 0==b||b?void 0:!1}}}),this.currBar=this.bbar,this.bbarCfg={cls:"yc-grid-footer"}),Wlj.frame.functions.app.widgets.SearchGrid.superclass.initComponent.call(this),this.store&&this.initDataEvent()},destroy:function(){this.pageSizeCombo.destroy(),this.pageSizeCombo=!1,this.currBar.destroy(),this.currBar=!1,this.store=!1,this.currentParams={},Ext.destroy(this.hdElement),Ext.destroy(this.scrollElement),Ext.destroy(this.dtElement),delete this.hdElement,delete this.scrollElement,delete this.dtElement,Wlj.frame.functions.app.widgets.SearchGrid.superclass.destroy.call(this)},onRender:function(a,b){Wlj.frame.functions.app.widgets.SearchGrid.superclass.onRender.call(this,a,b),this.initElements(),this.on("resize",this.beresized)},createTbarMenu:function(a){var b=this.searchDomain.createTbarMenu();b.length>0&&(a.push.apply(a,b),a.push("-"))},onMetaAdd:function(a){this.titleTile.onMetaAdd(a)},onMetaAddByIndex:function(a,b){this.titleTile.onMetaAddByIndex(a,b)},onMetaRemove:function(a){this.titleTile.onMetaRemove(a),this.dtElement.dom.style.width=this.titleTile.recordWidth+"px"},onContextMenu:function(a,b,c,d){var f,g,h,e=Ext.fly(b).parent(".ygc-row");e&&(e.hasClass("ygc-row-selected")||this.onRowClick(a,b,c),this.createTbarMenu(d)),f=WLJUTIL.contextMenus.grid;for(g in f)h={},h.text=f[g].text,h.handler=f[g].fn.createDelegate(this),d.push(h);d.push("-"),this.searchDomain.onContextMenu(a,d)},initEvents:function(){this.addEvents({recorddelete:!0,recordselect:!0,rowdblclick:!0});var a=this;this.getLayoutTarget().on("click",function(b,c,d){a.onRowClick(b,c,d)}),this.getLayoutTarget().on("dblclick",function(b,c,d){b.stopEvent(),a.onRowDblclick(b,c,d)}),this.getLayoutTarget().on("mousedown",function(b,c,d){return b.stopEvent(),Ext.fly(c).hasClass("ygc-cell-no")||Ext.fly(c).hasClass("ygc-row")?!1:(a.createDragGhost(b,c,d),void 0)}),this.el.on("contextmenu",function(b,c,d){b.stopEvent(),a.onContextMenu(b,c,d,[])})},onRowClick:function(a,b){var f,d=this,e=Ext.fly(b).hasClass("ygc-row")?Ext.fly(b):Ext.fly(b).parent(".ygc-row");return e?(f=parseInt(e.dom.getAttribute("rowIndex")),Ext.fly(b).hasClass("ygc-cell-no")?(e.hasClass("ygc-row-selected")?e.removeClass("ygc-row-selected"):(e.addClass("ygc-row-selected"),d.fireEvent("recordselect",this.store.getAt(f),this.store,b)),void 0):(e.hasClass("ygc-row-selected")?(d.clearSelect(),e.removeClass("ygc-row-selected")):(d.clearSelect(),e.addClass("ygc-row-selected"),d.fireEvent("recordselect",this.store.getAt(f),this.store,b)),void 0)):!1},onRowDblclick:function(a,b,c){var d=this,e=Ext.fly(b).parent(".ygc-row"),f=parseInt(e.dom.rowIndex);e.hasClass("ygc-row-selected")||this.onRowClick(a,b,c),d.fireEvent("rowdblclick",b,this.store.getAt(f))},createDragGhost:function(a,b){var e,d=this.getCellData(b);return this.store.fields.get(d.name).enableCondition===!1?!1:(e=new Wlj.frame.functions.app.widgets.CellDD(Ext.fly(b),{dragData:{tile:{data:d}},ddGroup:"searchDomainDrop"}),e.handleMouseDown(a,e),void 0)},initElements:function(){Ext.Element;var b=this.body;this.hdElement=b.createChild({tag:"div",cls:"yc-grid-header",style:"width:100%;overflow:hidden;"}),this.scrollElement=b.createChild({tag:"div",style:"overflow:auto;"}),this.dtElement=this.scrollElement.createChild({tag:"div",style:"min-height:1px;"}),this.createFieldsTitle()},getCellData:function(a){var d,e,b=Ext.fly(a).parent(".ygc-row"),c=parseInt(b.dom.getAttribute("rowIndex"));return Ext.fly(a).hasClass("ygc-cell")||(a=Ext.fly(a).parent(".ygc-cell").dom),d=Array.prototype.indexOf.call(b.dom.childNodes,a),e=this.titleTile.titleTile.items.itemAt(d).data,e.value=this.store.getAt(c).get(e.name),e},getLayoutTarget:function(){return this.dtElement},createFieldsTitle:function(){this.bwrap,this.body;var c=this;this.titleTile=new Wlj.frame.functions.app.widgets.TitleTile({store:c.store,vs:c.vs,_APP:c._APP,rnWidth:c.rnWidth,searchGridView:c,needRN:c.needRN,easingStrtegy:c.easingStrtegy}),this.titleTile.titleTile.render(this.hdElement),this.hdElement.applyStyles({height:this.titleTile.titleTile.el.getViewSize().height}),this.titleTile.titleTile.el.applyStyles({top:0,left:0,marginTop:0,marginLeft:0}),this.dtElement.applyStyles({width:this.titleTile.titleTile.el.getViewSize().width}),this.scrollElement.on("scroll",function(){c.synHDScroll()})},synHDScroll:function(){var a=this.hdElement.dom,b=this.scrollElement.dom.scrollLeft;a.scrollLeft=b,a.scrollLeft=b},booterDataElements:function(a){var c=a.resultContainer;c.clearRows(),c.titleTile.bootEls()},hasRows:function(){var a=this.getLayoutTarget();return a.dom.firstChild?!0:!1},clearRows:function(){var a=this;a.getLayoutTarget().dom.innerHTML=""},getRows:function(){var a=this;return a.hasRows()?this.getLayoutTarget().dom.childNodes:[]},initDataEvent:function(){this.store||this.initStore(),this.store&&(this.store.on("add",this.onDataAdd),this.store.on("load",this.onDataLoad),this.store.on("exception",this.onExceptionLoad),this.store.on("beforeload",this.onBeforeLoad),this.store.on("remove",this.onDataRemove),this.store.on("clear",this.onDataClear),this.store.resultContainer=this)},onDataAdd:function(a,b){var d=a.resultContainer;d.booterDataElements(a,b)},onDataLoad:function(a,b){var d=a.resultContainer;d.totalLength=a.totalLength,d.booterDataElements(a,b),d._APP.unmaskRegion("resultDomain"),d._APP.enableConditionButton(WLJUTIL.BUTTON_TYPE.SEARCH)},onExceptionLoad:function(){var d=this.resultContainer;d._APP.unmaskRegion("resultDomain"),d._APP.enableConditionButton(WLJUTIL.BUTTON_TYPE.SEARCH)},onBeforeLoad:function(a,b){var c=a.resultContainer;delete b.add,a.removeAll(),c.getLayoutTarget()&&(c.getLayoutTarget().innerHTML=""),c._APP.maskRegion("resultDomain",c.searchDomain.loadMaskMsg),c._APP.disableConditionButton(WLJUTIL.BUTTON_TYPE.SEARCH)},onDataRemove:function(a,b,c){a.resultContainer.getLayoutTarget().dom.removeChild(a.resultContainer.getLayoutTarget().dom.childNodes[c])},onDataClear:function(a){a.resultContainer.getLayoutTarget()&&(a.resultContainer.getLayoutTarget().dom.innerHTML="")},turnToCurrentPage:function(a){var c,b=this;return this.store&&this.store.load?(c=this.currentParams,this.store.baseParams={condition:Ext.encode(c)},this.store.load({params:{start:0,limit:b.pageSize},callback:function(){b.searchDomain.gridLockedHole||(b.searchDomain.gridLockedOnce?b.searchDomain.gridLockedOnce=!1:b.searchDomain.gridMoveIn()),b.searchDomain.suspendViews&&(b.searchDomain.alwaysLockCurrentView||b.searchDomain.hideCurrentView()),Ext.isFunction(a)&&a()}}),void 0):!1},getSelected:function(){var a=this;return a.selected=[],this.el.select(".ygc-row-selected").each(function(b){a.selected.push(a.store.getAt(parseInt(b.getAttribute("rowIndex"))))}),a.selected},selectByIndex:function(a){var b=this;Ext.isNumber(a)?(this.clearSelect(),this.el.select(".ygc-row").item(parseInt(a))&&this.el.select(".ygc-row").item(parseInt(a)).addClass("ygc-row-selected")):Ext.isArray(a)&&a.length>0&&(this.clearSelect(),Ext.each(a,function(a){b.el.select(".ygc-row").item(parseInt(a))&&b.el.select(".ygc-row").item(parseInt(a)).addClass("ygc-row-selected")}))},clearSelect:function(){this.el.select(".ygc-row-selected").removeClass("ygc-row-selected")},antiSelect:function(){var a=this.getLayoutTarget().select(".ygc-row",!0);a.each(function(a){a.hasClass("ygc-row-selected")?a.removeClass("ygc-row-selected"):a.addClass("ygc-row-selected")})},allSelect:function(){this.getLayoutTarget().select(".ygc-row").addClass("ygc-row-selected")},sort:function(a,b){this.titleTile.updateSortIcon(a,b),this.store.sort(a,b),this.booterDataElements(this.store)},showFields:function(a){var c,d,e,b=this.getFieldsIndex(a);for(c=0;c<b.length;c++)this.store.fields.get(b[c]).hidden=!1,this.searchDomain.dataFields[b[c]].hidden=!1;for(this.titleTile.showFields(b),d=this.getRows(),c=0;c<d.length;c++){for(e=0;e<b.length;e++)b[e]>=0&&b[e]<d[c].childNodes.length&&(d[c].childNodes[b[e]+1].style.display="block");d[c].style.width=this.titleTile.recordWidth+"px"}this.dtElement.dom.style.width=this.titleTile.recordWidth+"px"},hideFields:function(a){var c,d,e,b=this.getFieldsIndex(a);for(c=0;c<b.length;c++)this.store.fields.get(b[c]).hidden=!0,this.searchDomain.dataFields[b[c]].hidden=!0;for(this.titleTile.hideFields(b),d=this.getRows(),c=0;c<d.length;c++){for(e=0;e<b.length;e++)b[e]>=0&&b[e]<d[c].childNodes.length&&(d[c].childNodes[b[e]+1].style.display="none");d[c].style.width=this.titleTile.recordWidth+"px"}this.dtElement.dom.style.width=this.titleTile.recordWidth+"px"},getFieldsIndex:function(a){var d,e,b=[],c=[];for(b=Ext.isArray(a)?a:[a],d=0;d<b.length;d++)e=this.store.fields.indexOf(this.store.fields.get(b[d])),e>=0&&c.push(e);return c},nextPageHandler:function(){this.currBar.next.disabled||this.currBar.moveNext()},prePageHandler:function(){this.currBar.prev.disabled||this.currBar.movePrevious()},firstPageHandler:function(){this.currBar.first.disabled||this.currBar.moveFirst()},lastPageHandler:function(){this.currBar.last.disabled||this.currBar.moveLast()},refreshPageHandler:function(){},setFieldTitle:function(a){this.titleTile.setFieldTitle(a)}}),Ext.reg("searchgridview",Wlj.frame.functions.app.widgets.SearchGrid),Wlj.frame.functions.app.widgets.TitleTile=function(a){Ext.apply(this,a),Wlj.frame.functions.app.widgets.TitleTile.superclass.constructor.call(this),this.createTitle(),this.createRecordTileEl()},Ext.extend(Wlj.frame.functions.app.widgets.TitleTile,Ext.util.Observable,{alwaysField:!0,"float":"left",lineHeight:27,defaultFieldWidth:150,rnWidth:40,needRN:!1,easingStrtegy:!1,multiSelectSeparator:",",getTitleClass:function(a){var b=a.dataType;return b&&WLJDATATYPE[b]?(b=WLJDATATYPE[b],b.getTitleClass()):""},createTitle:function(){var b,c,d,a=this;a.recordWidth=0,b=this.store.fields,c=[],this.needRN&&(this.indexTile=new Wlj.widgets.search.tile.Tile({ownerW:10,removeable:!1,dragable:!1,baseSize:a.lineHeight,baseWidth:a.rnWidth,baseMargin:0,cls:"ygh-hd","float":"left",html:"序号"}),this.indexTile.on("afterrender",function(b){b.el.on("click",function(){b.__ALLS?(a.store.resultContainer.clearSelect(),b.__ALLS=!1):(a.store.resultContainer.allSelect(),b.__ALLS=!0)})}),c.push(this.indexTile),a.recordWidth=parseInt(a.recordWidth)+2*parseInt(this.indexTile.baseMargin)+parseInt(a.rnWidth)+12),b.each(function(b){var d=a.createFieldTile(b);d&&c.push(d)}),d=new Wlj.widgets.search.tile.Tile({ownerW:10,ownerWI:-10,removeable:!1,dragable:!1,baseSize:a.lineHeight,baseWidth:a.recordWidth,baseMargin:1,recordView:this,cls:"ygh-container","float":"left",style:{overflowX:"hidden"},pos_size:{TX:0,TY:0,TW:1,TH:1},items:c,listeners:{afterrender:function(b){b.el.on("contextmenu",function(a,c,d){a.stopEvent(),b.recordView.onTitleContextMenu(a,c,d,[])}),a.initColumnDD()}}}),a.titleTile=d},createDataIndexEl:function(){var a=this,b='<div class="ygc-cell ygc-cell-no" style="width:'+a.rnWidth+'px;position: relative; margin: 0px; float: left; height: 27px;">'+"{index+1}"+"</div>";return b},createFieldEl:function(a){var b=this,c="";return a.text&&a.gridField!==!1?c='<tpl for="'+a.name+'">'+'<div title="{title}" class="ygc-cell '+b.getFieldClass(a)+'" style="position: relative; margin: 0px; width: '+(a.resultWidth?a.resultWidth:b.defaultFieldWidth)+"px; float: left; height: 27px; "+(a.hidden?"display:none;":"")+'">'+"{display}"+"</div>"+"</tpl>":""},createRecordTileEl:function(){var a=this,b=this.store,c=b.fields,d=[],e='<div class="ygc-row {oddc}" style="position: relative; overflow-x: hidden; margin: 0px; width: '+this.recordWidth+'px; float: left; height: 27px;" rowIndex="{index}">';d.push(e),d.push(this.createDataIndexEl()),d.push('<tpl for="data">'),c.each(function(b){d.push(a.createFieldEl(b))}),d.push("</tpl>"),d.push("</div>"),a.recordTemplate=new Ext.XTemplate(d.join(""),{formatFieldData:function(a,b){var c="&nbsp;";return b&&(c=b),Ext.isFunction(a.viewFn)&&(c=a.viewFn(c)),c}})},bootEls:function(){var a=this,b=this.store.getCount();a.easingStrtegy&&a.easingStrtegy.type&&a.easingStrtegy.firstStep&&Ext.isFunction(a[a.easingStrtegy.type+"DataLineRender"])&&!(b<=a.easingStrtegy.firstStep)?a[a.easingStrtegy.type+"DataLineRender"].call(a,a.easingStrtegy.initialConfig):a.defaultDataLineRender()},defaultDataLineRender:function(){var a=this,b=this.searchGridView,c=b.getLayoutTarget(),d=this.store;d.data.each(function(b,d){var f=0===d%2?"ygc-row-odd":"",g=a.buildData(b);a.recordTemplate.append(c,{oddc:f,index:d,data:g})})},settimeoutDataLineRender:function(){var b=this,c=this.searchGridView,d=c.getLayoutTarget(),e=this.store,f=this.easingStrtegy.firstStep?this.easingStrtegy.firstStep:50;e.data.each(function(a,c){var g=0===c%2?"ygc-row-odd":"",h=b.buildData(a);f>c?b.recordTemplate.append(d,{oddc:g,index:c,data:h}):setTimeout(function(){b.recordTemplate.append(d,{oddc:g,index:c,data:h})},1)})},buildData:function(a){var b=this,c={};return a.fields.each(function(d){var e=b.formatFieldData(d,b.translateFieldData(d,a.get(d.name)));c[d.name]={display:e,title:d.noTitle===!0?d.text:a.get(d.name)}}),c},getFieldClass:function(a){var b=a.dataType;return b&&WLJDATATYPE[b]?(b=WLJDATATYPE[b],b.getFieldClass()):""},formatFieldData:function(a,b){var c="&nbsp;";return b&&(c=b),Ext.isFunction(a.viewFn)&&(c=a.viewFn(c)),c},translateFieldData:function(a,b){var e,f,g,c=this._APP,d="&nbsp";return a.translateType?(a.multiSelect?(e=a.multiSeparator?a.multiSeparator:this.multiSelectSeparator,f=c.translateLookupByMultiKey(a.translateType,b,e)):f=c.translateLookupByKey(a.translateType,b),f&&(d=f)):d=b,g=a.dataType,g&&WLJDATATYPE[g]&&(g=WLJDATATYPE[g],"&nbsp"!==d&&(d=g.formatFn(d),g=null)),d},initColumnDD:function(){var a=this;this.DropZone=new Ext.dd.DropZone(a.titleTile.el.dom,{ddGroup:"searchDomainDrop",notifyDrop:function(b,c,d){var g,h,e=c.getXY()[0];for(c.getXY()[1],g=0,h=a.titleTile.el.first().first(".ygh-hd");h&&!(e<=h.getRight());)h=h.next(),g++;setTimeout(function(){a.setColumnOrder(d.tile.data.name,g)},50)}})},createFieldTile:function(a){var c,d,b=this;return a.text&&a.gridField!==!1?(c='<div title="'+a.text+'" class="ygh-hd-text">'+a.text+"</div>",d=new Wlj.widgets.search.tile.Tile({ownerW:10,removeable:!1,dragable:!(a.enableCondition===!1),defaultDDGroup:"searchDomainDrop",baseSize:b.lineHeight,baseWidth:a.resultWidth?a.resultWidth:b.defaultFieldWidth,"float":"left",cls:"ygh-hd "+b.getTitleClass(a),baseMargin:0,html:c,data:{name:a.name,value:""},clearSortIcon:function(){this.el.first().removeClass("ygh-hd-order-desc"),this.el.first().removeClass("ygh-hd-order-asc")},addSortIcon:function(a){this.el.first().addClass("ygh-hd-order-"+a)},listeners:{afterrender:function(c){c.el.on("click",function(a){a.stopEvent(),c.el.first().hasClass("ygh-hd-order-desc")?b._APP.sortByDataIndex(c.data.name,"asc"):b._APP.sortByDataIndex(c.data.name,"desc")}),c.el.on("contextmenu",function(a,c,d){a.stopEvent(),b.onTitleFieldContextMenu(a,c,d,[])}),this.RESIZEABLE=new Ext.Resizable(this.el,{handles:"e",height:this.el.getHeight(),width:this.el.getWidth()}),this.RESIZEABLE.on("resize",function(a,d,e,f){f.stopEvent();var g=b.titleTile.items.indexOf(c);b.onColumnResize(g,a,d,e,f,c.data.name)}),this.dragable&&(this.dd.startDrag=function(){this.tile.el.applyStyles({display:""}),this.proxy.getEl().dom.innerText=this.tile.el.dom.innerText}),a.hidden&&this.hide()}}}),a.hidden||(b.recordWidth=parseInt(b.recordWidth)+2*parseInt(d.baseMargin)+parseInt(d.baseWidth)+12),d):!1},onColumnResize:function(a,b,c,d,e,f){var g=parseInt(this.recordWidth)-parseInt(this.titleTile.items.get(a).baseWidth)+parseInt(c);this.titleTile.items.get(a).baseWidth=c,this.titleTile.items.get(a).initialConfig.baseWidth=c,this.recordWidth=g,this.titleTile.baseWidth=g,this.titleTile.get(a).el.applyStyles({width:c+"px"}),this.titleTile.el.applyStyles({width:g+"px"}),Ext.fly(this.titleTile.layoutEl).applyStyles({width:g+"px"}),this.searchGridView.onColumnResize(a,b,c,d,e,f,g),this.createRecordTileEl()},setColumnOrder:function(a,b){var d,e,f,g,h,i,j,c=null;for(this.titleTile.items.each(function(b){b.data&&b.data.name===a&&(c=b)}),d=this.titleTile.items.indexOf(c),e=c.initialConfig,this.titleTile.remove(c),this.titleTile.insert(b,new Wlj.widgets.search.tile.Tile(e)),this.titleTile.doLayout(),f=this.searchGridView.getRows(),g=0;g<f.length;g++)h=f[g].removeChild(f[g].childNodes[d]),f[g].childNodes[b-1].insertAdjacentElement("afterEnd",h);for(i=this.searchGridView.searchDomain.dataFields,j=!1,g=0;g<i.length;g++)if(i[g].name===a){j=i[g];break}j&&(i.remove(j),i.splice(b-1,0,j),this.searchGridView.searchDomain.storeMetaChange()),this.createRecordTileEl()},onMetaAdd:function(a){var c,d,e,f,b=this.createFieldTile(a);for(b=this.titleTile.add(b),this.resetWidth(),this.titleTile.doLayout(),this.createRecordTileEl(),c=new Ext.XTemplate('<div class="ygc-cell" style="position: relative; margin: 0px; width: '+(a.resultWidth?a.resultWidth:this.defaultFieldWidth)+'px; float: left; height: 27px;">'+"</div>"),d=this.searchGridView.getRows(),e=d.length,f=0;e>f;f++)c.append(d[f]),d[f].style.width=this.recordWidth+"px"},onMetaAddByIndex:function(a,b){var c=this.createFieldTile(a);c=this.titleTile.insert(b+1,c),this.resetWidth(),this.titleTile.doLayout(),this.createRecordTileEl()},onMetaRemove:function(a){var c,d,e,f,b=this.titleTile.findBy(function(b){return b.data&&a===b.data.name?!0:!1});if(b.length>0)for(c=b[0],c.hidden||(this.recordWidth=parseInt(this.recordWidth)-(2*parseInt(c.baseMargin)+parseInt(c.baseWidth)+12)),this.titleTile.remove(c),this.resetWidth(),this.titleTile.doLayout(),this.createRecordTileEl(),d=this.searchGridView.getRows(),e=d.length,f=0;e>f;f++)d[f].style.width=this.recordWidth+"px"},resetWidth:function(){this.titleTile.el.applyStyles({width:this.recordWidth+"px"}),Ext.fly(this.titleTile.getLayoutTarget()).applyStyles({width:this.recordWidth+"px"})},clearSortIcons:function(){this.titleTile.items.each(function(a){a.clearSortIcon&&a.clearSortIcon.call(a)})},updateSortIcon:function(a,b){this.titleTile.items.each(function(c){c.clearSortIcon&&c.clearSortIcon.call(c),c.data&&c.data.name===a&&c.addSortIcon&&c.addSortIcon.call(c,b)})},showFields:function(a){var b=this;Ext.each(a,function(a){var c=b.titleTile.items.get(a+1);c&&c.hidden&&(b.recordWidth=parseInt(b.recordWidth)+(2*parseInt(c.baseMargin)+parseInt(c.baseWidth)+12),c.show())}),this.titleTile.doLayout(),b.resetWidth(),this.createRecordTileEl()},hideFields:function(a){var b=this;Ext.each(a,function(a){var c=b.titleTile.items.get(a+1);c&&!c.hidden&&(b.recordWidth=parseInt(b.recordWidth)-(2*parseInt(c.baseMargin)+parseInt(c.baseWidth)+12),c.hide())}),b.resetWidth(),this.createRecordTileEl()},onTitleContextMenu:function(a,b,c,d){this.searchGridView.onContextMenu(a,b,c,d)},onTitleFieldContextMenu:function(a,b,c,d){this.onTitleContextMenu(a,b,c,d)},destroy:function(){this.titleTile.removeThis()},setFieldTitle:function(a){var c,b=this.titleTile.items.find(function(b){return b.data&&b.data.name==a.name?!0:void 0});return b?(b.data.text=a.text,b.el.select(".ygh-hd-text").first().dom.title=a.text,b.el.select(".ygh-hd-text").first().dom.innerText=a.text,c=this._APP.getConditionField(a.name),c&&c.setLabelText(a.text),void 0):!1}}),Wlj.frame.functions.app.widgets.CellProxy=Ext.extend(Object,{constructor:function(a,b){this.tile=a,this.id=this.tile.id+"-ddproxy",Ext.apply(this,b)},insertProxy:!1,setStatus:Ext.emptyFn,reset:Ext.emptyFn,update:Ext.emptyFn,stop:Ext.emptyFn,sync:Ext.emptyFn,getEl:function(){return this.ghost},getGhost:function(){return this.ghost},buildCellGhost:function(a){var b=document.createElement("div");return b.style.width="150px",b.style.height="27px",b.className="x-panel-ghost "+this.tile.dom.className,b.innerHTML="<b>"+this.tile.dom.innerText+"</b>",Ext.getDom(a).appendChild(b),Ext.get(b)},getProxy:function(){return this.proxy},hide:function(){this.ghost&&(this.proxy&&(this.proxy.remove(),delete this.proxy),this.ghost.remove(),delete this.ghost)
},show:function(){this.ghost||(this.ghost=this.buildCellGhost(Ext.getBody()),this.ghost.setXY(this.tile.getXY()),this.insertProxy&&(this.proxy=this.tile.el.insertSibling({cls:"tile"}),this.proxy.setSize(this.tile.getSize())))},repair:function(a,b,c){this.hide(),"function"==typeof b&&b.call(c||this)},moveProxy:function(a,b){this.proxy&&a.insertBefore(this.proxy.dom,b)}}),Wlj.frame.functions.app.widgets.CellDD=Ext.extend(Ext.dd.DragSource,{constructor:function(a,b){this.tile=a,this.proxy=new Wlj.frame.functions.app.widgets.CellProxy(a,b),Wlj.frame.functions.app.widgets.CellDD.superclass.constructor.call(this,a,b),this.scroll=!1},showFrame:Ext.emptyFn,startDrag:Ext.emptyFn,b4StartDrag:function(){this.proxy.show()},b4MouseDown:function(a){var b=a.getPageX(),c=a.getPageY();this.autoOffset(b,c)},onInitDrag:function(a,b){return this.onStartDrag(a,b),!0},createFrame:Ext.emptyFn,getDragEl:function(){return this.proxy.ghost.dom},endDrag:function(){this.proxy.hide(),this.destroy()},autoOffset:function(a,b){a-=this.startPageX,b-=this.startPageY,this.setDelta(a,b)},onDrag:function(){}}),Wlj.frame.functions.app.widgets.PagingToolbar=Ext.extend(Ext.PagingToolbar,{exParams:[{path:"json.total",defaultValue:0}],jsonDataPath:"_this.store.reader.jsonData.",displayMsg:"显示{0}条到{1}条，共{2}条",updateInfo:function(){var count,msg,fp,_this;this.displayItem&&(count=this.store.getCount(),msg=null,0==count?msg=this.emptyMsg:(fp=[],fp.push(this.displayMsg),fp.push(this.cursor+1),fp.push(this.cursor+count),fp.push(this.store.getTotalCount()),_this=this,Ext.each(this.exParams,function(pa){var value=pa.defaultValue;try{value=eval(_this.jsonDataPath+pa.path),void 0===value&&(value=pa.defaultValue)}catch(error){}finally{fp.push(value)}}),msg=String.format.apply(this,fp)),this.displayItem.setText(msg))}}),Ext.ns("Wlj.frame.functions.app.widgets"),Wlj.frame.functions.app.widgets.View=Ext.extend(Ext.Panel,{autoEl:{tag:"div",cls:"wlj-view-container"},autoScroll:!0,layout:"fit",_defaultTitle:"hello world",initComponent:function(){Wlj.frame.functions.app.widgets.View.superclass.initComponent.call(this),this.addEvents({movein:!0,moveout:!0,beforeloadrecord:!0,loadrecord:!0})},render:function(a,b){this.width=this.vs.width,Wlj.frame.functions.app.widgets.View.superclass.render.call(this,a,b)}}),Ext.reg("basicview",Wlj.frame.functions.app.widgets.View),Wlj.frame.functions.app.widgets.RView=Ext.extend(Wlj.frame.functions.app.widgets.View,{_defaultTitle:"Rview",ownerDomain:!1,ownerApp:!1,hideTitle:!1,suspended:!1,vs:!1,tabIco:!1,assistantView:!1,initComponent:function(){this.width=this.vs.width,this.title?this._defaultTitle=this.title:this.title=this._defaultTitle,this.iconCls="hide-wvc-right",this.headerCssClass="wvc-header",this.ownerDomain.suspendViews||delete this.title,Wlj.frame.functions.app.widgets.RView.superclass.initComponent.call(this);var a=this;a.ownerDomain.needTbar&&(a.togogleButton=this.ownerDomain.getTopToolbar().addButton({text:a._defaultTitle,enableToggle:!0,hidden:a.hideTitle,iconCls:a.tabIco,handler:function(){if(a.ownerDomain.currentView===a)a.ownerDomain.suspendViews?a.ownerDomain.hideCurrentView():a.ownerDomain.gridMoveIn();else{var b=a.ownerDomain.showView(a);b===!1&&a.togogleButton.toggle(!1)}}}))},onRender:function(a,b){var c,d;Wlj.frame.functions.app.widgets.RView.superclass.onRender.call(this,a,b),c=this,c.suspended&&c.header.on("click",function(a){a.stopEvent(),c.ownerDomain.suspendViews?c.ownerDomain.hideCurrentView():c.ownerDomain.gridMoveIn()}),c.assistantView&&(c.assistantView.width||(c.assistantView.width=a.getViewSize().width-c.width),c.assistantView.height=a.getViewSize().height,d=new Ext.Panel(c.assistantView),d.majorView=this,this.assistantView=d,d.render(a),d.setHeight(c.height),d.el.applyStyles({top:"0px",position:"absolute",marginLeft:-d.width+"px"}),d.header.on("click",function(){c.hideAssistant()}))},getIndex:function(){return this.ownerDomain.getTotleViewIndex(this)},setValues:function(a){var b,c;return this.contentPanel?(b=this.contentPanel,b.getForm&&b.getForm()?(c=b.getForm(),c.setValues(a),void 0):!1):!1},showAssistant:function(){this.assistantView&&!this.assistantView.moveined&&(this.assistantView.el.animate({marginLeft:{to:0,from:-this.assistantView.width}},.35,null,"easeOut","run"),this.assistantView.moveined=!0)},hideAssistant:function(){this.assistantView&&this.assistantView.moveined&&(this.assistantView.el.animate({marginLeft:{from:0,to:-this.assistantView.width}},.35,null,"easeOut","run"),this.assistantView.moveined=!1)}}),Ext.reg("resultview",Wlj.frame.functions.app.widgets.RView),Wlj.frame.functions.app.widgets.CView=Ext.extend(Wlj.frame.functions.app.widgets.RView,{_defaultTitle:"Cview",baseType:!1,openValidate:!0,svButton:!0,fields:!1,validates:!1,linkages:!1,formButtons:!1,autoValidateText:"字段校验失败，请检查输入项!",suspendFitAll:!1,toBeValidate:!0,record:!1,initComponent:function(){Wlj.frame.functions.app.widgets.CView.superclass.initComponent.call(this),this.width=this.vs.width,this.buildContent(),this.add(this.contentPanel);var a=this.baseType.toLowerCase();this.ownerDomain.fireEvent("before"+a+"render",this)},destory:function(){this.contentPanel=!1,Wlj.frame.functions.app.widgets.CView.superclass.destory.call(this)},onRender:function(a,b){Wlj.frame.functions.app.widgets.CView.superclass.onRender.call(this,a,b),this.fireEvent("afterviewrender",this)},initEvents:function(){this.addEvents({beforevalidate:!0,validate:!0,afterviewrender:!0})},setRecord:function(a){if(this.record=a,this.rendered===!0){var b=this.fireEvent("beforeloadrecord",this,this.record);if(b===!1)return!1;this.contentPanel.getForm().reset(),this.record&&this.contentPanel.getForm().loadRecord(this.record),this.fireEvent("loadrecord",this,this.record)}},reset:function(){this.contentPanel&&this.contentPanel.getForm()&&this.contentPanel.getForm().reset()},buildContent:function(){var a=this;this.contentPanel=new Ext.form.FormPanel({items:this.buildFormField(),frame:!0,height:"auto",autoScroll:!0,buttonAlign:"center",layout:"form",buttons:a.buildButtons()})},buildButtons:function(){var c,a=this,b=[];return a.svButton&&(c={text:"保存",cls:"simple-btn",overCls:"simple-btn-hover",handler:function(){var b,c,d;if(a.openValidate){if(b=a.fireEvent("beforevalidate",a,a.contentPanel),b===!1)return!1;if(!a.contentPanel.getForm().isValid())return Ext.MessageBox.alert("提示",a.autoValidateText),!1;if(c=a.validateData(),a.fireEvent("validate",a,a.contentPanel,c),!c.passable)return Ext.Msg.alert("提示",c.info),void 0}d=a.contentPanel.getForm().getFieldValues(),a.ownerApp.comitData(d)}},b.push(c)),Ext.isArray(a.formButtons)&&Ext.each(a.formButtons,function(c){Ext.isString(c.text)&&(c.handler=Ext.isFunction(c.fn)?function(){c.fn.call(a,a.contentPanel,a.contentPanel.getForm())}:Ext.emptyFn,b.push(c))}),b.length>0?b:!1},createColumnsCfg:function(a,b){var e,f,c=[],d=this;for(e=0;a>e;e++)f={},f.layout="form",f.columnWidth=1/a,f.items=[],c.push(f);return Ext.each(b,function(e){var f,g;if(Ext.isObject(e)){if(Ext.instanceOf(e,"container"));else{if(e.fieldLabel=e.text?e.text:e.name,e.xtype=e.xtype?e.xtype:"textfield",e.hidden="boolean"==typeof e.hidden?e.hidden:e.text?!1:!0,e.anchor="90%",e.allowBlank===!1&&(e.fieldLabel=WLJTOOL.addBlankFlag(e.fieldLabel)),e.translateType){if(e.xtype=e.multiSelect?"lovcombo":"combo",e.store=d.ownerApp.lookupManager[e.translateType],!e.store)return Ext.error("字段【"+e.text+"】的数据字典映射项store【"+e.translateType+"】获取错误，请检查[lookupTypes|localLookup]项配置"),!1;e.valueField="key",e.displayField="value",e.editable="boolean"==typeof e.editable?e.editable:!1,e.forceSelection=!0,e.triggerAction="all",e.mode="local",e.hiddenName=e.name,e.separator=e.multiSeparator?e.multiSeparator:d.ownerDomain.multiSelectSeparator}else e.name=e.name,e.dataType&&WLJDATATYPE[e.dataType]&&(e.xtype=WLJDATATYPE[e.dataType].getFieldXtype(),Ext.applyIf(e,WLJDATATYPE[e.dataType].getFieldSpecialCfg()));f={change:function(a,b,c){d.linkaging(a,b,c)}},e.listeners?Ext.apply(e.listeners,f):e.listeners=f}g=b.indexOf(e)%a,c[g].items.push(e)}}),c},buildFormField:function(){var f,a=this,b=a.formViewer,c=[],d=a.vs,e=d.width>1024?4:3;return d.width<800&&(e=2),d.width<500&&(e=1),f=a.fields,Ext.each(b,function(d){var h,i,k,l,n,f=d.fields,g=e;if(d.columnCount&&(g=d.columnCount),h=a.getFieldsByName(f)){if(Ext.isFunction(d.fn))try{i=d.fn.apply(a,h)}catch(j){Ext.error("["+a._defaultTitle+"]面板第["+b.indexOf(d)+"]个字段组渲染出错,字段组将以默认顺序解析。见【formViewers|createFormViewer|editFormViewer|detailFormViewer】，TYPE:【"+j.name+"】;MESSAGE:【"+j.message+"】!"),i=h}else i=h;for(i.length=h.length,k=new Array,l=0;l<i.length;l++)Ext.isObject(i[l])&&i[l].hidden!==!0&&("detailView"===a.baseType&&(i[l].readOnly=!0),k.push(i[l]));i=a.createColumnsCfg(g,k),delete k,Math.ceil(f.length/g),n={},n.xtype="panel",n.layout="column",d.labelWidth&&(n.labelWidth=d.labelWidth),n.items=i,c.push(n)}}),Ext.each(f,function(a){(a.hidden||!a.text)&&(a.xtype="textfield",a.hidden=!0,c.push(a))}),c},getFieldsByName:function(a){var b,c,d,e;if(!this.fields)return!1;if(!a)return!1;if(b=this,Ext.isArray(a))return c=new Array(a.length),Ext.each(b.fields,function(b){a.indexOf(b.name)>=0&&(c[a.indexOf(b.name)]=b)}),c.length>0?c:!1;if(Ext.isString(a))for(d=0;d<this.fields.length;d++)if(e=this.fields[d],e.name===a)return e;return!1},validateData:function(){var c,d,e,a=this,b={passable:!0,info:"",addInfo:function(a){b.info+="<br>"+a}};return a.toBeValidate?(c=this.validates)?(d=a.contentPanel,d.getForm()?(e=d.getForm().getFieldValues(),a=this,Ext.each(c,function(c){if(Ext.isFunction(c.fn)){var d=[];Ext.each(c.dataFields,function(a){d.push(e[a])});try{c.fn.apply(c,d)===!1&&(b.passable=!1,b.addInfo(c.desc))}catch(f){Ext.error("["+a._defaultTitle+"]面板校验规则["+c.desc+"]:运行错误，校验结果将按照失败计算。见【validates|createValidates|editValidates】，TYPE:【"+f.name+"】;MESSAGE:【"+f.message+"】!"),b.passable=!1,b.addInfo(c.desc)}}else Ext.warn("["+a._defaultTitle+"]面板校验规则["+c.desc+"]函数配置有误，或者中途被改变，校验结果将按照成功计算")}),b):b):b:b},linkaging:function(a){var e,f,g,h,i,d=this;if(d.linkages){if(e=a.name,f=d.linkages[e],!f)return!1;g=d.getLinkFields(f.fields),h="字段:",i=!1,Ext.each(g,function(a){a.noFieldError&&(i=!0,h+="["+a.name+"]")}),i&&Ext.error("["+d._defaultTitle+"]面板["+e+"]字段联动错误。"+h+"不在定义的字段中。见【linkages|createLinkages|editLinkages】中fields属性"),g.unshift(a);try{f.fn.apply(d,g)}catch(j){Ext.error("["+d._defaultTitle+"]面板["+e+"]字段联动逻辑运行错误。见【linkages|createLinkages|editLinkages】中fn属性，TYPE:【"+j.name+"】;MESSAGE:【"+j.message+"】!")}}},getLinkFields:function(a){var b,c;return Ext.isArray(a)?(b=[],c=this,Ext.each(a,function(a){var d=c.contentPanel.getForm().findField(a);d?b.push(d):b.push({name:a,noFieldError:"field:["+a+"] is not found!"})}),b):!1}}),Ext.reg("cview",Wlj.frame.functions.app.widgets.CView),Wlj.frame.functions.app.widgets.BView=Ext.extend(Wlj.frame.functions.app.widgets.RView,{_defaultTitle:"Bview",ownerDomain:!1,ownerApp:!1,vs:!1,initComponent:function(){this.width=this.vs.width,Wlj.frame.functions.app.widgets.BView.superclass.initComponent.call(this)},getCustomerViewIndex:function(){return this.ownerDomain.getCustomerViewIndex(this)}}),Ext.reg("buisnessview",Wlj.frame.functions.app.widgets.BView),Wlj.frame.functions.app.widgets.FormView=Ext.extend(Wlj.frame.functions.app.widgets.BView,{autoLoadSeleted:!1,formButtons:!1,initComponent:function(){delete this.buttons,Wlj.frame.functions.app.widgets.FormView.superclass.initComponent.call(this),this.buildContentObject();var a=this;this.autoLoadSeleted&&this.on("movein",function(b){a.loadRecord(b)}),this.on("moveout",function(){a.reset()})},buildContentObject:function(){var a=this;this.resolveButtons(),this.contentPanel=new Ext.form.FormPanel({items:a.createGroups(),frame:!0,height:"auto",autoScroll:!0,buttonAlign:"center",labelAlign:"center",layout:"form",buttons:a.formButtons}),this.add(this.contentPanel)},resolveButtons:function(){var a=this.formButtons,b=this;Ext.each(a,function(a){delete a.handler,a.ownerView=b,Ext.isFunction(a.fn)&&(a.handler=function(){a.fn.call(b,b.contentPanel,b.contentPanel.getForm())})})},createGroups:function(){var a=[],b=this.groups,c=this;return Ext.each(b,function(b){a.push(c.createGroupPanel(b))}),a},createGroupPanel:function(a){var d,e,f,g,i,b={},c=this.vs;for(d=c.width>1024?4:c.width>800?3:c.width>500?2:1,Ext.isNumber(a.columnCount)&&(d=a.columnCount),e=a.fields,b.layout="column",a.labelWidth&&(b.labelWidth=a.labelWidth),b.items=new Array,f=0;d>f;f++)b.items.push({layout:"form",columnWidth:1/d});if(g=this.getFieldsCfg(e),Ext.isFunction(a.fn))try{g=a.fn.apply(this,g)}catch(h){g=g}else g=g;for(g||(g=[]),i=g.length-1;i>=0;)Ext.isObject(g[i])||g.remove(g[i]),i--;for(f=0;f<g.length;f++)b.items[f%d].items||(b.items[f%d].items=[]),b.items[f%d].items.push(g[f]);return b},getFieldsCfg:function(a){var b=[],c=this;return Ext.isArray(a)&&Ext.each(a,function(a){var d=!1;if(d=Ext.isEmpty(a)?!1:Ext.isString(a)?c.ownerApp.copyFieldsByName(a):a)if(d.fieldLabel=d.text?d.text:d.name,d.xtype=d.xtype?d.xtype:"textfield",d.hidden=d.text?!1:!0,d.anchor||(d.anchor="90%"),d.allowBlank===!1&&(d.fieldLabel=WLJTOOL.addBlankFlag(d.fieldLabel)),d.translateType){if(d.xtype=d.multiSelect?"lovcombo":"combo",d.store=c.ownerApp.lookupManager[d.translateType],!d.store)return Ext.error("字段【"+d.text+"】的数据字典映射项store【"+d.translateType+"】获取错误，请检查[lookupTypes|localLookup]项配置"),!1;d.valueField="key",d.displayField="value",d.editable="boolean"==typeof d.editable?d.editable:!1,d.forceSelection=!0,d.triggerAction="all",d.mode="local",d.hiddenName=d.name,d.separator=d.multiSeparator?d.multiSeparator:c.ownerDomain.multiSelectSeparator}else d.name=d.name,d.dataType&&WLJDATATYPE[d.dataType]&&(d.xtype=WLJDATATYPE[d.dataType].getFieldXtype(),Ext.applyIf(d,WLJDATATYPE[d.dataType].getFieldSpecialCfg()));b.push(d)}),b},getFormPanel:function(){return this.contentPanel()},reset:function(){this.contentPanel&&this.contentPanel.getForm()&&this.contentPanel.getForm().reset()},loadRecord:function(a){this.reset(),a&&this.contentPanel.getForm().loadRecord(a)},getFieldByName:function(a){return this.contentPanel.getForm().findField(a)},getValues:function(a){return a===!0?this.contentPanel.getForm().getValues(!0):this.contentPanel.getForm().getValues(!1)}}),Ext.reg("rformview",Wlj.frame.functions.app.widgets.FormView),Wlj.frame.functions.app.widgets.GridView=Ext.extend(Wlj.frame.functions.app.widgets.BView,{url:!1,fields:!1,pageable:!0,grideditable:!1,isCsm:!0,isRn:!0,buttons:!1,jsonCount:"json.count",jsonRoot:"json.data",initComponent:function(){Wlj.frame.functions.app.widgets.GridView.superclass.initComponent.call(this),this.collectFileds(),this.buildStore(),this.pageable&&this.buildPagingBar(),this.buildGrid(),this.add(this.grid)},collectFileds:function(){var d,a=[],b=this;if(Ext.isArray(b.fields.fields)&&Ext.each(b.fields.fields,function(c){if(Ext.isString(c)){var d=b.ownerApp.copyFieldsByName(c);d&&(d.header=d.text,d.text||(d.hidden=!0),d.dataIndex=d.name,delete d.xtype,d.dataType&&WLJDATATYPE[d.dataType]&&(d.type=WLJDATATYPE[d.dataType].getStoreType(),Ext.applyIf(d,WLJDATATYPE[d.dataType].getStoreSpecialCfg())),a.push(d))}else Ext.isObject(c)?c.name&&(c.header=c.text,c.text||(c.hidden=!0),c.dataIndex=c.name,delete c.xtype,c.dataType&&WLJDATATYPE[c.dataType]&&(c.type=WLJDATATYPE[c.dataType].getStoreType(),Ext.applyIf(c,WLJDATATYPE[c.dataType].getStoreSpecialCfg())),a.push(c)):a.push(!1)}),Ext.isFunction(b.fields.fn))try{a=b.fields.fn.apply(this,a)}catch(c){a=a}else a=a;for(d=a.length-1;d>=0;)a[d]||a.remove(a[d]),d--;b.fields.fields=a},buildStore:function(){var a=this;a.store=new Ext.data.Store({restful:!0,proxy:new Ext.data.HttpProxy({url:a.url}),reader:new Ext.data.JsonReader({totalProperty:a.jsonCount,root:a.jsonRoot},a.fields.fields)})},buildPagingBar:function(){var a=this;this.pagingCombo=new Ext.form.ComboBox({name:"pagesize",triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[[10,"10条/页"],[20,"20条/页"],[50,"50条/页"],[100,"100条/页"],[250,"250条/页"],[500,"500条/页"]]}),valueField:"value",displayField:"text",value:20,editable:!1,width:85}),this.pagingbar=new Ext.PagingToolbar({pageSize:parseInt(this.pagingCombo.getValue()),store:this.store,displayInfo:!0,displayMsg:"显示{0}条到{1}条,共{2}条",emptyMsg:"没有符合条件的记录",items:["-","&nbsp;&nbsp;",this.pagingCombo]}),this.pagingCombo.on("select",function(b){a.pagingbar.pageSize=parseInt(b.getValue()),a.store.reload({params:{start:0,limit:parseInt(b.getValue())}})})},createTbarCfg:function(){var a=[],b=this;return Ext.isArray(b.gridButtons)&&Ext.each(b.gridButtons,function(c){Ext.isFunction(c.fn)&&(c.handler=function(){c.fn.call(b,b.grid)}),a.push(c)}),a.length>0?a:!1},buildGrid:function(){var a=this;a.isCsm&&(a.csm=new Ext.grid.CheckboxSelectionModel,a.fields.fields.unshift(a.csm)),a.isRn&&(a.rn=new Ext.grid.RowNumberer({header:"No.",width:35}),a.fields.fields.unshift(a.rn)),this.grid=this.grideditable?new Ext.grid.EditorGridPanel({store:a.store,frame:!0,clicksToEdit:1,tbar:a.createTbarCfg(),viewConfig:{autoFill:!1},cm:new Ext.grid.ColumnModel(a.fields.fields),sm:a.isCsm?a.csm:null,footer:!1,bbar:a.pageable?a.pagingbar:!1}):new Ext.grid.GridPanel({store:a.store,frame:!0,tbar:a.createTbarCfg(),viewConfig:{autoFill:!1},cm:new Ext.grid.ColumnModel(a.fields.fields),sm:a.isCsm?a.csm:null,footer:!1,bbar:a.pageable?a.pagingbar:!1})},getStore:function(){return this.store},getGrid:function(){return this.grid},setParameters:function(a){delete this.currentParams,delete this.store.baseParams,this.currentParams=a,this.store.baseParams=a,this.pageable?this.store.load({params:{start:0,limit:this.pagingbar.pageSize}}):this.store.load()},getSeleted:function(){}}),Ext.reg("rgridview",Wlj.frame.functions.app.widgets.GridView),Ext.ns("Wlj.frame.functions.app.widgets"),Wlj.frame.functions.app.widgets.TreeManager=Ext.extend(Ext.util.Observable,{loaded:!1,constructor:function(a){this.loaders={},this.treesCfg={},this.dataStores={},Wlj.frame.functions.app.widgets.TreeManager.superclass.constructor.call(this,a)},addLoader:function(key,cfg){var _this,loader;return Ext.isString(key)?cfg.url?this.loaders[key]?(Ext.warn("错误","key["+key+"]:已存在对应loader对象，请修改key值"),!1):(_this=this,loader=new Com.yucheng.bcrm.ArrayTreeLoader(cfg),Ext.Ajax.request({url:cfg.url,method:"GET",success:function(response){var children,lookupstore,nodeArra=Ext.util.JSON.decode(response.responseText);if(Ext.isString(loader.jsonRoot))try{loader.nodeArray=eval("nodeArra."+loader.jsonRoot)}catch(e){loader.nodeArray=nodeArra}else loader.nodeArray=nodeArra;children=loader.loadAll(),lookupstore=new Ext.data.JsonStore({fields:[{name:"key",mapping:"id"},{name:"value",mapping:"text"}],data:loader.nodeArray}),_this.dataStores[key]=lookupstore,Ext.each(loader.supportedTrees,function(a){a.appendChild(children)}),Ext.isFunction(cfg.callback)&&cfg.callback.apply(loader,[loader])}}),this.loaders[key]=loader,loader):(Ext.warn("错误","loader["+key+"]创建失败，没有URL"),!1):(Ext.warn("错误","loader的key值设置失败，应配置为String类型。"),!1)},initTree:function(a,b){return Ext.isString(a)?this.treesCfg[a]?(Ext.warn("key["+a+"]:已存在对应tree面板配置，请修改key值"),!1):(this.treesCfg[a]=b,b):(Ext.warn("tree的key值设置失败，应配置为String类型。"),!1)},createTree:function(a){var b,c;return this.loaded||this.loadTreesCfgs(),Ext.isString(a)?(b=this.treesCfg[a])?(b.loaderKey&&!b.resloader&&(b.resloader=this.loaders[b.loaderKey]),c=Ext.apply({autoScroll:!0},b),c.rootCfg&&(c.root=new Ext.tree.AsyncTreeNode(c.rootCfg)),new Com.yucheng.bcrm.TreePanel(c)):(Ext.warn("["+a+"]:未查找到相关树形结构配置！"),!1):a.key?this.initTree(a.key,a)?this.createTree(a.key):void 0:(Ext.warn("树形面板配置没有key字段，请为其配置string类型唯一key值！"),!1)},loadTreesCfgs:function(){var a,b;this.checkTreesCfgs(),this.loaded=!0,Ext.log("初始化树形结构管理器！"),a=window.treeLoaders,b=window.treeCfgs,Ext.isArray(a)&&(Ext.each(a,function(a){TreeManager.addLoader(a.key,a)}),Ext.isArray(b)&&Ext.each(b,function(a){TreeManager.initTree(a.key,a)}))},checkTreesCfgs:function(){var a,b,c,d,e;if(Ext.log("树形结构配置检查，treeLoaders|treeCfgs"),a={},Ext.isArray(window.treeLoaders)){for(Ext.log("发现["+treeLoaders.length+"]个树形结构数据源配置:"),b=0;b<treeLoaders.length;b++)c=treeLoaders[b],c.key?c.url?c.parentAttr?c.locateAttr?c.rootValue?c.textField?c.idProperties?a[c.key]=c:Ext.warn("第["+b+"]个树形结构数据源无idProperties属性；将被忽略"):Ext.warn("第["+b+"]个树形结构数据源无textField属性；将被忽略"):Ext.warn("第["+b+"]个树形结构数据源无rootValue属性；将被忽略"):Ext.warn("第["+b+"]个树形结构数据源无locateAttr属性；将被忽略"):Ext.warn("第["+b+"]个树形结构数据源无parentAttr属性；将被忽略"):Ext.warn("第["+b+"]个树形结构数据源无url属性；将被忽略"):Ext.warn("第["+b+"]个树形结构数据源无key属性；将被忽略");Ext.log("树形结构数据源配置检查完毕")}else Ext.log("无树形结构数据源配置[treeLoaders],或配置结构不正确"),window.treeLoaders=!1,window.treeCfgs=!1;if(Ext.isArray(window.treeCfgs)){for(Ext.log("发现["+treeCfgs.length+"]个树形面板配置:"),d=0;d<treeCfgs.length;d++)e=treeCfgs[d],e.key?e.loaderKey&&(a[e.loaderKey]||Ext.warn("第["+d+"]个树形面板关联数据源不存在，请检查loaderKey属性！")):Ext.warn("第["+d+"]个树形面板无key属性；将被忽略");Ext.log("树形面板配置检查完毕")}else Ext.log("无树形面板配置[treeCfgs],或配置结构不正确"),window.treeCfgs=!1;Ext.log("树形结构配置treeLoaders|treeCfgs检查完毕")}}),TreeManager=new Wlj.frame.functions.app.widgets.TreeManager,Ext.ns("Wlj.frame.functions.app.widgets"),Wlj.frame.functions.app.widgets.ComboTree=Ext.extend(Ext.form.ComboBox,{innerTree:!1,showField:!1,hideField:!1,singleSelect:!0,anchor:"95%",mode:"local",resizable:!1,forceSelection:!0,triggerAction:"all",maxHeight:390,onSelect:Ext.emptyFn,assertValue:Ext.emptyFn,initComponent:function(){this.store=new Ext.data.SimpleStore({fields:[],data:[[]]}),this.tplId="innerContainer_"+this.id,this.tpl="<tpl for='.'><div id='"+this.tplId+"'></div></tpl>",Wlj.frame.functions.app.widgets.ComboTree.superclass.initComponent.call(this)},onRender:function(a,b){if(Wlj.frame.functions.app.widgets.ComboTree.superclass.onRender.call(this,a,b),!this.innerTree)return!1;"string"==typeof this.innerTree&&TreeManager?this.innerTree=TreeManager.createTree(this.innerTree):"object"==typeof this.innerTree&&!this.innerTree instanceof Ext.tree.TreePanel&&(this.innerTree=new Com.yucheng.bcrm.TreePanel(this.innerTree)),this.innerTree.frame=!0;var c=this;this.innerTree.on("click",function(a){c.clickFn(a)})},expand:function(){Wlj.frame.functions.app.widgets.ComboTree.superclass.expand.call(this),this.innerTree.rendered||(this.innerTree.render(this.tplId),this.innerTree.setHeight(390))},clickFn:function(a){var d,b=a.attributes;this.showField,d=this.hideField,this.setValue(b[d],a),this.singleSelect&&this.collapse()},setValue:function(a,b){if(b=b?b:this.innerTree.resloader.hasNodeByProperties(this.hideField,a)){this.selectedNode=b;var c=b.attributes?b.attributes[this.showField]:b[this.showField];this.showValue=c,Ext.form.ComboBox.superclass.setValue.call(this,a),this.el.dom.value=c}else this.selectedNode=!1,this.showValue=a,Ext.form.ComboBox.superclass.setValue.call(this,a);this.lastSelectionText=this.showValue},getValue:function(){return this.value?this.value:this.showValue},getShowValue:function(){return this.showValue},clearValue:function(){Wlj.frame.functions.app.widgets.ComboTree.superclass.clearValue.call(this),this.selectedNode=!1},getSelectNode:function(){return this.selectedNode}}),Ext.reg("wcombotree",Wlj.frame.functions.app.widgets.ComboTree),Ext.ns("Wlj.frame.functions.app"),Wlj.frame.functions.app.App=function(a){Ext.log("开始构建APP"),this.buildSpecilPatch(),this.pageSize=WLJUTIL.defaultPagesize,this.tbar=[],this.needRN=WLJUTIL.needRN,this.rnWidth=WLJUTIL.rnWidth,this.contextMenuAble=WLJUTIL.contextMenuAble,WLJUTIL.easingStrategy.indexOf(WLJUTIL.dataLineEasing)>=0?(this.easingStrtegy={},this.easingStrtegy.type=WLJUTIL.dataLineEasing,this.easingStrtegy.firstStep=WLJUTIL.firstStep,this.easingStrtegy.initialConfig=WLJUTIL[WLJUTIL.dataLineEasing]):this.easingStrtegy=!1,this.edgeViews={top:!1,left:!1,right:!1,buttom:!1},this.createView=!1,this.editView=!1,this.detailView=!1,this.createFormViewer=!1,this.editFormViewer=!1,this.detailFormViewer=!1,this.createValidates=!1,this.editValidates=!1,this.createLinkages=!1,this.editLinkages=!1,this.needGrid=!0,this.needTbar=!0,Ext.apply(this,a),this.needGrid===!1&&(this.needCondition=!1,this.needTbar=!1),this.searchTileBaseheight=this.needCondition?100:-8,this.comitUrl||(this.comitUrl=this.url),this.createView&&(this.createFormViewer||(this.createFormViewer=this.formViewers),this.createValidates||(this.createValidates=this.validates),this.createLinkages||(this.createLinkages=this.linkages)),this.editView&&(this.editFormViewer||(this.editFormViewer=this.formViewers),this.editValidates||(this.editValidates=this.validates),this.editLinkages||(this.editLinkages=this.linkages)),this.detailView&&(this.detailFormViewer||(this.detailFormViewer=this.formViewers)),this.initEvents(),Wlj.frame.functions.app.App.superclass.constructor.call(this),this.initAPI();var b=this.fireEvent("beforeinit",this);return b===!1?(Ext.error("beforeinit事件阻止APP构建，APP构建结束!"),!1):(this.lookupTypes||(this.lookupTypes=[]),this.prepareLookup(),this.init(),void 0)},Ext.extend(Wlj.frame.functions.app.App,Ext.util.Observable),Wlj.frame.functions.app.App.prototype.TRANS_TYPE={TO_JAVA:1,TO_SQL:2,NO_TRANS:3},Wlj.frame.functions.app.App.prototype.SEARCHFIELDTRANS=Wlj.frame.functions.app.App.prototype.TRANS_TYPE.NO_TRANS,Wlj.frame.functions.app.App.prototype.VIEWCOMMITTRANS=Wlj.frame.functions.app.App.prototype.TRANS_TYPE.TO_JAVA,Wlj.frame.functions.app.App.prototype.edgeViewBaseCfg={left:{layout:"accordion",xtype:"panel",width:200,height:"auto",frame:!0,region:"west",collapsible:!0},right:{layout:"accordion",xtype:"panel",width:200,height:"auto",frame:!0,region:"east",collapsible:!0},top:{layout:"form",xtype:"form",height:100,frame:!0,width:"auto",region:"north",defaultType:"textfield",collapsible:!0},buttom:{xtype:"tabpanel",height:100,frame:!0,width:"auto",region:"south",collapsible:!0,activeTab:0}},Wlj.frame.functions.app.App.prototype.init=function(){var a,b;if(this.vs=Ext.getBody().getViewSize(),Ext.log("开始构建APP内部对象"),this.buildEdgeViews(),this.buildMajor(),this.render(),this.fireEvent("afterinit",this),Ext.log("APP构建结束！"),this.clearSite(),WLJUTIL.pluginTrigger&&(this.plugins={},Wlj.frame.functions.plugin))for(a in Wlj.frame.functions.plugin)Ext.log("加载插件【"+a+"】！"),b=new Wlj.frame.functions.plugin[a]({appObject:this}),b.destroyed?Ext.log("插件【"+a+"】未装载"):(this.plugins[a]=b,Ext.log("插件【"+a+"】已装载"))},Wlj.frame.functions.app.App.prototype.clearSite=function(){window.needCondition=!0,window.needTbar=!0,window.needGrid=!0,window.url=!1,window.comitUrl=!1,window.fields=!1,window.createView=!1,window.editView=!1,window.detailView=!1,window.createFormViewer=!1,window.editFormViewer=!1,window.detailFormViewer=!1,window.lookupTypes=!1,window.localLookup=!1,window.createValidates=!1,window.editValidates=!1,window.createLinkages=!1,window.editLinkages=!1,window.edgeViews=!1,window.customerView=!1,window.listeners=!1,window.tbar=!1,window.createFormCfgs=!1,window.editFormCfgs=!1,window.detailFormCfgs=!1,window.formViewers=!1,window.formCfgs=!1,window.validates=!1,window.linkages=!1,window.beforeinit=!1,window.afterinit=!1,window.beforeconditioninit=!1,window.afterconditioninit=!1,window.beforeconditionrender=!1,window.afterconditionrender=!1,window.beforeconditionadd=!1,window.conditionadd=!1,window.beforeconditionremove=!1,window.conditionremove=!1,window.beforedyfieldclear=!1,window.afterdyfieldclear=!1,window.beforeconditioncollapse=!1,window.afterconditioncollapse=!1,window.beforeconditionexpand=!1,window.afterconditionexpand=!1,window.recordselect=!1,window.rowdblclick=!1,window.load=!1,window.beforesetsearchparams=!1,window.setsearchparams=!1,window.beforeresultinit=!1,window.afterresultinit=!1,window.beforeresultrender=!1,window.afterresultrender=!1,window.beforecreateviewrender=!1,window.aftercreateviewrender=!1,window.beforeeditviewrender=!1,window.aftereditviewrender=!1,window.beforedetailviewrender=!1,window.afterdetailviewrender=!1,window.beforeviewshow=!1,window.viewshow=!1,window.beforeviewhide=!1,window.viewhide=!1,window.beforevalidate=!1,window.validate=!1,window.beforecommit=!1,window.afertcommit=!1,window.beforeeditload=!1,window.aftereditload=!1,window.beforedetailload=!1,window.afterdetailload=!1,window.beforetophide=!1,window.tophide=!1,window.beforetopshow=!1,window.topshow=!1,window.beforelefthide=!1,window.lefthide=!1,window.beforeleftshow=!1,window.leftshow=!1,window.beforebuttomhide=!1,window.buttomhide=!1,window.beforebuttomshow=!1,window.buttomshow=!1,window.beforerighthide=!1,window.righthide=!1,window.beforerightshow=!1,window.rightshow=!1,window.lookupinit=!1,window.locallookupinit=!1,window.alllookupinit=!1,window.beforelookupreload=!1,window.lookupreload=!1,window.beforetreecreate=!1,window.treecreate=!1},Wlj.frame.functions.app.App.prototype.destroy=function(){this.infoDD&&(this.infoDD.removeAllListeners(),Ext.destroy(this.infoDD),this.infoDD=!1),this.destroyLookups(),this.clearAPI(),this.purgeListeners(),this.viewPort.destroy(),this.majorPanel=null,this.searchDomain=null,this.resultDomain=null,this.fields=null,this.customerView=!1,this.edgeViews={top:!1,left:!1,right:!1,buttom:!1},window._app=null},Wlj.frame.functions.app.App.prototype.initEvents=function(){Ext.log("初始化APP对象事件！"),this.addEvents({beforeinit:!0,afterinit:!0,beforeconditioninit:!0,afterconditioninit:!0,beforeconditionrender:!0,afterconditionrender:!0,beforeconditionadd:!0,conditionadd:!0,beforeconditionremove:!0,conditionremove:!0,beforedyfieldclear:!0,afterdyfieldclear:!0,beforeconditioncollapse:!0,afterconditioncollapse:!0,beforeconditionexpand:!0,afterconditionexpand:!0,beforecondtitionfieldvalue:!0,condtitionfieldvalue:!0,recordselect:!0,rowdblclick:!0,load:!1,beforesetsearchparams:!0,setsearchparams:!0,beforeresultinit:!0,afterresultinit:!0,beforeresultrender:!0,afterresultrender:!0,beforecreateviewrender:!0,aftercreateviewrender:!0,beforeeditviewrender:!0,aftereditviewrender:!0,beforedetailviewrender:!0,afterdetailviewrender:!0,beforeviewshow:!0,viewshow:!0,beforeviewhide:!0,viewhide:!0,beforevalidate:!0,validate:!0,beforecommit:!0,afertcommit:!0,beforeeditload:!1,aftereditload:!1,beforedetailload:!0,afterdetailload:!0,beforetophide:!1,tophide:!1,beforetopshow:!1,topshow:!1,beforelefthide:!1,lefthide:!1,beforeleftshow:!1,leftshow:!1,beforebuttomhide:!1,buttomhide:!1,beforebuttomshow:!1,buttomshow:!1,beforerighthide:!1,righthide:!1,beforerightshow:!1,rightshow:!1,lookupinit:!0,locallookupinit:!0,alllookupinit:!0,beforelookupreload:!0,lookupreload:!0,beforetreecreate:!1,treecreate:!1})},Wlj.frame.functions.app.App.prototype.initAPI=function(){if(Ext.log("开始准备API!"),"undefined"==typeof API||!Ext.isObject(API))return Ext.log("NO API CONFIG, NONE API BUILT!"),!1;for(var a in API)if(API[a]){if(Ext.isFunction(this[a])){window[a]=this[a].createDelegate(this),Ext.log("BUILD API 【"+a+"】!");continue}Ext.warn("API【"+a+"】准备出错，因为APP对象不具备该方法！"),API[a]=!1}else;Ext.log("API准备完毕！")},Wlj.frame.functions.app.App.prototype.clearAPI=function(){for(var a in API)window[a]=null},Wlj.frame.functions.app.App.prototype.fireEvent=function(){var c,a=arguments[0],b=!0;if(!a)return b;if(Ext.log("触发事件：【"+arguments[0]+"】:接收到【"+(arguments.length-1)+"】个参数！"),!this.hasListener(a))return Ext.log("【"+arguments[0]+"】未绑定逻辑，事件调用结束！"),b;try{for(c=0;c<this.events[a].listeners.length;c++)Ext.log("fn["+c+"]:"+this.events[a].listeners[0].fn.toString());b=Wlj.frame.functions.app.App.superclass.fireEvent.apply(this,arguments)}catch(d){Ext.error("事件【"+arguments[0]+"】：执行出错。TYPE:【"+d.name+"】;MESSAGE:【"+d.message+"】!"),b=!1}finally{return Ext.log("【"+arguments[0]+"】事件结束!"),b}},Wlj.frame.functions.app.App.prototype.prepareLookup=function(){var a,b,c,d,e;Ext.log("开始构建数据字典项管理器！"),this.lookupManager={},a=this,Ext.log("构建本地字典项");for(b in this.localLookup)Ext.log("构建本地字典项：["+b+"]；"),c=this.localLookup[b],d=new Ext.data.JsonStore({fields:["key","value"]}),d.loadData(c),this.lookupManager[b]=d,a.fireEvent("locallookupinit",b,d);Ext.log("本地字典项构建完毕"),Ext.log("开始构建远程字典项"),e=0,Ext.each(a.lookupTypes,function(b){var c=null;Ext.isString(b)?(Ext.log("构建远程字典项:["+b+"];"),c=new Ext.data.Store({sortInfo:{field:"key",direction:WLJUTIL.lookupSortDirect},restful:!0,proxy:new Ext.data.HttpProxy({url:basepath+"/lookup.json?name="+b}),reader:new Ext.data.JsonReader({root:"JSON"},["key","value"])}),a.lookupManager[b]=c):(Ext.log("构建远程字典项:["+b.TYPE+"];"),c=new Ext.data.Store({restful:!0,proxy:new Ext.data.HttpProxy({url:basepath+b.url}),reader:new Ext.data.JsonReader({root:b.root?b.root:"json.data"},[{name:"key",mapping:b.key},{name:"value",mapping:b.value}])}),a.lookupManager[b.TYPE]=c),b.autoLoadItems!==!1&&c.load({callback:function(){a.fireEvent("lookupinit",b,c),e++,e==a.lookupTypes.length&&a.fireEvent("alllookupinit",a.lookupManager)
}})})},Wlj.frame.functions.app.App.prototype.destroyLookups=function(){for(var a in this.lookupManager)this.lookupManager[a].destroy(),this.lookupManager[a]=null},Wlj.frame.functions.app.App.prototype.bootSearchDomain=function(){var a=this;Ext.log("构建查询条件域"),this.searchDomain=new Wlj.frame.functions.app.widgets.SearchContainer(a.createSearchCfg())},Wlj.frame.functions.app.App.prototype.createSearchCfg=function(){var c,d,a=this,b=[];for(a.searchDomainCfg&&Ext.isArray(a.searchDomainCfg.condtionFields)?Ext.each(a.searchDomainCfg.condtionFields,function(c){var d=!1;d=Ext.isString(c)?a.buildConditionField(a.getFieldsByName(c)):a.buildConditionField(c),d&&b.push(d)}):Ext.each(this.fields,function(c){if(c.searchField===!0){var d=a.buildConditionField(c);d&&b.push(d)}}),a.searchDomainCfg&&Ext.isFunction(a.searchDomainCfg.fieldFn)&&(b=a.searchDomainCfg.fieldFn.apply(a,b)),c=b.length-1;c>=0;c--)b[c]||b.remove(b[c]);return d={vs:this.seearchVs,region:"north",_APP:this,layout:"fit",itemsArray:b,buttonCfg:WLJUTIL.conditionButtons,multiSelectSeparator:WLJUTIL.multiSelectSeparator,items:[],hidden:!this.needCondition,needCloseLable4DCF:WLJUTIL.needCloseLable4DCF,listeners:{beforeconditionadd:function(b,c,d){return a.fireEvent("beforeconditionadd",b,c,d)},conditionadd:function(b,c){a.fireEvent("conditionadd",b,c)},beforeconditionremove:function(b,c){return a.fireEvent("beforeconditionremove",b,c)},conditionremove:function(b){a.fireEvent("conditionremove",b)},beforedyfieldclear:function(b,c,d){return a.fireEvent("beforedyfieldclear",b,c,d)},afterdyfieldclear:function(b,c,d){a.fireEvent("afterdyfieldclear",b,c,d)},beforecondtitionfieldvalue:function(b,c,d){return a.fireEvent("beforecondtitionfieldvalue",b,c,d)},condtitionfieldvalue:function(b,c,d){a.fireEvent("condtitionfieldvalue",b,c,d)}}},this.searchDomainCfg&&Ext.apply(d,this.searchDomainCfg),d},Wlj.frame.functions.app.App.prototype.bootResultDomain=function(){Ext.log("构建查询结果域"),this.resultDomain=new Wlj.frame.functions.app.widgets.ResultContainer(this.createResultCfg())},Wlj.frame.functions.app.App.prototype.createResultCfg=function(){var a=this,b={};return b.needRN=this.needRN,b.rnWidth=this.rnWidth,b.multiSelectSeparator=WLJUTIL.multiSelectSeparator,b.pageSize=this.pageSize,b.url=this.url,b.tbar=this.tbar,b.dataFields=this.getFieldsCopy(),b._APP=this,b.loadMaskMsg=WLJUTIL.loadMaskMsg,b.gridLockedHole=WLJUTIL.suspendViews?!0:!1,b.suspendViews=WLJUTIL.suspendViews,b.alwaysLockCurrentView=WLJUTIL.alwaysLockCurrentView,b.suspendViewsWidth=WLJUTIL.viewPanelsWidth,b.tbarButtonAlign=WLJUTIL.tbarButtonAlign,b.tbarViewAlign=WLJUTIL.tbarViewAlign,b.easingStrtegy=this.easingStrtegy,b.region="center",b.vs=this.resultVs,b.needGrid=!(this.needGrid===!1),b.needTbar=!(this.needTbar===!1),b.autoLoadGrid=!(this.autoLoadGrid===!1),b.createView=!1,b.editView=!1,b.detailView=!1,b.createFormCfgs=this.createFormCfgs,b.editFormCfgs=this.editFormCfgs,b.detailFormCfgs=this.detailFormCfgs,b.listeners={beforeviewhide:function(b){return a.fireEvent("beforeviewhide",b)},viewhide:function(b){a.fireEvent("viewhide",b)},beforeviewshow:function(b){return a.fireEvent("beforeviewshow",b)},viewshow:function(b){a.fireEvent("viewshow",b)},recordselect:function(b,c,d){a.fireEvent("recordselect",b,c,d)},beforevalidate:function(b,c){return a.fireEvent("beforevalidate",b,c)},validate:function(b,c,d){a.fireEvent("validate",b,c,d)},beforecreateviewrender:function(b){return a.fireEvent("beforecreateviewrender",b)},aftercreateviewrender:function(b){a.fireEvent("aftercreateviewrender",b)},beforeeditviewrender:function(b){return a.fireEvent("beforeeditviewrender",b)},aftereditviewrender:function(b){a.fireEvent("aftereditviewrender",b)},beforedetailviewrender:function(b){return a.fireEvent("beforedetailviewrender",b)},afterdetailviewrender:function(b){a.fireEvent("afterdetailviewrender",b)},rowdblclick:function(b,c){a.fireEvent("rowdblclick",b,c)}},this.createView&&this.createFormViewer&&(b.createFieldsCopy=this.getFieldsCopy(),b.createFormViewer=this.createFormViewer,b.createValidates=this.createValidates,b.createLinkages=this.createLinkages,b.createView=!0),this.editView&&this.editFormViewer&&(b.editFieldsCopy=this.getFieldsCopy(),b.editFormViewer=this.editFormViewer,b.editValidates=this.editValidates,b.editLinkages=this.editLinkages,b.editView=!0),this.detailView&&this.detailFormViewer&&(b.detailFieldsCopy=this.getFieldsCopy(),b.detailFormViewer=this.detailFormViewer,b.detailView=!0),b},Wlj.frame.functions.app.App.prototype.buildMajor=function(){var i,a="left",b="right",c="top",d="buttom",e=0,f=0,g=0,h=0;Ext.log("构建主查询区域"),this.edgeViews[a]&&(e=this.edgeViews[a].width),this.edgeViews[b]&&(f=this.edgeViews[b].width),this.edgeViews[c]&&(g=this.edgeViews[c].height),this.edgeViews[d]&&(h=this.edgeViews[d].height),this.seearchVs={width:this.vs.width-e-f,height:this.searchTileBaseheight},this.resultVs={width:this.vs.width-e-f,height:this.vs.height-g-h-this.searchTileBaseheight},this.bootSearchDomain(),this.bootResultDomain(),i=this,this.majorPanel=new Ext.Panel({frame:!0,layout:"form",height:this.vs.height-g-h,width:this.vs.width-e-f,region:"center",listeners:{resize:function(a,b){Ext.isNumber(b)&&(i.searchDomain.setWidth(b),i.resultDomain.setWidth(b));var f=this.body.getViewSize().height;i.needCondition?Ext.isNumber(f)&&i.searchDomain.rendered&&i.resultDomain.setHeight(f-i.searchDomain.el.getHeight()+8):Ext.isNumber(f)&&i.resultDomain.setHeight(f)}},items:[this.searchDomain,this.resultDomain]})},Wlj.frame.functions.app.App.prototype.buildEdgeViews=function(){var a="left",b="right",c="top",d="buttom",e=this.edgeViews;e[a]&&(Ext.log("构建左部面板"),e[a].panel=this.createEdgeView(a,e[a])),e[b]&&(Ext.log("构建右部面板"),e[b].panel=this.createEdgeView(b,e[b])),e[c]&&(Ext.log("构建顶部面板"),e[c].panel=this.createEdgeView(c,e[c])),e[d]&&(Ext.log("构建底部面板"),e[d].panel=this.createEdgeView(d,e[d]))},Wlj.frame.functions.app.App.prototype.createEdgeView=function(a,b){var d,e,c=!1;return b?(d=this.edgeViewBaseCfg[a],Ext.applyIf(b,d),c=b,e=this,c.listeners?c.listeners.afterrender=function(a){a.el.on("contextmenu",function(a){a.stopEvent(),e.onContextMenu(a,[])})}:c.listeners={afterrender:function(a){a.el.on("contextmenu",function(a){a.stopEvent(),e.onContextMenu(a,[])})}},c):c},Wlj.frame.functions.app.App.prototype.render=function(){var a="left",b="right",c="top",d="buttom",e=this,f=[];this.edgeViews[a]&&f.push(this.edgeViews[a].panel),this.edgeViews[b]&&f.push(this.edgeViews[b].panel),this.edgeViews[c]&&f.push(this.edgeViews[c].panel),this.edgeViews[d]&&f.push(this.edgeViews[d].panel),f.push(this.majorPanel),Ext.log("页面渲染！"),this.viewPort=new Ext.Viewport({layout:"border",items:f,listeners:{afterrender:function(){e.searchDomain.fixSearchHeight()}}})},Wlj.frame.functions.app.App.prototype.onContextMenu=function(a,b){var c,d,e;if(!this.contextMenuAble)return!1;c=WLJUTIL.contextMenus.window;for(d in c)e={},e.text=c[d].text,e.handler=c[d].fn.createDelegate(this),b.push(e);new Ext.menu.Menu({items:b}).showAt(a.getXY())},Wlj.frame.functions.app.App.prototype.onMetaAdd=function(a){this.fields.push(a),this.resultDomain.onMetaAdd(a)},Wlj.frame.functions.app.App.prototype.onMetaRemove=function(a){var b=this.getFieldsByName(a);return b?(this.fields.remove(b),this.resultDomain.onMetaRemove(a),void 0):!1},Wlj.frame.functions.app.App.prototype.onMetaAddAfter=function(a,b){this.getFieldsByName(b)?this.resultDomain.onMetaAddAfter(a,b):this.onMetaAdd(a)},Wlj.frame.functions.app.App.prototype.onMetaAddBefore=function(a,b){this.getFieldsByName(b)?this.resultDomain.onMetaAddBefore(a,b):this.onMetaAdd(a)},Wlj.frame.functions.app.App.prototype.buildSpecilPatch=function(){Ext.util.JSON.encodeDate=function(a){return'"'+a.format(WLJUTIL.defaultDateFormat)+'"'}},Wlj.frame.functions.app.App.prototype.buildConditionField=function(a){var c,b=this;return a&&a.name&&a.text?(c={},c.xtype=a.xtype?a.xtype:a.translateType?a.multiSelect?"lovcombo":"combo":"textfield",c.store=a.translateType?b.lookupManager[a.translateType]:!1,a.translateType?(c.valueField="key",c.displayField="value",c.editable="boolean"==typeof a.editable?a.editable:!1,c.forceSelection=!0,c.triggerAction="all",c.mode="local",c.hiddenName=a.name,c.separator=a.multiSeparator?a.multiSeparator:WLJUTIL.multiSelectSeparator):c.name=a.name,Ext.applyIf(c,a),delete c.allowBlank,c.fieldLabel=a.text?a.text:a.name,c):!1},Wlj.frame.functions.app.App.prototype.setSearchSize=function(a){var b,c,d,g,h;return this.needCondition?(Ext.isNumber(a.height)&&(b=a.height),Ext.isNumber(a.width)&&(c=a.width),d=this.searchDomain,this.searchDomain.searchPanel,d.el?d.el.getViewSize():this.seearchVs,g=this.resultDomain,h=this.majorPanel.el?this.majorPanel.el.getViewSize():{height:0,width:0},Ext.isNumber(b)&&(d.setHeight(b),g.setHeight(h.height-b)),Ext.isNumber(c)&&d.setWidth(c+"px"),void 0):!1},Wlj.frame.functions.app.App.prototype.findLookupByType=function(a){return a?this.lookupManager[a]?this.lookupManager[a]:!1:!1},Wlj.frame.functions.app.App.prototype.reloadLookup=function(a,b){var e,f,g,h,c=this.findLookupByType(a),d=this;if(!c)return!1;if(!c.proxy)return Ext.warn("数据字典类型【"+a+"】为本地数据字典，无法reload！"),!1;if(e=b?b.callback:!1,f=function(f,g,h){Ext.log("lookup store : "+a+" has bean reload!"),d.fireEvent("lookupreload",a,c,f,b,h),Ext.isFunction(e)&&e.call(c,f,b,h)},g=this.fireEvent("beforelookupreload",a,c,b),g===!1)return!1;h={},Ext.apply(h,b),h.callback=f;try{c.reload(h)}catch(i){Ext.error("reload lookup "+a+" error!")}},Wlj.frame.functions.app.App.prototype.translateLookupByKey=function(a,b){var d,e,c=this.findLookupByType(a);return c?(d=c.findExact("key",b),0>d?b:(e=c.getAt(d),e.get("value"))):b},Wlj.frame.functions.app.App.prototype.translateLookupByValue=function(a,b){var d,e,c=this.findLookupByType(a);return c?(d=c.findExact("value",b),0>d?!1:(e=c.getAt(d),e.get("key"))):!1},Wlj.frame.functions.app.App.prototype.translateLookupByMultiKey=function(a,b,c){var e,f,d=this.findLookupByType(a);return d&&c?(e=b.split(c),f="",Ext.each(e,function(a){var b=d.findExact("key",a);f+=0>b?a:d.getAt(b).get("value"),f+=c}),f=f.substring(0,f.lastIndexOf(c))):b},Wlj.frame.functions.app.App.prototype.translateLookupByMultiValue=function(a,b,c){var e,f,d=this.findLookupByType(a);return d&&c?(e=b.split(c),f="",Ext.each(e,function(a){var b=d.findExact("value",a);f+=0>b?a:d.getAt(b).get("key"),f+=c}),f=f.substring(0,f.lastIndexOf(c))):b},Wlj.frame.functions.app.App.prototype.setSearchParams=function(a,b,c,d,e){var f=this.resultDomain,g=this.fireEvent("beforesetsearchparams",a,b,c,d);return g===!1?!1:a?(c===!1?f.searchGridView.currentParams||(f.searchGridView.currentParams={}):(delete f.searchGridView.currentParams,f.searchGridView.currentParams={}),d=d?d:this.SEARCHFIELDTRANS,Ext.apply(f.searchGridView.currentParams,this.translateDataKey(a,d)),f.searchGridView.currentPage=0,this.fireEvent("setsearchparams",a,b,c,d),b===!1?f.searchGridView.store.baseParams={condition:Ext.encode(f.searchGridView.currentParams)}:f.searchGridView.turnToCurrentPage(e),void 0):!1},Wlj.frame.functions.app.App.prototype.getResultStore=function(){return this.resultDomain.store},Wlj.frame.functions.app.App.prototype.reloadCurrentData=function(){this.resultDomain.searchGridView.turnToCurrentPage()},Wlj.frame.functions.app.App.prototype.getSelectedData=function(){var a=this.resultDomain.searchGridView.getSelected();return a.length<=0?!1:a[a.length-1]},Wlj.frame.functions.app.App.prototype.getAllSelects=function(){return this.resultDomain.searchGridView.getSelected()},Wlj.frame.functions.app.App.prototype.hasSelected=function(){return this.resultDomain.searchGridView.getSelected().length>0},Wlj.frame.functions.app.App.prototype.selectByIndex=function(a){this.resultDomain.searchGridView.selectByIndex(a)},Wlj.frame.functions.app.App.prototype.clearSelect=function(){this.resultDomain.searchGridView.clearSelect()},Wlj.frame.functions.app.App.prototype.antiSelect=function(){this.resultDomain.searchGridView.antiSelect()},Wlj.frame.functions.app.App.prototype.allSelect=function(){this.resultDomain.searchGridView.allSelect()},Wlj.frame.functions.app.App.prototype.comitData=function(a,b){var f,g,d=b?b:this.comitUrl,e=this.fireEvent("beforecommit",a,d);return e===!1?!1:d?(f=this.translateDataKey(a,this.VIEWCOMMITTRANS),"{}"===Ext.encode(f)?(Ext.Msg.alert("提示","提交数据为空！"),!1):(g=this,Ext.Ajax.request({url:d,method:"POST",params:f,success:function(){Ext.Msg.alert("提示","保存成功"),g.fireEvent("afertcommit",a,d,!0),g.needGrid!==!1&&g.reloadCurrentData()},failure:function(){g.fireEvent("afertcommit",a,d,!1)}}),void 0)):!1},Wlj.frame.functions.app.App.prototype.deleteData=function(){},Wlj.frame.functions.app.App.prototype.translateDataKey=function(a,b){function e(a){var b,d,e,f,g,h,i;if(1==c){if(b=a.toLowerCase().split("_"),d="",b.length<=0)return d;for(e=1;e<b.length;e++)b[e]=b[e].substring(0,1).toUpperCase()+b[e].substring(1);return d=b.join("")}if(2==c){if(0==a.length)return!1;for(f=a.length,g=[],h=0,i=0;f>i;)a.charCodeAt(i)<=90&&a.charCodeAt(i)>=65&&(g.push(a.substring(h,i).toUpperCase()),h=i),i++;return g.push(a.substring(h,f).toUpperCase()),g.join("_")}return a}var f,c=2===b?2:1===b?1:3,d={};for(f in a)a[f]&&(d[e(f)]=a[f]);return d},Wlj.frame.functions.app.App.prototype.reboot=function(){},Wlj.frame.functions.app.App.prototype.getFieldsByName=function(a){var b,c,d,e;if(!this.fields)return!1;if(!a)return!1;if(b=this,Ext.isArray(a))return c=new Array,Ext.each(a,function(a){Ext.each(b.fields,function(b){b.name===a&&c.push(b)})}),c.length>0?c:!1;if(Ext.isString(a))for(d=0;d<this.fields.length;d++)if(e=this.fields[d],e.name===a)return e;return!1},Wlj.frame.functions.app.App.prototype.copyFieldsByName=function(a){var c,b=this.getFieldsByName(a);return b?Ext.isArray(b)?(c=new Array,Ext.each(b,function(a){var b={};Ext.apply(b,a),c.push(b)}),c):(c={},Ext.apply(c,b),c):!1},Wlj.frame.functions.app.App.prototype.getFieldsCopy=function(){var a=[];return Ext.each(this.fields,function(b){var c={};Ext.apply(c,b),a.push(c)}),a},Wlj.frame.functions.app.App.prototype.collapseSearchPanel=function(){if(this.searchDomain.WCLP)return!1;var a=this.fireEvent("beforeconditioncollapse",this.searchDomain);return a===!1?!1:(this.searchDomain.realHeight=this.searchDomain.getHeight(),this.searchDomain.collapse(),this.setSearchSize({height:0}),this.searchDomain.WCLP=!0,this.fireEvent("afterconditioncollapse",this.searchDomain),void 0)},Wlj.frame.functions.app.App.prototype.expandSearchPanel=function(){if(!this.searchDomain.WCLP)return!1;var a=this.fireEvent("beforeconditionexpand",this.searchDomain);return a===!1?!1:(this.searchDomain.expand(),Ext.isNumber(this.searchDomain.realHeight)&&this.setSearchSize.defer(150,this,[{height:this.searchDomain.realHeight}]),this.searchDomain.WCLP=!1,this.fireEvent("afterconditionexpand",this.searchDomain),void 0)},Wlj.frame.functions.app.App.prototype.getEdgePanel=function(a){var b={left:"west",west:"west",right:"east",east:"east",top:"north",north:"north",buttom:"south",south:"south"};return this.viewPort.rendered&&this.viewPort.layout[b[a]]?this.viewPort.layout[b[a]].panel:!1},Wlj.frame.functions.app.App.prototype.resetCondition=function(a){this.searchDomain.resetCondition(a)},Wlj.frame.functions.app.App.prototype.getCurrentView=function(){return this.resultDomain.currentView},Wlj.frame.functions.app.App.prototype.hideCurrentView=function(){WLJUTIL.suspendViews?this.resultDomain.hideCurrentView():this.resultDomain.gridMoveIn()},Wlj.frame.functions.app.App.prototype.getDetailView=function(){return this.resultDomain.viewPanel.detailView?this.resultDomain.viewPanel.detailView:!1},Wlj.frame.functions.app.App.prototype.getCreateView=function(){return this.resultDomain.viewPanel.createView?this.resultDomain.viewPanel.createView:!1},Wlj.frame.functions.app.App.prototype.getEditView=function(){return this.resultDomain.viewPanel.editView?this.resultDomain.viewPanel.editView:!1},Wlj.frame.functions.app.App.prototype.showDetailView=function(){var a=this.getDetailView();return a&&a!=this.getCurrentView()?(this.resultDomain.showView(a),void 0):!1},Wlj.frame.functions.app.App.prototype.showCreateView=function(){var a=this.getCreateView();return a&&a!=this.getCurrentView()?(this.resultDomain.showView(a),void 0):!1},Wlj.frame.functions.app.App.prototype.showEditView=function(){var a=this.getEditView();return a&&a!=this.getCurrentView()?(this.resultDomain.showView(a),void 0):!1},Wlj.frame.functions.app.App.prototype.getCustomerViewByTitle=function(a){var c,b=this.resultDomain.customerViewPanels;for(c=0;c<b.length;c++)if(b[c]._defaultTitle==a)return b[c];return!1},Wlj.frame.functions.app.App.prototype.getCustomerViewByIndex=function(a){var b=this.resultDomain.customerViewPanels;return b[a]?b[a]:!1},Wlj.frame.functions.app.App.prototype.showCustomerViewByTitle=function(a){var b=this.getCustomerViewByTitle(a);return b&&b!==this.getCurrentView()?(this.resultDomain.showView(b),void 0):!1},Wlj.frame.functions.app.App.prototype.showCustomerViewByIndex=function(a){var b=this.getCustomerViewByIndex(a);return b&&b!==this.getCurrentView()?(this.resultDomain.showView(b),void 0):!1},Wlj.frame.functions.app.App.prototype.lockGrid=function(){this.resultDomain.gridLockedOnce=!0},Wlj.frame.functions.app.App.prototype.unlockGrid=function(){this.resultDomain.gridLockedOnce=!1},Wlj.frame.functions.app.App.prototype.showNextView=function(){this.resultDomain.showNextView()},Wlj.frame.functions.app.App.prototype.sortByDataIndex=function(a,b){this.resultDomain.searchGridView.sort(a,b)},Wlj.frame.functions.app.App.prototype.showGridFields=function(a){this.resultDomain.searchGridView.showFields(a)},Wlj.frame.functions.app.App.prototype.hideGridFields=function(a){this.resultDomain.searchGridView.hideFields(a)},Wlj.frame.functions.app.App.prototype.getGridHiddenFields=function(){return this.resultDomain.searchGridView.getHiddenFields()},Wlj.frame.functions.app.App.prototype.addConditionField=function(a){this.searchDomain.addField(a)},Wlj.frame.functions.app.App.prototype.removeConditionField=function(a){this.searchDomain.removeField(a)},Wlj.frame.functions.app.App.prototype.getConditionField=function(a){return this.searchDomain.getField(a)},Wlj.frame.functions.app.App.prototype.hasConditionField=function(a){return this.getConditionField(a)?!0:!1},Wlj.frame.functions.app.App.prototype.addMetaField=function(a){return Ext.isObject(a)?a.name?this.getFieldsByName(a.name)?!1:(this.onMetaAdd(a),void 0):!1:!1},Wlj.frame.functions.app.App.prototype.removeMetaField=function(a){var b="";if(Ext.isObject(a)){if(!a.name)return!1;b=a.name}else Ext.isString(a)&&(b=a);this.onMetaRemove(a)},Wlj.frame.functions.app.App.prototype.addMetaAfter=function(a,b){return Ext.isObject(a)?a.name?this.getFieldsByName(a.name)?!1:(this.onMetaAddAfter(a,b),void 0):!1:!1},Wlj.frame.functions.app.App.prototype.addMetaBefore=function(a,b){return Ext.isObject(a)?a.name?this.getFieldsByName(a.name)?!1:(this.onMetaAddBefore(a,b),void 0):!1:!1},Wlj.frame.functions.app.App.prototype.hasConditionButton=function(a){return this.searchDomain.hasConditionButton(a)},Wlj.frame.functions.app.App.prototype.disableConditionButton=function(a){this.searchDomain.disableConditionButton(a)},Wlj.frame.functions.app.App.prototype.enableConditionButton=function(a){this.searchDomain.enableConditionButton(a)},Wlj.frame.functions.app.App.prototype.hideConditionButton=function(a){this.searchDomain.hideConditionButton(a)},Wlj.frame.functions.app.App.prototype.showConditionButton=function(a){this.searchDomain.showConditionButton(a)},Wlj.frame.functions.app.App.prototype.maskRegion=function(a,b){function d(a){"searchDomain"==a?c.searchDomain&&c.searchDomain.getEl().mask(b):"resultDomain"==a?c.resultDomain&&c.resultDomain.getEl().mask(b):c.getEdgePanel(a)&&c.getEdgePanel(a).getEl().mask(b)}var c=this;a instanceof Array?a.forEach(d):d(a)},Wlj.frame.functions.app.App.prototype.unmaskRegion=function(a){function c(a){"searchDomain"==a?b.searchDomain&&b.searchDomain.getEl().unmask():"resultDomain"==a?b.resultDomain&&b.resultDomain.getEl().unmask():b.getEdgePanel(a)&&b.getEdgePanel(a).getEl().unmask()}var b=this;a instanceof Array?a.forEach(c):c(a)},Wlj.frame.functions.app.App.prototype.openCustomerView=function(a){Ext.isFunction(top.window.openCustomerView)&&top.window.openCustomerView(a)},Wlj.frame.functions.app.App.prototype.setFieldTile=function(a){var b=this;Ext.isArray(a)?Ext.each(a,function(a){b.setFieldTile(a)}):Ext.isObject(a)&&a.name&&a.text&&this.resultDomain.searchGridView.setFieldTitle(a)},Wlj.frame.functions.app.App.prototype.addStepData=function(a){if(!window._IM)return!1;var b=window._IM.fc.getStepContainerByResId(this.resId);b.addData(a)},Wlj.frame.functions.app.App.prototype.getViewTotalIndex=function(a){return this.resultDomain,a.getIndex()},Wlj.frame.functions.app.App.prototype.showViewByTotalIndex=function(a){var b=this.resultDomain;b.showView(b.getViewByTotleIndex(a))},Wlj.frame.functions.app.App.prototype.getStat=function(){var b,c,d,a={};return a.curParams=this.resultDomain.searchGridView.currentParams,b=this.getAllSelects(),c=[],Ext.each(b,function(a){c.push(a.store.indexOf(a))}),a.sels=c,this.getCurrentView()&&(d=this.getViewTotalIndex(this.getCurrentView()),a.cindex=d),a},Wlj.frame.functions.app.App.prototype.initStat=function(a){var b=this;a.curParams&&(this.searchDomain.searchPanel.getForm().setValues(a.curParams),this.setSearchParams(a.curParams,!0,!0,void 0,function(){a.sels&&b.selectByIndex(a.sels),Ext.isNumber(a.cindex)&&b.showViewByTotalIndex(a.cindex)}))},Wlj.frame.functions.app.App.prototype.buildFormField=function(a){var c,b=this.getFieldsByName(a);if(!b)return!1;if(c={},Ext.apply(c,b),c.fieldLabel=c.text?c.text:c.name,c.xtype=c.xtype?c.xtype:"textfield",c.hidden="boolean"==typeof c.hidden?c.hidden:c.text?!1:!0,c.anchor="90%",c.allowBlank===!1&&(c.fieldLabel=WLJTOOL.addBlankFlag(c.fieldLabel)),c.translateType){if(c.xtype=c.multiSelect?"lovcombo":"combo",c.store=this.lookupManager[c.translateType],!c.store)return Ext.error("字段【"+c.text+"】的数据字典映射项store【"+c.translateType+"】获取错误，请检查[lookupTypes|localLookup]项配置"),!1;c.valueField="key",c.displayField="value",c.editable="boolean"==typeof c.editable?c.editable:!1,c.forceSelection=!0,c.triggerAction="all",c.mode="local",c.hiddenName=c.name,c.separator=c.multiSeparator?c.multiSeparator:WLJUTIL.multiSelectSeparator}else c.name=c.name,c.dataType&&WLJDATATYPE[c.dataType]&&(c.xtype=WLJDATATYPE[c.dataType].getFieldXtype(),Ext.applyIf(c,WLJDATATYPE[c.dataType].getFieldSpecialCfg()));return c},Wlj.frame.functions.app.App.prototype.buildGridColumn=function(a){var c,b=this.getFieldsByName(a);return b?(c={},Ext.apply(c,b),c.header=c.text,c.text||(c.hidden=!0),c.dataIndex=c.name,delete c.xtype,c.dataType&&WLJDATATYPE[c.dataType]&&(c.type=WLJDATATYPE[c.dataType].getStoreType(),Ext.applyIf(c,WLJDATATYPE[c.dataType].getStoreSpecialCfg())),c):!1},Wlj.frame.functions.app.App.prototype.buildStoreField=function(a){var c,b=this.getFieldsByName(a);return b?(c={},Ext.apply(c,b),c.dataType&&WLJDATATYPE[c.dataType]&&(c.type=WLJDATATYPE[c.dataType].getStoreType(),Ext.applyIf(c,WLJDATATYPE[c.dataType].getStoreSpecialCfg())),c):!1},Ext.ns("Wlj.frame.functions.app"),Wlj.frame.functions.app.Builder=function(){Wlj.frame.functions.app.Builder.superclass.constructor.call(this),this.codeLoad()},Ext.extend(Wlj.frame.functions.app.Builder,Ext.util.Observable,{builderMode:"debug",resId:!1,codeFile:!1,buildFlow:!1,buildEvirement:function(){window.url=!1,window.comitUrl=!1,window.fields=!1,window.autoLoadGrid=!0,window.needCondition=!0,window.needGrid=!0,window.needTbar=!0,window.createView=!1,window.editView=!1,window.detailView=!1,window.formViewers=!1,window.createFormViewer=!1,window.editFormViewer=!1,window.detailFormViewer=!1,window.formCfgs=!1,window.createFormCfgs=!1,window.editFormCfgs=!1,window.detailFormCfgs=!1,window.validates=!1,window.createValidates=!1,window.editValidates=!1,window.linkages=!1,window.createLinkages=!1,window.editLinkages=!1,window.lookupTypes=!1,window.localLookup=!1,window.edgeViews=!1,window.customerView=!1,window.treeLoaders=!1,window.treeCfgs=!1,window.tbar=!1,window.listeners={beforeinit:!0,afterinit:!0,beforeconditioninit:!0,afterconditioninit:!0,beforeconditionrender:!0,afterconditionrender:!0,beforeconditionadd:!0,conditionadd:!0,beforeconditionremove:!0,conditionremove:!0,beforedyfieldclear:!0,afterdyfieldclear:!0,beforeconditioncollapse:!0,afterconditioncollapse:!0,beforeconditionexpand:!0,afterconditionexpand:!0,beforecondtitionfieldvalue:!0,condtitionfieldvalue:!0,recordselect:!0,rowdblclick:!0,load:!0,beforesetsearchparams:!0,setsearchparams:!0,beforeresultinit:!0,afterresultinit:!0,beforeresultrender:!0,afterresultrender:!0,beforecreateviewrender:!0,aftercreateviewrender:!0,beforeeditviewrender:!0,aftereditviewrender:!0,beforedetailviewrender:!0,afterdetailviewrender:!0,beforeviewshow:!0,viewshow:!0,beforeviewhide:!0,viewhide:!0,beforevalidate:!0,validate:!0,beforecommit:!0,afertcommit:!0,beforeeditload:!0,aftereditload:!0,beforedetailload:!0,afterdetailload:!0,beforetophide:!0,tophide:!0,beforetopshow:!0,topshow:!0,beforelefthide:!0,lefthide:!0,beforeleftshow:!0,leftshow:!0,beforebuttomhide:!0,buttomhide:!0,beforebuttomshow:!0,buttomshow:!0,beforerighthide:!0,righthide:!0,beforerightshow:!0,rightshow:!0,lookupinit:!0,locallookupinit:!0,alllookupinit:!0,beforelookupreload:!0,lookupreload:!0,beforetreecreate:!0,treecreate:!0}},codeLoad:function(a){return this.buildEvirement(),this.resId=JsContext._resId,this.resId?(this.getCodeFilePage(),this.codeFile?(this.codeLoading(a),void 0):(Ext.error(WERROR.NOCODEFILEERROR),!1)):(Ext.error(WERROR.NORESIDERROR),!1)},getCodeFilePage:function(){var a,b,c;if(parent.Wlj){if(parent.Wlj.ServiceMgr.services.get("service_"+this.resId))this.codeFile=parent.Wlj.ServiceMgr.services.get("service_"+this.resId).menuData.ACTION;else if(a=this.resId.substring(7),parent.Wlj)for(b=0;b<parent.Wlj.search.App.SEARCHTYPES.length;b++)if(a===parent.Wlj.search.App.SEARCHTYPES[b].searchType){this.codeFile=parent.Wlj.search.App.SEARCHTYPES[b].searchUrl;break}}else parent.booter&&(c=parent.booter.findMenuDataById(this.resId),c&&(this.codeFile=c.ACTION))},codeLoading:function(){if(this.codeFile.indexOf(".jsp")>=0)window.location.href=basepath+this.codeFile+"?resId="+this.resId;else{var b=this;b.busiTag=document.createElement("script"),b.busiTag.type="text/javascript",b.busiTag.src=basepath+this.codeFile,Ext.isIE6||Ext.isIE7||Ext.isIE8||Ext.isIE9||Ext.isIE10?b.busiTag.onreadystatechange=function(){("loaded"==b.busiTag.readyState||"complete"==b.busiTag.readyState)&&b.codeCheck.call(b)}:b.busiTag.onload=function(){b.codeCheck.call(b)},document.body.appendChild(b.busiTag)}},codeCheck:function(a){function i(){function a(a){function c(c,d){var g,i,j,f=h[c];if(Ext.log("检查["+f+"]面板内部配置"),!Ext.isArray(d))return Ext.error("["+f+"]面板配置不是数组形式，无法解析！请检查【formViewers】或者【"+a+"FormViewer】配置"),b=!0,!1;for(Ext.log("["+f+"]面板内部共["+d.length+"]个字段组！"),g=0;g<d.length;g++)if(Ext.log("检查第["+g+"]个字段组："),Ext.isArray(d[g].fields)){for(i=0;i<d[g].fields.length;i++)j=d[g].fields[i],e[j]?Ext.log("发现第["+i+"]个字段：["+j+"]；"):Ext.warn("["+f+"]面板第["+g+"]个字段组：第["+i+"]个字段：["+j+"]，未在基础字段配置中出现，可能无法展现；请检查【formViewers】或者【"+a+"FormViewer】配置");Ext.isFunction(d[g].fn)||(Ext.warn("["+f+"]面板第["+g+"]个字段组：[fn]属性不是有效function,将按照默认顺序渲染，请检查【formViewers】或者【"+a+"FormViewer】配置"),d[g].fn=!1),Ext.log("第["+g+"]个字段组检查完毕")}else Ext.error("["+f+"]面板第["+g+"]个字段组，字段配置不为数组形式，无法解析,请检查【formViewers】或者【"+a+"FormViewer】配置第【"+g+"】个字段组的field属性"),b=!0;Ext.log("["+f+"]面板内部检查完毕！")}return Ext.log("开始检查["+h[a]+"]面板表单设计"),Ext.isArray(window[a+"FormViewer"])?(Ext.log("发现"+h[a]+"面板表单设计属性：["+a+"FormViewer]"),c(a,window[a+"FormViewer"]),!0):(Ext.log("无"+h[a]+"面板表单设计或者类型不为数组属性：["+a+"FormViewer]"),Ext.log("检查[formViewers]属性配置，做为["+h[a]+"]面板表单设计"),"undefined"!=typeof formViewers&&Ext.isArray(formViewers)?(window[a+"FormViewer"]=formViewers,Ext.log("以[formViewers]属性配置，做为["+h[a]+"面板表单设计"),c(a,window[a+"FormViewer"]),!0):(Ext.log("无[formViewers]属性配置！"),Ext.warn(h[a]+"面板表单将被隐藏"),!1))}var c,d,f;return"undefined"==typeof createView&&(window.createView=!1),"undefined"==typeof editView&&(window.editView=!1),"undefined"==typeof detailView&&(window.detailView=!1),createView||editView||detailView?(c=!0,d=!0,f=!0,createView?c=a("create"):(Ext.log("页面无新增面板"),window.createFormViewer=!1),editView?d=a("edit"):(Ext.log("页面无修改面板"),window.editFormViewer=!1),detailView?f=a("detail"):(Ext.log("页面无详情面板"),window.detailFormViewer=!1),c||d||f||Ext.warn("新增、修改、详情面板配置均不可展现"),Ext.log("新增、修改、详情面板配置检查完毕!"),void 0):(Ext.warn("新增、修改、详情面板配置均不可展现"),void 0)}function j(a){function d(){var f,g,h,i,j,d=window[c];if(Ext.isArray(window[c]))for(Ext.log("发现["+b+"]校验规则配置,共["+d.length+"]条;"),f=0;f<d.length;f++)Ext.log("开始检查第["+f+"]条校验配置:["+d[f].desc+"]"),g=d[f],h=g.dataFields,i=g.fn,"undefined"!==h&&Ext.isArray(h)&&0!=h.length?(j=[],Ext.each(h,function(a){e[a]||j.push(a)}),j.length>0&&Ext.warn("["+b+"]面板第["+f+"]条校验规则字段：["+j.join(",")+"]无基础字段属性配置，校验触发时，无法接收到值！请检查【validates】或者【"+a+"Validates】配置"),i&&Ext.isFunction(i)||(Ext.warn("["+b+"]面板第["+f+"]条校验规则无校验函数,将以空方法补充，请检查【validates】或者【"+a+"Validates】配置"),g.fn=Ext.emptyFn),Ext.log("第["+f+"]条校验配置:["+d[f].desc+"]校验完毕")):(Ext.warn("["+b+"]面板第["+f+"]条校验配置:["+d[f].desc+"]字段属性[dataFields]配置有误，请检查【validates】或者【"+a+"Validates】配置"),Ext.log("第["+f+"]条校验配置:["+d[f].desc+"]校验完毕"));else Ext.warn("["+b+"]校验规则配置不是数组形式，无法解析；请检查【validates】或者【"+a+"Validates】配置")}var b=h[a],c=a+"Validates";Ext.log("开始检查["+b+"]校验规则配置：["+a+"Validates]"),Ext.isArray(window[c])?d():(Ext.log("未发现["+b+"]校验配置或者配置不是数组形式,将以基础校验规则[validates]代替"),"undefined"==typeof validates?Ext.log("未发现基础校验配置，["+b+"]操作将不做校验"):(window[c]=validates,d())),Ext.log("["+b+"]校验规则配置["+c+"]检查完毕！")}function k(a){function d(){var a,d,f;if(Ext.isObject(window[c]))for(a in window[c])Ext.log("开始检查字段联动逻辑["+a+"]"),e[a]?(Ext.log("发现字段联动逻辑：["+a+"]"),d=window[c][a],d.fields&&Ext.isArray(d.fields)?(f=[],Ext.each(d.fields,function(a){e[a]||f.push(a)}),f.length>0&&Ext.warn("["+b+"]面板联动逻辑：["+a+"]的受联动字段：["+f.join(",")+"]未在基础字段中配置，联动逻辑可能出错！,请检查【linkages】或者【"+c+"】的【"+a+"】属性"),Ext.isFunction(d.fn)||(Ext.warn("["+b+"]面板字段联动逻辑["+a+"]无联动function，将以空方法补充"),d.fn=Ext.emptyFn)):Ext.log("字段联动逻辑：["+a+"]无联动字段配置,请检查【linkages】或者【"+c+"】的【"+a+"】属性")):Ext.warn("["+b+"]面板字段联动["+a+"]未在基础字段配置中出现，将无法触发！请检查【linkages】或者【"+c+"】的【"+a+"】属性"),Ext.log("字段联动逻辑["+a+"]检查完毕!");else Ext.warn("["+b+"]面板字段联动逻辑配置有误,请检查【linkages】或者【"+c+"】")}var b=h[a],c=a+"Linkages";Ext.log("开始["+b+"]面板字段联动逻辑检查"),Ext.isObject(window[c])?d():(Ext.log("未发现["+b+"]面板字段联动逻辑或者配置不是数组形式,将以基础联动逻辑配置[linkages]代替"),"undefined"==typeof linkages?Ext.log("未发现基础联动逻辑配置"):(window[c]=linkages,d())),Ext.log("["+b+"]面板字段联动逻辑检查完毕！")}var b,c,d,e,f,g,h;if("debug"===this.builderMode){if(b=!1,Ext.log("检查配置项"),Ext.log("检查远程数据字典项配置[lookupTypes]:"),Ext.isArray(window.lookupTypes)?Ext.log("共发现["+lookupTypes.length+"]个远程数据字典配置项："+lookupTypes.join(",")):(Ext.warn("无远程数据字典项或配置格式不正确，将被置为空！请检查【lookupTypes】配置"),window.lookupTypes=[]),Ext.log("检查远程数据字典项配置检查完毕"),Ext.log("检查本地数据字典项配置[localLookup]:"),Ext.isObject(window.localLookup)){c=[];for(d in localLookup)c.push(d);Ext.log("共发现["+c.length+"]个远程数据字典配置项："+c.join(","))}else Ext.log("未申明本地数据字典项,或配置不正确"),window.localLookup={};if(Ext.log("检查本地数据字典项配置检查完毕"),Ext.log("检查是否需要产寻结果[needGrid]属性！"),window.needGrid===!1)Ext.log("检查结果为false，跳过对url的检查");else{if(Ext.log("检查主功能URL:[url]属性"),"string"!=typeof window.url)return Ext.error("无[url]属性，或者[url]属性配置错误！"),Ext.error("APP构建出错, APP构建停止"),b=!0,!1;Ext.log("发现属性[url],值为："+url),"string"!=typeof window.comitUrl?(Ext.warn("未发现数据提交URL：【comitUrl】,将使用[url]属性做为提交URL"),window.comitUrl=window.url):Ext.log("发现数据提交URL：[comitUrl],值为:"+window.comitUrl)}if(Ext.log("检查字段配置属性:[fields];"),"undefined"==typeof fields||Ext.isEmpty(fields)||!Ext.isArray(fields)||0==fields.length)return Ext.error("页面无基础字段配置或字段配置不正确，请检查【fields】属性！"),Ext.error("APP构建出错, APP构建停止"),!1;for(e={},f=0;f<fields.length;f++)g=fields[f],g.name?(Ext.log("发现字段["+g.name+"];"),e[g.name]=g):Ext.error("第["+f+"]个字段无name属性，请检查配置;请检查【fields】属性第【"+f+"】个字段配置！");
if(b)return Ext.error("APP构建出错, APP构建停止"),!1;if(window["needCondition"]===!1&&Ext.log("【needCondition】为false，不构建产寻条件面板"),window.needTbar===!1&&Ext.log("【needTbar】为false，不构建查询结果面板tbar对象"),h={create:"新增",edit:"修改",detail:"详情"},i(),b)return Ext.error("APP构建出错, APP构建停止"),!1;if(Ext.log("构建面板特殊配置[formCfgs|createFormCfgs|editFormCfgs|detailFormCfgs]"),window.createFormCfgs===!1&&(Ext.log("无新增面板配置，用【formCfgs】代替"),window.createFormCfgs=window.formCfgs),window.editFormCfgs===!1&&(Ext.log("无修改面板配置，用【formCfgs】代替"),window.editFormCfgs=window.formCfgs),window.detailFormCfgs===!1&&(Ext.log("无详情面板配置，用【formCfgs】代替"),window.detailFormCfgs=window.formCfgs),Ext.log("特殊配置检查完毕"),Ext.log("开始检查校验规则配置[validates|createValidates|editValidates]:"),j("create"),j("edit"),Ext.log("校验规则配置检查完毕！"),Ext.log("字段联动逻辑配置检查[linkages|createLinkages|editLinkages];"),k("create"),k("edit"),Ext.log("字段联动逻辑配置检查完毕！"),Ext.isObject(window.edgeViews)&&(edgeViews.left&&Ext.log("发现左部面板配置[edgeViews.left]"),edgeViews.right&&Ext.log("发现左部面板配置[edgeViews.right]"),edgeViews.top&&Ext.log("发现左部面板配置[edgeViews.top]"),edgeViews.buttom&&Ext.log("发现左部面板配置[edgeViews.buttom]")),Ext.isArray(window.customerView)?Ext.log("发现["+customerView.length+"]个客户化扩展面板！"):window.customerView===!1?Ext.log("无客户化扩展面板配置"):(Ext.warn("客户化扩展面板配置有误，将被忽略"),window.customerView=!1),Ext.isObject(window.listeners))for(d in listeners)listeners[d]===!0&&Ext.isFunction(window[d])?(listeners[d]=window[d],Ext.log("发现监听器：["+d+"];")):delete listeners[d];Ext.isArray(window.tbar)?Ext.each(tbar,function(a){Ext.log("发现自定义按钮：["+a.text+"];")}):window.tbar===!1?Ext.log("无自定义按钮配置"):(Ext.warn("自定义按钮[tbar]配置有误，将被忽略"),window.tbar=!1),Ext.log("配置项检查通过"),delete e}else if(window.comitUrl||(window.comitUrl=window.url),window.createView&&(window.createFormViewer||(window.createFormViewer=window.formViewers),window.createFormCfgs||(window.createFormCfgs=window.formCfgs),window.createValidates||(window.createValidates=window.validates),window.createLinkages||(window.createLinkages=window.linkages)),window.editView&&(window.editFormViewer||(window.editFormViewer=window.formViewers),window.editFormCfgs||(window.editFormCfgs=window.formCfgs),window.editValidates||(window.editValidates=window.validates),window.editLinkages||(window.editLinkages=window.linkages)),window.detailView&&(window.detailFormViewer||(window.detailFormViewer=window.formViewers),window.detailFormCfgs||(window.detailFormCfgs=window.formCfgs)),Ext.isObject(window.listeners))for(d in listeners)listeners[d]===!0&&Ext.isFunction(window[d])?listeners[d]=window[d]:delete listeners[d];this.APPCFG={resId:this.resId,needCondition:window.needCondition,needTbar:window.needTbar,needGrid:window.needGrid,autoLoadGrid:Ext.isFunction(a)?!1:window.autoLoadGrid,url:window.url,comitUrl:window.comitUrl,fields:window.fields,createView:window.createView,editView:window.editView,detailView:window.detailView,createFormViewer:window.createFormViewer,editFormViewer:window.editFormViewer,detailFormViewer:window.detailFormViewer,lookupTypes:window.lookupTypes,localLookup:window.localLookup,createValidates:window.createValidates,editValidates:window.editValidates,createLinkages:window.createLinkages,editLinkages:window.editLinkages,edgeViews:window.edgeViews,customerView:window.customerView,listeners:window.listeners,tbar:window.tbar,createFormCfgs:window.createFormCfgs,editFormCfgs:window.editFormCfgs,detailFormCfgs:window.detailFormCfgs},this.buildApp(a)},buildApp:function(a){window._app=new Wlj.frame.functions.app.App(this.APPCFG),Ext.isFunction(a)&&setTimeout(function(){a()},50);var b=this;this.buildFlow&&!window._IM&&Ext.ScriptLoader.loadScript({scripts:[basepath+"/contents/frameControllers/widgets/app/flows/Wlj-frame-function-flow.js",basepath+"/contents/frameControllers/widgets/app/flows/Wlj-frame-function-flow-demodata.js"],finalCallback:function(){window._IM=new Wlj.frame.functions.flow.widgets.InstanceManager,window._IM.activeStepContainer(b.resId),window._IM.currentStepResId=b.resId}})},clearGlobalHandler:function(){},reload:function(){},setResId:function(a,b){window._app.destroy(),window._app=null,JsContext._resId=a,this.codeLoad(b)}});